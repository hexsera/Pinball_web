# 업무일지

## 기본 정보
- 날짜: 2026-02-03 (월) 9:10~9:40
- 작성자: hexsera

## 진행 목표
Admin 페이지에 통계 페이지를 추가하고, 사이드바 메뉴에서 접근 가능하도록 구현

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| 통계 메인 컴포넌트 생성 | react/main/src/admin/AdminStatisticsMain.jsx | 통계 페이지 메인 콘텐츠 영역 |
| 통계 페이지 컴포넌트 생성 | react/main/src/admin/AdminStatisticsPage.jsx | 헤더, 사이드바, 메인 조합 레이아웃 |
| 사이드바 메뉴 추가 | react/main/src/admin/AdminSidebar.jsx | '통계' 메뉴 항목 추가 |
| 라우팅 설정 | react/main/src/App.jsx | /admin/statistics 경로 추가 |

## 주요 변경 사항

### 1. AdminStatisticsMain.jsx 생성

**추가:**
```javascript
import { Box, Typography, Toolbar } from '@mui/material';

function AdminStatisticsMain() {
  const drawerWidth = 260;

  return (
    <Box
      component="main"
      sx={{
        flexGrow: 1,
        p: 3,
        width: { sm: `calc(100% - ${drawerWidth}px)` },
        backgroundColor: '#F9FAFB',
        minHeight: '100vh',
      }}
    >
      <Toolbar/>
      <Typography variant="h4" sx={{ mb: 3, color: '#1f2937' }}>
        통계
      </Typography>
      <Box sx={{
        backgroundColor: '#ffffff',
        borderRadius: 1,
        p: 3,
        border: '1px solid #e5e7eb'
      }}>
        <Typography variant="body1" sx={{ color: '#6b7280' }}>
          통계 데이터가 여기에 표시됩니다.
        </Typography>
      </Box>
    </Box>
  );
}

export default AdminStatisticsMain;
```

**특징:**
- AdminMain.jsx와 동일한 레이아웃 패턴 적용
- `component="main"`으로 시맨틱 HTML 적용
- Toolbar 컴포넌트로 헤더 공간 확보
- `width: calc(100% - 260px)`로 사이드바 공간 제외
- 색상 체계: Dashboard와 동일 (#F9FAFB 배경, #ffffff 카드, #e5e7eb 보더)

### 2. AdminStatisticsPage.jsx 생성

**추가:**
```javascript
import { Box } from '@mui/material';
import AdminHeader from './AdminHeader';
import AdminSidebar from './AdminSidebar';
import AdminStatisticsMain from './AdminStatisticsMain';

function AdminStatisticsPage() {
  return (
    <Box sx={{ display: 'flex' }}>
      <AdminHeader />
      <AdminSidebar />
      <AdminStatisticsMain />
    </Box>
  );
}

export default AdminStatisticsPage;
```

**특징:**
- AdminPage.jsx와 동일한 구조 사용
- Flexbox로 Header, Sidebar, Main 조합
- 기존 공통 컴포넌트 재사용

### 3. AdminSidebar.jsx 수정

**변경 전:**
```javascript
import { Dashboard as DashboardIcon, People } from '@mui/icons-material';

const menuItems = [
  { text: '대시보드', icon: <DashboardIcon />, path: '/admin' },
  { text: '회원관리', icon: <People />, path: '/admin/users' },
];
```

**변경 후:**
```javascript
import { Dashboard as DashboardIcon, People, BarChart } from '@mui/icons-material';

const menuItems = [
  { text: '대시보드', icon: <DashboardIcon />, path: '/admin' },
  { text: '회원관리', icon: <People />, path: '/admin/users' },
  { text: '통계', icon: <BarChart />, path: '/admin/statistics' },
];
```

**특징:**
- BarChart 아이콘 import 추가
- menuItems 배열에 '통계' 메뉴 추가
- path는 `/admin/statistics`로 설정

### 4. App.jsx 수정

**변경 전:**
```javascript
import AdminPage from './admin/AdminPage';
import AdminUserPage from './admin/AdminUserPage';

<Routes>
  <Route path="/" element={<Dashboard />} />
  <Route path="/login" element={<Login />} />
  <Route path="/Register" element={<Register/>} />
  <Route path="/Pinball_test" element={<Pinball/>} />
  <Route path="/admin" element={<AdminPage/>} />
  <Route path="/admin/users" element={<AdminUserPage/>} />
</Routes>
```

**변경 후:**
```javascript
import AdminPage from './admin/AdminPage';
import AdminUserPage from './admin/AdminUserPage';
import AdminStatisticsPage from './admin/AdminStatisticsPage';

<Routes>
  <Route path="/" element={<Dashboard />} />
  <Route path="/login" element={<Login />} />
  <Route path="/Register" element={<Register/>} />
  <Route path="/Pinball_test" element={<Pinball/>} />
  <Route path="/admin" element={<AdminPage/>} />
  <Route path="/admin/users" element={<AdminUserPage/>} />
  <Route path="/admin/statistics" element={<AdminStatisticsPage/>} />
</Routes>
```

**특징:**
- AdminStatisticsPage import 추가
- `/admin/statistics` 경로에 AdminStatisticsPage 연결

## 아키텍처 구조

```
AdminStatisticsPage (/admin/statistics)
├── AdminHeader (상단 고정)
├── AdminSidebar (좌측 260px)
│   ├── 대시보드 (/admin)
│   ├── 회원관리 (/admin/users)
│   └── 통계 (/admin/statistics) ← 신규 추가
└── AdminStatisticsMain (메인 콘텐츠)
    └── 통계 데이터 표시 영역
```

## 결과
- 상태: 완료

## 배운내용
ai 가 메인 페이지 레이아웃 이상하게 짰다. mui 헤더, 사이드바의 대한 기억이 없나...

## 다음 작업

## 기본 정보
- 날짜: 2026-02-03 (월) 11:00~11:50
- 작성자: hexsera

## 진행 목표
관리자 통계 페이지에 주별 회원 방문 통계 Line Chart 추가

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| mui x charts 패키지 설치 | | |
| Line Chart 구현 | react/main/src/admin/AdminStatisticsMain.jsx | LineChart 컴포넌트 추가 및 임시 데이터 생성 |

## 주요 변경 사항

### 1. 통계-그래프-실행계획.md 작성

**추가:**
- MUI X Charts 패키지 설치 계획
- LineChart 컴포넌트 사용 방법
- 임시 데이터 구조 (최근 8주간 방문자 수)
- 구현 단계별 상세 가이드

**특징:**
- MUI 공식 차트 라이브러리 선택 (업계 표준)
- 주별 통계로 변경 (8주 데이터)
- 800x400px 크기의 Line Chart
- 마커(점) 표시로 데이터 포인트 강조

### 2. AdminStatisticsMain.jsx 수정

**변경 전:**
```javascript
import { Box, Typography, Toolbar } from '@mui/material';

function AdminStatisticsMain() {
  const drawerWidth = 260;

  return (
    <Box component="main" sx={{ ... }}>
      <Toolbar/>
      <Typography variant="h4" sx={{ mb: 3, color: '#1f2937' }}>
        통계
      </Typography>
      <Box sx={{ backgroundColor: '#ffffff', ... }}>
        <Typography variant="body1" sx={{ color: '#6b7280' }}>
          통계 데이터가 여기에 표시됩니다.
        </Typography>
      </Box>
    </Box>
  );
}
```

**변경 후:**
```javascript
import { Box, Typography, Toolbar } from '@mui/material';
import { LineChart } from '@mui/x-charts/LineChart';

function AdminStatisticsMain() {
  const drawerWidth = 260;

  // 임시 데이터: 최근 8주간 방문자 수
  const visitData = {
    visitors: [320, 450, 380, 520, 600, 470, 560, 610],
  };

  return (
    <Box component="main" sx={{ ... }}>
      <Toolbar/>
      <Typography variant="h4" sx={{ mb: 3, color: '#1f2937' }}>
        통계
      </Typography>
      <Box sx={{ backgroundColor: '#ffffff', ... }}>
        <Typography variant="h6" sx={{ mb: 2, color: '#1f2937' }}>
          회원 방문 통계 (최근 8주)
        </Typography>
        <LineChart
          xAxis={[{
            data: [1, 2, 3, 4, 5, 6, 7, 8],
            scaleType: 'point',
            label: '주차'
          }]}
          series={[{
            data: visitData.visitors,
            label: '방문자 수',
            color: '#465FFF',
            showMark: true,
          }]}
          width={800}
          height={400}
        />
      </Box>
    </Box>
  );
}
```

**특징:**
- LineChart 컴포넌트 import 추가 (@mui/x-charts/LineChart)
- visitData 객체로 8주간 방문자 수 데이터 관리
- xAxis: 1~8 숫자 데이터, scaleType: 'point'로 점 단위 표시
- series: 방문자 수 데이터, 파란색(#465FFF), 마커 표시
- 차트 크기: 800x400px

## 데이터 구조

**임시 데이터 (최근 8주간 방문자 수):**
```
주차:     1주차  2주차  3주차  4주차  5주차  6주차  7주차  8주차
방문자:    320    450    380    520    600    470    560    610
```

**차트 구성:**
```
┌─────────────────────────────────────────┐
│  회원 방문 통계 (최근 8주)               │
│                                         │
│  600 ┼               ●                  │
│      │          ●         ●       ●     │
│  500 ┼                                  │
│      │     ●                  ●         │
│  400 ┼               ●                  │
│      │  ●                               │
│  300 ┼                                  │
│      └─┴─┴─┴─┴─┴─┴─┴─                  │
│       1 2 3 4 5 6 7 8 (주차)            │
└─────────────────────────────────────────┘
```

## 결과
- 상태: 완료 (패키지 설치 제외)
- AdminStatisticsMain에 LineChart 컴포넌트 추가 완료
- 임시 데이터로 주별 방문 통계 시각화 구현
- @mui/x-charts 패키지 설치 필요 (로컬 환경에서 `npm install @mui/x-charts` 실행)

## 배운내용
- LineChart 컴포넌트

## 다음 작업
- 데이터 필터링

## 기본 정보
- 날짜: 2026-02-03 (월) 13:08~13:27 14:06~14:40
- 작성자: hexsera

## 진행 목표
관리자 통계 페이지에 API 연동 기능 구현 및 일주일 단위 집계 로직 추가

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| 실행계획 작성 | docs/prd/관리자-통계-페이지-GET-실행계획.md | API 연동 구현 계획 수립 |
| API 연동 구현 | react/main/src/admin/AdminStatisticsMain.jsx | axios GET 요청 및 일주일 집계 함수 구현 |
| 날짜 선택 UI 제거 | react/main/src/admin/AdminStatisticsMain.jsx | 자동 날짜 계산으로 변경 |
| 임시 데이터 생성 함수 추가 | react/main/src/admin/AdminStatisticsMain.jsx | 3개월 분량 일별 데이터 생성 |
| 패키지 의존성 추가 | react/main/package.json | dayjs 패키지 추가, @mui/x-date-pickers 패키지 추가  |


## 주요 변경 사항

### 1. 관리자-통계-페이지-GET-실행계획.md 작성

**추가:**
- API 스펙 정의: `GET /api/v1/game-plays`
- 쿼리 파라미터: `start_date`, `end_date`
- 응답 구조: `[{ date: "2026-01-20", play_count: 150 }, ...]`
- 일주일 단위 집계 함수 구현 계획
- 5단계 구현 절차 수립

**특징:**
- 게임 플레이 기록 데이터로 용어 통일 (접속 → 게임 플레이)
- API 인증 불필요 (API Key 제거)
- 오늘부터 8주 전 날짜를 자동으로 쿼리
- API 미구현 시 임시 데이터 사용

### 2. AdminStatisticsMain.jsx - API 연동 구현

**변경 전:**
```javascript
import { Box, Typography, Toolbar } from '@mui/material';
import { LineChart } from '@mui/x-charts/LineChart';

function AdminStatisticsMain() {
  const drawerWidth = 260;

  // 임시 데이터: 최근 8주간 방문자 수
  const visitData = {
    visitors: [320, 450, 380, 520, 600, 470, 560, 610],
  };

  return (
    <Box component="main" sx={{ ... }}>
      <LineChart
        xAxis={[{ data: [1, 2, 3, 4, 5, 6, 7, 8], ... }]}
        series={[{ data: visitData.visitors, label: '방문자 수', ... }]}
      />
    </Box>
  );
}
```

**변경 후:**
```javascript
import { useState, useEffect } from 'react';
import { Box, Typography, Toolbar } from '@mui/material';
import { LineChart } from '@mui/x-charts/LineChart';
import dayjs from 'dayjs';
import axios from 'axios';

function AdminStatisticsMain() {
  const drawerWidth = 260;

  // 상태 변수
  const [weeklyData, setWeeklyData] = useState([]);
  const [loading, setLoading] = useState(false);

  // 일주일 단위 집계 함수
  const aggregateByWeek = (dailyData, startDate) => {
    const weekMap = {};

    dailyData.forEach(item => {
      const date = dayjs(item.date);
      const weekNumber = Math.floor(date.diff(startDate, 'day') / 7) + 1;

      if (!weekMap[weekNumber]) {
        weekMap[weekNumber] = 0;
      }
      weekMap[weekNumber] += item.play_count;
    });

    return Object.keys(weekMap).map(week => ({
      week: parseInt(week),
      play_count: weekMap[week]
    })).sort((a, b) => a.week - b.week);
  };

  // 임시 일별 데이터 생성 함수 (3개월 분량)
  const generateMockDailyData = (startDate, endDate) => {
    const dailyData = [];
    let currentDate = dayjs(startDate);
    const end = dayjs(endDate);

    while (currentDate.isBefore(end) || currentDate.isSame(end, 'day')) {
      const playCount = Math.floor(Math.random() * 91) + 10;

      dailyData.push({
        date: currentDate.format('YYYY-MM-DD'),
        play_count: playCount
      });

      currentDate = currentDate.add(1, 'day');
    }

    return dailyData;
  };

  // API 호출 및 데이터 로딩 함수
  const fetchStatistics = async () => {
    setLoading(true);

    const endDate = dayjs();
    const startDate = dayjs().subtract(8, 'week');

    try {
      console.log('통계 데이터 로딩 시작:', {
        start_date: startDate.format('YYYY-MM-DD'),
        end_date: endDate.format('YYYY-MM-DD')
      });

      const response = await axios.get('/api/v1/game-plays', {
        params: {
          start_date: startDate.format('YYYY-MM-DD'),
          end_date: endDate.format('YYYY-MM-DD')
        }
      });

      console.log('API 응답:', response.data);

      const dailyData = response.data;
      const aggregated = aggregateByWeek(dailyData, startDate);
      setWeeklyData(aggregated);
    } catch (error) {
      console.error('통계 데이터 로딩 실패:', error);

      // API 미구현 시 임시 일별 데이터 생성 (3개월 분량)
      const mockStartDate = dayjs().subtract(12, 'week');
      const mockEndDate = dayjs();
      const mockDailyData = generateMockDailyData(mockStartDate, mockEndDate);

      console.log('임시 일별 데이터 생성:', mockDailyData.length + '일 분량');
      console.log('첫 5개 데이터:', mockDailyData.slice(0, 5));

      const aggregated = aggregateByWeek(mockDailyData, mockStartDate);
      console.log('집계된 주차별 데이터:', aggregated);

      setWeeklyData(aggregated);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchStatistics();
  }, []);

  return (
    <Box component="main" sx={{ ... }}>
      <Typography variant="h6" sx={{ mb: 2, color: '#1f2937' }}>
        게임 플레이 통계 (최근 8주)
      </Typography>
      <LineChart
        xAxis={[{
          data: weeklyData.map(item => item.week),
          scaleType: 'point',
          label: '주차'
        }]}
        series={[{
          data: weeklyData.map(item => item.play_count),
          label: '게임 플레이 횟수',
          color: '#465FFF',
          showMark: true,
        }]}
        width={800}
        height={400}
        loading={loading}
      />
    </Box>
  );
}
```

**특징:**
- useState/useEffect로 상태 관리 및 라이프사이클 처리
- axios를 사용한 API GET 요청 구현
- dayjs로 날짜 계산 및 포맷팅
- 일주일 단위 집계 함수 구현 (일별 데이터 → 주차별 데이터)
- 임시 데이터 생성 함수로 3개월(약 84일) 분량 데이터 생성
- API 실패 시 자동으로 임시 데이터 사용
- 로딩 상태 표시 (loading prop)
- 콘솔 로그로 디버깅 가능

### 3. package.json 수정

**변경 전:**
```json
{
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.6",
    "@mui/material": "^7.3.6",
    "@mui/x-charts": "^8.27.0",
    "@mui/x-data-grid": "^8.26.0",
    "axios": "^1.13.2",
    "matter-js": "^0.20.0",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "react-router-dom": "^7.11.0",
    "yup": "^1.7.1"
  }
}
```

**변경 후:**
```json
{
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.6",
    "@mui/material": "^7.3.6",
    "@mui/x-charts": "^8.27.0",
    "@mui/x-data-grid": "^8.26.0",
    "@mui/x-date-pickers": "^8.27.0",
    "axios": "^1.13.2",
    "dayjs": "^1.11.19",
    "matter-js": "^0.20.0",
    "react": "^19.2.3",
    "react-dom": "^19.2.3",
    "react-router-dom": "^7.11.0",
    "yup": "^1.7.1"
  }
}
```

**특징:**
- dayjs 패키지 추가 (^1.11.19)
- @mui/x-date-pickers 패키지 추가 (^8.27.0) - 향후 날짜 선택 UI에 사용 가능

## 데이터 흐름

```
1. 컴포넌트 마운트
   │
   ▼
2. useEffect 실행
   │
   ▼
3. fetchStatistics() 호출
   │
   ├─→ API 성공: GET /api/v1/game-plays
   │   │ params: { start_date: "2025-12-09", end_date: "2026-02-03" }
   │   │
   │   ▼
   │   일별 데이터 수신: [{ date: "2025-12-09", play_count: 45 }, ...]
   │   │
   │   ▼
   │   aggregateByWeek(dailyData, startDate)
   │   │
   │   └─→ 주차별 데이터: [{ week: 1, play_count: 320 }, ...]
   │
   └─→ API 실패: catch 블록
       │
       ▼
       generateMockDailyData(12주 전, 오늘)
       │ 랜덤 데이터 생성: 10~100 사이 값
       │
       ▼
       84일 분량 일별 데이터 생성
       │
       ▼
       aggregateByWeek(mockDailyData, mockStartDate)
       │
       └─→ 주차별 데이터: [{ week: 1, play_count: 450 }, ...]

4. setWeeklyData(aggregated)
   │
   ▼
5. LineChart 렌더링
   │ xAxis: weeklyData.map(item => item.week)
   │ series: weeklyData.map(item => item.play_count)
   │
   └─→ 화면에 차트 표시
```

## 일주일 단위 집계 로직

**입력 데이터 (일별):**
```
[
  { date: "2025-12-09", play_count: 45 },
  { date: "2025-12-10", play_count: 60 },
  { date: "2025-12-11", play_count: 30 },
  ...
  { date: "2025-12-15", play_count: 55 }, // 7일째
  { date: "2025-12-16", play_count: 40 }, // 8일째 (2주차 시작)
  ...
]
```

**처리 과정:**
1. 각 날짜가 시작일로부터 몇 일째인지 계산
2. `Math.floor(일수 / 7) + 1`로 주차 번호 계산
3. weekMap 객체에 주차별로 play_count 누적
4. 배열로 변환 및 정렬

**출력 데이터 (주차별):**
```
[
  { week: 1, play_count: 320 },  // 1~7일째 합계
  { week: 2, play_count: 450 },  // 8~14일째 합계
  { week: 3, play_count: 380 },  // 15~21일째 합계
  ...
]
```

## 결과
- 상태: 미완료
- 테스트 시간 없음

## 배운내용
요구사항에 없는 걸 막 추가하지 말자. 시간도 없는데...
날짜 선택 UI 막 만들어주니깐 그냥 해버렸음...

## 다음 작업
- 임시 데이터 삭제
- 주간 데이터 -> 일간 데이터 수정정