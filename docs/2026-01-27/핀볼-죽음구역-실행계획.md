# 핀볼 죽음구역 실행계획

## 요구사항 요약

**요구사항**: 핀볼 게임에 공이 닿으면 사라지는 죽음구역을 추가한다.

**목적**: 사용자의 도전의식을 고취하여 게임에 재미를 더한다. 공이 특정 영역에 떨어지면 사라지도록 하여 긴장감을 조성한다.

## 현재상태 분석

현재 Pinball.jsx에는 다음 요소들이 구현되어 있다:
- Matter.js 물리 엔진을 사용한 핀볼 게임 (700×1200 캔버스)
- 공(ball): 초기 위치 (250, 400), 반발력(restitution) 0.8
- 바닥(ground): y=1200 위치에 정적 물체로 존재
- 플리퍼(leftFlipper, rightFlipper): y=1150 위치, 키보드/터치로 조작
- 충돌 이벤트 리스너: 범퍼(bumper)와의 충돌 감지 구현
- 점수 시스템: useState로 점수 상태 관리 중 (현재 30점 고정)

## 구현 방법

Matter.js의 충돌 감지 이벤트(`collisionStart`)를 활용하여 죽음구역 구현:
1. 바닥 아래에 센서 역할의 죽음구역(deathZone)을 생성 (`isSensor: true`)
2. 센서는 충돌 감지만 하고 물리적 충돌은 발생하지 않음
3. 공과 죽음구역의 충돌 감지 시 `World.remove()`로 공을 세계에서 제거
4. 라벨(label)을 사용하여 죽음구역을 식별 (`label: 'deathZone'`)

Matter.js에서 `isSensor: true` 속성을 가진 물체는 충돌 이벤트는 발생시키지만 물리적 충돌(튕김, 막힘)은 발생하지 않는다. 이를 활용하여 공이 통과하면서도 감지할 수 있는 죽음구역을 만든다.

## 구현 단계

### 1. 죽음구역 Bodies 생성
```javascript
// 죽음구역 만들기 (바닥 아래, 센서 역할)
const deathZone = Bodies.rectangle(350, 1220, 700, 40, {
  isStatic: true,
  isSensor: true,
  label: 'deathZone',
  render: {
    fillStyle: '#8b0000',  // 어두운 빨간색 (디버깅용, 투명으로 변경 가능)
    opacity: 0.3
  }
});
```
- 위치: x=350(중앙), y=1220(바닥보다 20px 아래)
- 크기: 700×40 (캔버스 전체 너비)
- `isSensor: true`로 설정하여 물리적 충돌 없이 감지만 수행

### 2. World에 죽음구역 추가
```javascript
// 세계에 모든 물체 추가
World.add(engine.world, [
  ground,
  leftWall,
  rightWall,
  upWall,
  ball,
  obstacle1,
  obstacle2,
  bumper,
  leftFlipper,
  rightFlipper,
  leftFlipperConstraint,
  rightFlipperConstraint,
  deathZone  // 죽음구역 추가
]);
```

### 3. 충돌 감지 이벤트 리스너 수정
기존 `collisionStart` 이벤트 리스너에 죽음구역 감지 로직 추가:
```javascript
Events.on(engine, 'collisionStart', (event) => {
  const pairs = event.pairs;

  pairs.forEach((pair) => {
    const { bodyA, bodyB } = pair;

    // 기존 범퍼 충돌 로직...
    if ((bodyA.label === 'bumper' && bodyB === ball) ||
        (bodyB.label === 'bumper' && bodyA === ball)) {
      console.log('Bumper hit!');
      // ... 범퍼 효과 코드
    }

    // 죽음구역 충돌 감지 (새로 추가)
    if ((bodyA.label === 'deathZone' && bodyB === ball) ||
        (bodyB.label === 'deathZone' && bodyA === ball)) {
      console.log('Ball entered death zone!');
      World.remove(engine.world, ball);
    }
  });
});
```
- 공이 죽음구역에 닿으면 `World.remove()`로 공을 제거
- 콘솔 로그로 디버깅 메시지 출력

### 4. (선택사항) 공 재생성 로직
게임오버는 구현하지 않지만, 향후 공 재생성을 위해 ball 변수를 외부에서 접근 가능하도록 구조 수정 가능:
```javascript
// useRef로 ball 참조 관리 (향후 확장용)
const ballRef = useRef(null);

// useEffect 내부에서
ballRef.current = ball;
```

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `/home/hexsera/Pinball_web/react/main/src/Pinball.jsx` | 수정 | 1. deathZone Bodies 생성 (y=1220, isSensor: true)<br>2. World.add()에 deathZone 추가<br>3. collisionStart 이벤트에 죽음구역 감지 로직 추가 |

## 완료 체크리스트

- [o] 공이 바닥 아래로 떨어지면 사라지는가?
- [o] 공이 사라질 때 콘솔에 'Ball entered death zone!' 메시지가 출력되는가?
- [o] 죽음구역이 물리적 충돌을 일으키지 않는가? (공이 통과하면서 감지되는가?)
- [o] 게임을 실행했을 때 에러 없이 정상 동작하는가?
