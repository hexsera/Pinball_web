# 핀볼 화면 크기 조정 실행계획

## 요구사항 요약

**요구사항**: 핀볼 게임 화면이 사용자의 브라우저 화면 크기에 맞게 동적으로 조정되도록 구현

**목적**: 현재 고정된 캔버스 크기(700×1200)와 CSS transform scale로 인해 사용자의 다양한 화면 크기에서 접근성이 떨어지는 문제를 해결하고, 반응형으로 자동 조정되는 게임 화면을 제공하여 사용자 편의성 향상

## 현재상태 분석

**현재 구조**:
- 캔버스 크기: 고정값 700×1200 (Render.create options)
- 반응형 처리: CSS transform scale (xs/sm: 0.5배, md: 0.8배)
- 배경이미지: Box에 backgroundImage로 700×1200 크기 적용
- 물리 좌표: Matter.js는 고정 좌표계(700×1200) 사용

**문제점**:
- 화면 크기가 큰 경우 게임 화면이 너무 작게 표시됨
- 화면 크기가 작은 경우 scale(0.5)로 축소되어 가독성 저하
- transform scale은 레이아웃 공간을 원본 크기대로 차지하여 불필요한 여백 발생
- 물리 좌표가 고정되어 있어 화면 크기 변경 시 게임 오브젝트 위치가 부자연스러워질 수 있음

## 구현 방법

**브라우저 화면 크기 기반 동적 스케일링 방식**:

1. `useEffect`와 `useState`로 브라우저 창 크기 추적
2. `window.innerWidth`, `window.innerHeight`를 기준으로 최적 scale 계산
3. 계산된 scale을 캔버스와 배경이미지 Box에 동적 적용
4. `resize` 이벤트 리스너로 창 크기 변경 시 자동 재조정
5. Matter.js 물리 좌표는 고정(700×1200) 유지하되, 시각적 표현만 scale 조정

**주요 API 설명**:

1. **window.innerWidth / window.innerHeight**:
   - 브라우저 창의 뷰포트 너비와 높이를 픽셀 단위로 반환하는 읽기 전용 속성
   - 스크롤바를 포함한 실제 콘텐츠 표시 영역 크기
   - 예: 브라우저 창이 1920×1080이면 `window.innerWidth`는 1920, `window.innerHeight`는 1080
   - 모바일/데스크톱 모든 환경에서 동작

2. **Math.min(...values)**:
   - 전달된 숫자들 중 가장 작은 값을 반환하는 JavaScript 내장 함수
   - 예: `Math.min(0.8, 1.2, 1)` → 0.8 반환
   - 본 구현에서는 너비 기준 스케일, 높이 기준 스케일, 1(최대 확대 제한) 중 최솟값 선택
   - 가장 작은 스케일을 선택함으로써 게임 화면이 브라우저를 벗어나지 않도록 보장

**장점**:
- 모든 화면 크기에서 최적의 게임 화면 제공
- 반응형 디자인으로 사용자 경험 향상
- 물리 엔진 좌표 변경 없이 시각적 조정만으로 구현 가능

## 구현 단계

### 1. 화면 크기 상태 추가 및 초기화
```javascript
const [windowSize, setWindowSize] = useState({
  width: window.innerWidth,
  height: window.innerHeight
});
const [gameScale, setGameScale] = useState(1);
```
- `windowSize`: 브라우저 창의 현재 너비와 높이 저장
- `gameScale`: 계산된 게임 화면 스케일 비율 저장

### 2. 최적 스케일 계산 함수 구현
```javascript
const calculateScale = useCallback(() => {
  const canvasWidth = 700;
  const canvasHeight = 1200;
  const padding = 40; // 여백

  // 화면 너비/높이 기준으로 각각 계산
  const scaleByWidth = (windowSize.width - padding) / canvasWidth;
  const scaleByHeight = (windowSize.height - padding) / canvasHeight;

  // 둘 중 작은 값을 선택하여 화면에 꽉 차지 않도록
  const optimalScale = Math.min(scaleByWidth, scaleByHeight, 1);

  setGameScale(optimalScale);
}, [windowSize]);
```
- 너비 기준 스케일과 높이 기준 스케일 중 작은 값 선택
- 최대 1배까지만 확대 (원본보다 크게 표시하지 않음)
- padding을 제외하여 화면 경계와 여유 공간 확보

### 3. 창 크기 변경 이벤트 리스너 등록
```javascript
useEffect(() => {
  const handleResize = () => {
    setWindowSize({
      width: window.innerWidth,
      height: window.innerHeight
    });
  };

  window.addEventListener('resize', handleResize);

  return () => {
    window.removeEventListener('resize', handleResize);
  };
}, []);
```
- `resize` 이벤트로 창 크기 변경 감지
- `windowSize` 상태 업데이트
- cleanup 함수에서 이벤트 리스너 제거

### 4. windowSize 변경 시 스케일 재계산
```javascript
useEffect(() => {
  calculateScale();
}, [windowSize, calculateScale]);
```
- `windowSize`가 변경될 때마다 `calculateScale()` 호출
- `gameScale` 상태 자동 업데이트

### 5. 동적 스케일 적용 (Box sx 수정)
```javascript
<Box sx={{
  position: 'relative',
  width: '700px',
  height: '1200px',
  backgroundImage: 'url(/images/pinball_back.png)',
  backgroundSize: '100% 100%',
  backgroundPosition: 'center',
  backgroundRepeat: 'no-repeat',
  transform: `scale(${gameScale})`,  // 동적 스케일 적용
  transformOrigin: 'top center'
}}>
```
- 기존 `transform: { xs: 'scale(0.5)', ... }` 제거
- 계산된 `gameScale` 상태를 직접 적용
- `transformOrigin: 'top center'` 유지 (중앙 기준 스케일)

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| react/main/src/Pinball.jsx | 수정 | useState로 windowSize, gameScale 상태 추가 |
| react/main/src/Pinball.jsx | 수정 | calculateScale 함수 추가 (useCallback) |
| react/main/src/Pinball.jsx | 수정 | resize 이벤트 리스너 등록 useEffect 추가 |
| react/main/src/Pinball.jsx | 수정 | windowSize 변경 감지 useEffect 추가 |
| react/main/src/Pinball.jsx | 수정 | Box sx의 transform을 동적 gameScale로 변경 |

## 완료 체크리스트

- [o] 브라우저 창 크기를 변경했을 때 게임 화면이 자동으로 조정되는지 확인
- [o] 작은 화면(모바일)에서 게임이 화면에 맞게 축소되는지 확인
- [o] 큰 화면(데스크톱)에서 게임이 적절한 크기로 표시되는지 확인
- [o] 게임 화면이 화면 중앙에 정렬되어 표시되는지 확인
- [o] 플리퍼 조작이 정상적으로 작동하는지 확인
- [o] 공의 물리 동작이 정상적으로 작동하는지 확인
- [o] 콘솔 에러가 발생하지 않는지 확인
