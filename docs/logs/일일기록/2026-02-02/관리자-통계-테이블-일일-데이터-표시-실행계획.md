# 관리자 통계 테이블 일일 데이터 표시 실행계획

## 요구사항 요약

**요구사항**: AdminStatisticsMain.jsx의 게임 플레이 통계 테이블을 주간 집계에서 일일 데이터로 변경

**목적**:
- 관리자가 일별 상세 데이터를 확인할 수 있도록 개선
- 오늘부터 2주 전까지의 일일 데이터를 날짜 순서로 표시
- 데이터의 시간적 흐름을 더 명확하게 파악

## 현재상태 분석

**현재 구조**:
- `aggregateByWeek()` 함수로 일별 데이터를 주차별로 집계
- 8주(56일) 분량의 데이터를 12개 주차로 축약하여 표시
- x축에 "주차" 레이블로 1, 2, 3... 형태로 표시
- `weeklyData` 상태 변수에 주차별 데이터 저장

**문제점**:
- 주간 집계로 인해 일별 변화 추이를 파악할 수 없음
- x축이 주차 번호로만 표시되어 실제 날짜 확인 불가
- 데이터 범위가 8주로 너무 길어 불필요한 집계 발생

## 구현 방법

**접근 방식**:
1. `aggregateByWeek()` 함수 제거 (주간 집계 불필요)
2. `weeklyData` 상태 변수를 `dailyData`로 변경
3. 2주(14일) 분량의 일별 데이터를 직접 사용
4. x축을 날짜 형식(MM-DD)으로 변경
5. 데이터 정렬을 오름차순(과거→현재)으로 유지

**기술 스택**:
- dayjs: 날짜 계산 및 포맷팅
- MUI X-Charts LineChart: 그래프 렌더링
- axios: API 호출 (현재는 mock 데이터 사용)

## 구현 단계

### 1. 상태 변수 및 함수 수정
```javascript
// 상태 변수 이름 변경
const [dailyData, setDailyData] = useState([]);
const [loading, setLoading] = useState(false);

// aggregateByWeek 함수 삭제 (더 이상 사용하지 않음)
```
- `weeklyData` → `dailyData`로 변경하여 의미를 명확히 함
- 주간 집계 함수(`aggregateByWeek`) 전체 삭제

### 2. API 호출 범위 변경
```javascript
const fetchStatistics = async () => {
  setLoading(true);

  // 오늘부터 2주 전 날짜 계산
  const endDate = dayjs();
  const startDate = dayjs().subtract(2, 'week'); // 8주 → 2주로 변경

  try {
    console.log('통계 데이터 로딩 시작:', {
      start_date: startDate.format('YYYY-MM-DD'),
      end_date: endDate.format('YYYY-MM-DD')
    });

    const response = await axios.get('/api/v1/game-plays', {
      params: {
        start_date: startDate.format('YYYY-MM-DD'),
        end_date: endDate.format('YYYY-MM-DD')
      }
    });

    console.log('API 응답:', response.data);

    // 일별 데이터를 그대로 사용 (집계 없이)
    const dailyDataFromAPI = response.data;

    // 날짜 오름차순 정렬 (2주 전 → 오늘)
    const sortedData = dailyDataFromAPI.sort((a, b) =>
      dayjs(a.date).isAfter(dayjs(b.date)) ? 1 : -1
    );

    setDailyData(sortedData);
  } catch (error) {
    // ...
  }
};
```
- 데이터 범위를 8주에서 2주로 변경
- API 응답 데이터를 집계 없이 바로 사용
- 날짜 오름차순 정렬 추가 (과거 → 현재)

### 3. Mock 데이터 생성 로직 수정
```javascript
catch (error) {
  console.error('통계 데이터 로딩 실패:', error);

  // API 미구현 시 임시 일별 데이터 생성 (2주 분량)
  const mockStartDate = dayjs().subtract(2, 'week'); // 12주 → 2주로 변경
  const mockEndDate = dayjs();
  const mockDailyData = generateMockDailyData(mockStartDate, mockEndDate);

  console.log('임시 일별 데이터 생성:', mockDailyData.length + '일 분량');
  console.log('첫 5개 데이터:', mockDailyData.slice(0, 5));

  // 집계 없이 바로 사용
  setDailyData(mockDailyData);
} finally {
  setLoading(false);
}
```
- Mock 데이터 생성 범위를 12주에서 2주로 변경
- `aggregateByWeek()` 호출 제거
- 일별 데이터를 그대로 상태에 저장

### 4. 차트 컴포넌트 수정
```javascript
<Box sx={{
  backgroundColor: '#ffffff',
  borderRadius: 1,
  p: 3,
  border: '1px solid #e5e7eb'
}}>
  <Typography variant="h6" sx={{ mb: 2, color: '#1f2937' }}>
    게임 플레이 통계 (최근 2주) {/* 8주 → 2주로 변경 */}
  </Typography>
  <LineChart
    xAxis={[{
      data: dailyData.map(item => dayjs(item.date).format('MM-DD')), // 날짜 형식으로 변경
      scaleType: 'point',
      label: '날짜' // "주차" → "날짜"로 변경
    }]}
    series={[{
      data: dailyData.map(item => item.play_count), // weeklyData → dailyData
      label: '게임 플레이 횟수',
      color: '#465FFF',
      showMark: true,
    }]}
    width={800}
    height={400}
    loading={loading}
  />
</Box>
```
- 차트 제목을 "최근 8주"에서 "최근 2주"로 변경
- x축 데이터를 날짜 형식(MM-DD)으로 변경 (예: "01-20", "01-21")
- x축 레이블을 "주차"에서 "날짜"로 변경
- series의 데이터 소스를 `weeklyData`에서 `dailyData`로 변경

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| react/main/src/admin/AdminStatisticsMain.jsx | 수정 | 주간 집계 로직 제거, 일일 데이터 표시로 변경 |

## 완료 체크리스트

- [o] 그래프 x축에 날짜(MM-DD)가 표시되는지 확인
- [o] 그래프에 14일 분량의 데이터가 표시되는지 확인
- [o] 왼쪽에 2주 전 날짜, 오른쪽에 오늘 날짜가 표시되는지 확인
- [o] 콘솔에 "임시 일별 데이터 생성: 14일 분량" 메시지가 출력되는지 확인
- [o] 브라우저에서 에러 없이 차트가 렌더링되는지 확인
