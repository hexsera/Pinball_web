# 방 관리 UI 상세 설명

> PRD Phase 5: 방 관리 UI 구현에 대한 상세 문서

---

## 개요

방 관리 UI는 멀티플레이 핀볼 게임에 진입하기 전 사용자가 방을 생성하거나 기존 방에 입장하는 로비 화면이다.
`/lobby` 경로의 `LobbyPage.jsx`로 구현한다.

---

## 화면 구성

```
┌─────────────────────────────────────────────────────┐
│  🎯 멀티플레이 로비                        [대시보드로] │
├─────────────────────────────────────────────────────┤
│                                                     │
│  [+ 방 만들기]                                       │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │ 방 코드로 입장:  [  ABC123  ] [입장]          │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ── 현재 열린 방 ──────────────────────────────     │
│                                                     │
│  ┌───────────────────┐  ┌───────────────────┐      │
│  │ 방 코드: XYZ789   │  │ 방 코드: ABC123   │      │
│  │ 방장: hexsera     │  │ 방장: player2     │      │
│  │ 상태: 대기중       │  │ 상태: 진행중       │      │
│  │ 인원: 1/2         │  │ 인원: 2/2         │      │
│  │        [입장]     │  │      [관전 불가]   │      │
│  └───────────────────┘  └───────────────────┘      │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 기능 상세

### 1. 방 만들기

- 버튼 클릭 시 `POST /api/v1/rooms` 호출
- 서버에서 6자리 랜덤 `room_code` 생성 후 DB 저장
- 생성 완료 시 해당 방의 게임 페이지(`/lobby/room/{room_code}`)로 이동
- 방장(`host_id`)은 로그인한 사용자 ID로 자동 설정

### 2. 방 코드로 입장

- 6자리 코드 직접 입력 후 입장 버튼 클릭
- `GET /api/v1/rooms/{room_code}` 로 방 상태 확인
- 방이 존재하고 `status: "waiting"`이면 게임 페이지로 이동
- 방이 없거나 `status: "playing"`이면 오류 메시지 표시

### 3. 방 목록

- 페이지 진입 시 `GET /api/v1/rooms` 로 대기 중인 방 목록 로드
- 방 카드에 표시: 방 코드, 방장 닉네임, 상태(대기중/진행중), 인원(현재/최대)
- `status: "waiting"` 방만 입장 버튼 활성화
- 30초마다 자동 새로고침 (또는 새로고침 버튼 제공)

---

## 방 상태(status) 흐름

```
생성됨
  │
  ▼
waiting  ──── 2명 모두 준비 ──→  playing  ──── 게임 종료 ──→  finished
  │                                                              │
  └──────────────── 방장이 방 나감 ──────────────────────────────┘
                        (DB에서 삭제)
```

---

## API 연동

| 동작 | 메서드 | 엔드포인트 | 설명 |
|------|--------|-----------|------|
| 방 생성 | `POST` | `/api/v1/rooms` | 방 생성, room_code 반환 |
| 방 목록 | `GET` | `/api/v1/rooms` | 대기중인 방 목록 반환 |
| 방 조회 | `GET` | `/api/v1/rooms/{room_code}` | 특정 방 상태 조회 |
| 방 삭제 | `DELETE` | `/api/v1/rooms/{room_code}` | 방장만 가능 |

---

## 파일 구조

```
frontend/src/pages/Lobby/
├── index.js          # 라우팅 진입점
├── LobbyPage.jsx     # 메인 로비 화면 (방 목록 + 방 만들기)
└── RoomCard.jsx      # 방 목록 카드 컴포넌트
```

---

## React Router 연동

```
/lobby              → LobbyPage (방 목록)
/lobby/room/:code   → PinballPage (게임 + 채팅, 멀티플레이 모드)
```

- `PinballPage`는 URL 파라미터로 `room_code`를 받아 멀티/싱글 모드를 분기
- 싱글 플레이: 기존 `/pinball` 경로 유지

---

## Dashboard 연동

- `DashboardSidebar.jsx` 또는 `Dashboard.jsx`에 **멀티플레이** 버튼 추가
- 클릭 시 `/lobby`로 이동

---

## 예외 처리

| 상황 | 처리 방법 |
|------|---------|
| 존재하지 않는 방 코드 입력 | "존재하지 않는 방입니다" 토스트 메시지 |
| 이미 진행 중인 방 입장 시도 | "이미 게임이 시작된 방입니다" 토스트 메시지 |
| 비로그인 상태에서 로비 접근 | 로그인 페이지로 리다이렉트 |
| 방장이 나갔을 때 | 상대방 화면에 "방장이 나갔습니다" 표시 후 로비로 이동 |
