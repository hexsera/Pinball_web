# 프로젝트 구조 정리 실행계획

## 요구사항 요약

**요구사항**: 현재 프로젝트 구조를 업계 표준 관행에 맞춰 정리

**목적**: 코드 유지보수성 향상, 팀 협업 용이성, 확장성 확보

## 현재상태 분석

```
Pinball_web/
├── .claude/              # Claude 설정 (유지)
├── .git/                 # Git (유지)
├── PRD/                  # 기획문서 + 업무일지 혼재
├── docs/                 # 업무일지, 일일파일
├── fastapi/              # 백엔드 (구조 개선 필요)
│   ├── main.py          # 모든 API가 한 파일에
│   ├── models.py        # ORM 모델
│   ├── database.py      # DB 연결
│   └── auth.py          # 인증
├── react/main/src/       # 프론트엔드 (구조 개선 필요)
│   ├── admin/           # 관리자 페이지
│   └── *.jsx            # 컴포넌트 혼재
├── html/                 # 빌드 결과물
├── nginx/                # Nginx 설정
└── 설정파일들            # 루트에 혼재
```

**문제점**:
- FastAPI: 모든 API 로직이 main.py 한 파일에 집중
- React: 컴포넌트, 컨텍스트, 페이지가 한 폴더에 혼재
- 문서: PRD와 업무일지가 분산되어 관리 어려움
- 설정: Docker, Nginx 설정이 루트에 혼재

## 구현 방법

**업계 표준 구조** 적용:
- FastAPI: Router 기반 모듈 분리 (도메인별 분리)
- React: Feature-based 또는 Atomic Design 구조
- 문서: docs/ 폴더에 통합
- 설정: infra/ 또는 deploy/ 폴더로 분리

## 전체 프로젝트 구조 (목표)

```
Pinball_web/
├── backend/                    # 백엔드 (FastAPI)
│   ├── app/
│   │   ├── api/               # API 라우터
│   │   │   ├── v1/
│   │   │   │   ├── users.py   # 사용자 API
│   │   │   │   ├── scores.py  # 점수 API
│   │   │   │   ├── friends.py # 친구 API
│   │   │   │   └── auth.py    # 인증 API
│   │   │   └── deps.py        # 의존성 (get_db 등)
│   │   ├── core/              # 핵심 설정
│   │   │   ├── config.py      # 환경변수 설정
│   │   │   └── security.py    # 보안 (API Key, JWT)
│   │   ├── models/            # ORM 모델
│   │   │   ├── user.py
│   │   │   ├── score.py
│   │   │   └── friendship.py
│   │   ├── schemas/           # Pydantic 스키마
│   │   │   ├── user.py
│   │   │   ├── score.py
│   │   │   └── friendship.py
│   │   ├── db/                # 데이터베이스
│   │   │   ├── base.py        # Base 클래스
│   │   │   ├── session.py     # 세션 관리
│   │   │   └── seed.py        # 시드 데이터
│   │   └── main.py            # 앱 엔트리포인트
│   ├── alembic/               # 마이그레이션
│   ├── tests/                 # 테스트
│   ├── .env
│   ├── requirements.txt
│   └── Dockerfile
├── frontend/                   # 프론트엔드 (React)
│   ├── public/                # 정적 파일
│   │   └── images/
│   ├── src/
│   │   ├── components/        # 재사용 컴포넌트
│   │   │   ├── common/        # 공통 (Button, Input 등)
│   │   │   └── layout/        # 레이아웃 (Sidebar, Header)
│   │   ├── pages/             # 페이지 컴포넌트
│   │   │   ├── Dashboard/
│   │   │   ├── Login/
│   │   │   ├── Register/
│   │   │   ├── Pinball/
│   │   │   ├── UserInfo/
│   │   │   └── admin/
│   │   ├── contexts/          # React Context
│   │   ├── hooks/             # 커스텀 훅
│   │   ├── services/          # API 호출
│   │   ├── utils/             # 유틸 함수
│   │   ├── App.jsx
│   │   └── main.jsx
│   ├── package.json
│   └── vite.config.js
├── infra/                      # 인프라 설정
│   ├── docker/
│   │   └── docker-compose.yml
│   ├── nginx/
│   │   └── nginx.conf
│   └── traefik/
│       ├── traefik.yml
│       └── acme.json
├── docs/                       # 문서
│   ├── prd/                   # 기획 문서 (PRD, 실행계획 포함)
│   └── logs/                  # 기록 파일
│       ├── 업무일지/          # 일일 업무일지
│       └── 기록파일/          # 프로젝트 기록
└── README.md
```

## 구현 단계

### 단계 1: 문서 폴더 통합

```bash
# 문서 폴더 구조 생성
mkdir -p docs/prd
mkdir -p docs/logs/업무일지
mkdir -p docs/logs/기록파일

# PRD 및 실행계획 파일 이동 (모두 prd 폴더로)
mv PRD/*.md docs/prd/

# 기존 업무일지 이동
mv docs/업무일지/*.md docs/logs/업무일지/ 2>/dev/null || true

# 기존 일일파일 이동 (폴더 구조 유지)
mv docs/일일파일/* docs/logs/기록파일/ 2>/dev/null || true

# 기존 폴더 정리
rmdir PRD 2>/dev/null || true
rmdir docs/업무일지 2>/dev/null || true
rmdir docs/일일파일 2>/dev/null || true
```
- **무엇을 하는가**: 분산된 문서를 용도별로 통합
- PRD와 실행계획을 docs/prd/에 함께 보관 (관련성이 높음)
- 업무일지와 기록파일을 docs/logs/ 하위에 분류
- 문서 검색과 관리가 용이해짐

### 단계 2: 인프라 폴더 분리

```bash
# 인프라 폴더 구조 생성
mkdir -p infra/docker
mkdir -p infra/nginx
mkdir -p infra/traefik

# 설정 파일 이동
mv docker-compose.yml infra/docker/
mv nginx.conf infra/nginx/
mv nginx/nginx.conf infra/nginx/nginx-detailed.conf
mv traefik.yml infra/traefik/
mv acme.json infra/traefik/

# 기존 nginx 폴더 정리
rmdir nginx
```
- **무엇을 하는가**: 인프라 설정을 루트에서 분리
- Docker, Nginx, Traefik 설정을 infra/ 하위에 통합
- 루트 디렉토리가 깔끔해지고 설정 파일 관리 용이

### 단계 3: FastAPI 백엔드 구조 개선

```
fastapi/ → backend/
```

```python
# backend/app/api/v1/users.py
from fastapi import APIRouter, Depends, HTTPException
from sqlalchemy.orm import Session
from app.api.deps import get_db
from app.core.security import verify_api_key
from app.models.user import User
from app.schemas.user import UserCreate, UserResponse, UserUpdate

router = APIRouter()

@router.post("/", response_model=UserResponse)
def create_user(
    user: UserCreate,
    db: Session = Depends(get_db),
    api_key: str = Depends(verify_api_key)
):
    existing_user = db.query(User).filter(User.email == user.email).first()
    if existing_user:
        raise HTTPException(status_code=400, detail="Email already registered")
    db_user = User(**user.dict())
    db.add(db_user)
    db.commit()
    db.refresh(db_user)
    return db_user
```
- **무엇을 하는가**: API 엔드포인트를 도메인별 라우터로 분리
- main.py의 비대화 방지
- 단일 책임 원칙(SRP) 적용으로 유지보수성 향상

```python
# backend/app/api/deps.py
from app.db.session import SessionLocal

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
```
- **무엇을 하는가**: 공통 의존성 함수를 별도 파일로 분리
- 여러 라우터에서 재사용

```python
# backend/app/main.py
from fastapi import FastAPI
from app.api.v1 import users, scores, friends, auth
from app.db.session import engine
from app.db.base import Base
from app.db.seed import seed_admin

app = FastAPI(title="Pinball API")

# 라우터 등록
app.include_router(users.router, prefix="/api/v1/users", tags=["users"])
app.include_router(scores.router, prefix="/api/v1/scores", tags=["scores"])
app.include_router(friends.router, prefix="/api/v1/friends", tags=["friends"])
app.include_router(auth.router, prefix="/api/v1", tags=["auth"])

@app.on_event("startup")
def startup():
    Base.metadata.create_all(bind=engine)
    seed_admin()
```
- **무엇을 하는가**: 엔트리포인트를 라우터 등록과 앱 설정만 담당하도록 간소화
- 각 도메인별 라우터를 include_router로 연결

### 단계 4: React 프론트엔드 구조 개선

```
react/main/ → frontend/
```

```jsx
// frontend/src/pages/Dashboard/index.jsx
import { useState } from 'react';
import DashboardLayout from '../../components/layout/DashboardLayout';
import Pinball from '../Pinball';
import UserInfo from '../UserInfo';

const Dashboard = () => {
  const [currentView, setCurrentView] = useState('main');

  const renderContent = () => {
    switch (currentView) {
      case 'pinball':
        return <Pinball />;
      case 'userinfo':
        return <UserInfo />;
      default:
        return <MainContent />;
    }
  };

  return (
    <DashboardLayout onNavigate={setCurrentView}>
      {renderContent()}
    </DashboardLayout>
  );
};

export default Dashboard;
```
- **무엇을 하는가**: 페이지 컴포넌트를 pages/ 폴더로 분리
- 레이아웃과 콘텐츠 로직 분리
- 각 페이지별 폴더에 관련 파일 통합

```jsx
// frontend/src/services/api.js
import axios from 'axios';

const API_BASE_URL = import.meta.env.VITE_API_URL || '/api';
const API_KEY = import.meta.env.VITE_API_KEY;

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// 인증이 필요한 요청용 클라이언트
export const authApiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': API_KEY,
  },
});

export default apiClient;
```
- **무엇을 하는가**: API 호출 로직을 services/ 폴더로 분리
- axios 인스턴스 공통화로 중복 제거
- 환경변수로 API URL과 키 관리

```jsx
// frontend/src/contexts/AuthContext.jsx
import { createContext, useContext, useState, useEffect } from 'react';

const AuthContext = createContext(null);

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const storedUser = localStorage.getItem('user');
    if (storedUser) {
      setUser(JSON.parse(storedUser));
    }
    setIsLoading(false);
  }, []);

  const login = (userData) => {
    setUser(userData);
    localStorage.setItem('user', JSON.stringify(userData));
  };

  const logout = () => {
    setUser(null);
    localStorage.removeItem('user');
  };

  return (
    <AuthContext.Provider value={{ user, isLoading, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
```
- **무엇을 하는가**: Context를 contexts/ 폴더로 분리
- useAuth 커스텀 훅 제공으로 사용 편의성 향상

### 단계 5: Docker Compose 경로 수정

```yaml
# infra/docker/docker-compose.yml
version: '3.8'

services:
  traefik:
    image: traefik:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ../traefik/traefik.yml:/etc/traefik/traefik.yml:ro
      - ../traefik/acme.json:/acme.json
    # ... 나머지 설정

  nginx:
    image: nginx:latest
    volumes:
      - ../nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ../../html:/usr/share/nginx/html:ro
    # ... 나머지 설정

  fastapi:
    build:
      context: ../../backend
      dockerfile: Dockerfile
    volumes:
      - ../../backend:/code
    # ... 나머지 설정
```
- **무엇을 하는가**: 폴더 구조 변경에 맞춰 Docker 볼륨 경로 수정
- 상대 경로로 각 설정 파일 연결

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| docs/prd/ | 생성 | PRD 문서 및 실행계획 폴더 |
| docs/logs/업무일지/ | 생성 | 일일 업무일지 폴더 |
| docs/logs/기록파일/ | 생성 | 프로젝트 기록파일 폴더 |
| infra/docker/ | 생성 | Docker 설정 폴더 |
| infra/nginx/ | 생성 | Nginx 설정 폴더 |
| infra/traefik/ | 생성 | Traefik 설정 폴더 |
| backend/app/api/v1/ | 생성 | API 라우터 폴더 |
| backend/app/core/ | 생성 | 핵심 설정 폴더 |
| backend/app/models/ | 생성 | ORM 모델 폴더 |
| backend/app/schemas/ | 생성 | Pydantic 스키마 폴더 |
| backend/app/db/ | 생성 | 데이터베이스 폴더 |
| frontend/src/components/ | 생성 | 재사용 컴포넌트 폴더 |
| frontend/src/pages/ | 생성 | 페이지 컴포넌트 폴더 |
| frontend/src/contexts/ | 생성 | Context 폴더 |
| frontend/src/services/ | 생성 | API 서비스 폴더 |
| infra/docker/docker-compose.yml | 수정 | 볼륨 경로 변경 |

## 단계별 진행 계획

| 단계 | 대상 | 작업 내용 | 위험도 |
|------|------|-----------|--------|
| 1단계 | 문서 | docs/ 폴더 통합 | 낮음 |
| 2단계 | 인프라 | infra/ 폴더 분리, docker-compose 수정 | 중간 |
| 3단계 | 백엔드 | FastAPI 구조 리팩토링 | 높음 |
| 4단계 | 프론트엔드 | React 구조 리팩토링 | 높음 |
| 5단계 | 통합 | 전체 테스트 및 배포 확인 | 중간 |

**권장 순서**: 1 → 2 → 3 → 4 → 5

- 1~2단계: 코드 변경 없이 파일 이동만 진행
- 3~4단계: 실제 코드 리팩토링 (한 번에 하나씩)
- 5단계: 전체 통합 테스트

## 완료 체크리스트

- [ ] docs/prd/에 PRD와 실행계획이 있다
- [ ] docs/logs/업무일지/에 업무일지가 있다
- [ ] docs/logs/기록파일/에 기록파일이 있다
- [ ] infra/ 폴더에 Docker, Nginx, Traefik 설정이 있다
- [ ] backend/app/api/v1/에 라우터 파일들이 분리되어 있다
- [ ] frontend/src/pages/에 페이지 컴포넌트가 분리되어 있다
- [ ] `docker compose up -d` 명령이 정상 실행된다
- [ ] `npm run build` 명령이 정상 실행된다
- [ ] 모든 API 엔드포인트가 정상 동작한다 (/api/docs 확인)
- [ ] 웹 페이지가 정상 표시된다 (로그인, 대시보드, 핀볼)
