# 관리자 로그인 접속 실행계획

## 요구사항 요약

**요구사항**: 로그인 페이지에서 관리자가 로그인하면 관리자 메인 페이지(/admin)로 이동시킨다.

**목적**: 일반 사용자와 관리자의 로그인 후 이동 경로를 구분하여 관리자는 관리자 페이지로, 일반 사용자는 메인 대시보드로 이동하도록 한다.

## 현재상태 분석

- Login.jsx는 로그인 성공 시 모든 사용자를 `/`(Dashboard)로 이동시킨다.
- FastAPI의 POST /api/v1/login은 LoginResponse에 `user_id`, `email`, `nickname`만 반환하고 `role` 정보는 반환하지 않는다.
- User 테이블에는 role 컬럼이 있으며 'user' 또는 'admin' 값을 저장한다.
- AuthContext는 localStorage에 사용자 정보를 저장하지만 role 정보는 저장하지 않는다.

## 구현 방법

1. FastAPI의 LoginResponse 스키마에 `role` 필드를 추가한다.
2. FastAPI의 login 엔드포인트에서 LoginResponse에 `user.role`을 포함하여 반환한다.
3. Login.jsx에서 로그인 성공 후 role을 확인하여 admin이면 `/admin`으로, 일반 사용자면 `/`로 이동한다.
4. AuthContext의 login 함수에 role 정보를 포함하여 localStorage에 저장한다.

## 구현 단계

### 1. FastAPI LoginResponse 스키마에 role 필드 추가
```python
class LoginResponse(BaseModel):
    """로그인 응답"""
    message: str
    user_id: int
    email: str
    nickname: str
    role: str  # 추가
```
- **무엇을 하는가**: 로그인 응답에 사용자 역할 정보를 포함시킨다.
- LoginResponse에 role 필드를 추가하여 프론트엔드에서 역할 정보를 받을 수 있도록 한다.

### 2. FastAPI login 엔드포인트에서 role 반환
```python
@app.post("/api/v1/login", response_model=LoginResponse)
def login(
    login_request: LoginRequest,
    db: Session = Depends(get_db)
):
    """로그인 엔드포인트 (API Key 불필요)"""
    user = db.query(User).filter(User.email == login_request.email).first()
    if user is None:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid email or password"
        )

    if user.password != login_request.password:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="Invalid email or password"
        )

    return LoginResponse(
        message="Login successful",
        user_id=user.id,
        email=user.email,
        nickname=user.nickname,
        role=user.role  # 추가
    )
```
- **무엇을 하는가**: DB에서 조회한 사용자의 role 정보를 응답에 포함시킨다.
- LoginResponse 객체 생성 시 `role=user.role`을 추가하여 사용자의 역할 정보를 반환한다.

### 3. Login.jsx에서 role 기반 페이지 이동 로직 추가
```javascript
// 확인 버튼을 눌렀을 때 실행되는 함수
const handleLogin = async () => {
  try {
    const response = await axios.post('/api/v1/login', {
      email: username,
      password: password
    });

    // 로그인 성공
    if (response.status === 200) {
      console.log('로그인 성공:', response.data);
      login({
        id: response.data.user_id,
        name: response.data.nickname,
        role: response.data.role  // 추가
      });
      setLoginError(false);

      // role 기반 페이지 이동
      if (response.data.role === 'admin') {
        navigate('/admin');  // 관리자는 관리자 페이지로
      } else {
        navigate('/');  // 일반 사용자는 대시보드로
      }
    }
  } catch (error) {
    // 로그인 실패
    setLoginError(true);
    if (error.response) {
      console.log('로그인 실패:', error.response.data.detail);
    }
  }
};
```
- **무엇을 하는가**: 로그인 성공 후 사용자의 역할에 따라 다른 페이지로 이동시킨다.
- `login()` 함수에 role 정보를 포함하여 전달한다.
- `response.data.role`이 'admin'이면 `/admin`으로, 그 외는 `/`로 이동한다.


## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| /home/hexsera/Pinball_web/fastapi/main.py | 수정 | LoginResponse 스키마에 role 필드 추가, login 엔드포인트에서 role 반환 |
| /home/hexsera/Pinball_web/react/main/src/Login.jsx | 수정 | handleLogin 함수에서 role 기반 페이지 이동 로직 추가 |

## 완료 체크리스트

- [o] 일반 사용자(role='user')로 로그인하면 `/`(Dashboard)로 이동한다.
- [o] 관리자(role='admin')로 로그인하면 `/admin`(관리자 페이지)로 이동한다.
- [o] 로그인 실패 시 에러 메시지가 표시된다.
- [o] 브라우저 콘솔에 에러가 발생하지 않는다.
