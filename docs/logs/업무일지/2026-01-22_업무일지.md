# 업무일지

## 기본 정보
- 날짜: 2026-01-22 (수)
- 작성자: hexsera

## 진행 목표
FastAPI 회원가입 엔드포인트 구현 - 범용 사용자 생성 API와 일반 회원가입 API 분리

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|

[PRD 작성]
요구사항 분석 → 초안 작성 → 사용자 피드백 반영 (스키마/DB 제거)
| 회원가입 엔드포인트 PRD 작성 | PRD/일반회원-회원가입-엔드포인트.md | POST /api/v1/users
1시간

[실행]
| Pydantic 스키마 추가 | fastapi/main.py | UserCreateRequest, UserRegisterRequest, UserResponse
| POST /api/v1/users 수정 | fastapi/main.py | role 필드 추가 (범용 엔드포인트)
5분 

[PRD 수정]
2개 엔드포인트 구조로 수정
| 회원가입 엔드포인트 PRD 작성 | PRD/일반회원-회원가입-엔드포인트.md | POST /api/v1/users, POST /api/v1/register 구조
5분


[실행 및 테스트]
POST /api/v1/users (role: admin) 테스트 성공
POST /api/v1/register (role 자동 'user') 테스트 성공
필수 필드 누락 시 422 Validation Error 확인
10분

[업무일지 작성]
15분

**총 1시간 35분**

## 주요 변경 사항

### 1. Pydantic 스키마 정의 (fastapi/main.py:15-37)

**추가:**
```python
# Pydantic 스키마
class UserCreateRequest(BaseModel):
    """범용 사용자 생성 요청 (role 포함)"""
    email: str
    nickname: str
    password: str
    birth_date: date
    role: str


class UserRegisterRequest(BaseModel):
    """일반 회원가입 요청 (role 제외)"""
    email: str
    nickname: str
    password: str
    birth_date: date


class UserResponse(BaseModel):
    """사용자 응답 (password 제외)"""
    email: str
    nickname: str
    birth_date: date
    role: str
```

**특징:**
- UserCreateRequest: role을 직접 지정 가능 (admin, user 등)
- UserRegisterRequest: role 필드 없음 (자동으로 'user' 설정)
- UserResponse: password를 응답에서 제외하여 보안 강화

### 2. POST /api/v1/users 엔드포인트 구현 (fastapi/main.py:50-58)

**변경 전:**
```python
@app.post("/api/v1/users", response_model=UserRegisterResponse)
def register_user(user: UserRegisterRequest):
    """일반 회원 회원가입 엔드포인트 (검증만 수행, DB 저장은 추후 구현)"""
    return UserRegisterResponse(
        email=user.email,
        nickname=user.nickname,
        birth_date=user.birth_date,
        role="user"
    )
```

**변경 후:**
```python
@app.post("/api/v1/users", response_model=UserResponse)
def create_user(user: UserCreateRequest):
    """범용 사용자 생성 엔드포인트 (role 지정 가능, DB 저장은 추후 구현)"""
    return UserResponse(
        email=user.email,
        nickname=user.nickname,
        birth_date=user.birth_date,
        role=user.role
    )
```

**특징:**
- role을 요청에서 받아 그대로 응답에 반환
- 관리자, 일반 사용자 등 다양한 role 지정 가능
- 함수명을 register_user → create_user로 변경하여 의도 명확화

### 3. POST /api/v1/register 엔드포인트 추가 (fastapi/main.py:61-73)

**추가:**
```python
@app.post("/api/v1/register", response_model=UserResponse)
def register_user(user: UserRegisterRequest):
    """일반 회원가입 엔드포인트 (내부적으로 create_user 호출, role='user' 고정)"""
    # UserCreateRequest 생성 (role을 'user'로 고정)
    user_create = UserCreateRequest(
        email=user.email,
        nickname=user.nickname,
        password=user.password,
        birth_date=user.birth_date,
        role="user"
    )
    # create_user 함수 호출
    return create_user(user_create)
```

**특징:**
- 일반 회원가입 전용 엔드포인트
- 내부적으로 create_user() 함수를 호출하여 코드 재사용
- role을 'user'로 고정하여 일반 사용자만 생성 가능
- 함수 간 호출을 통해 단일 책임 원칙 준수

## 아키텍처 설계

### 엔드포인트 구조

```
POST /api/v1/users (범용)
  ↑
  | 내부 호출
  |
POST /api/v1/register (일반 회원가입)
```

## 결과
- 상태: ✅ 완료

## 이전 작업과 비교
- 이전 작업
유저 CRUD 엔드 포인트 생성
1시간 15분
- 오늘 작업
회원가입 엔드 포인트 생성
1시간 20분 + 15분(업무일지)

PRD 작성시간이 너무 길었다. 일어나서 처음 하는 일이다 보니 딴짓을 하게 되더라.
아무것도 없는 곳에서 내가 만들어야 하는 구조를 예상하며 만들어야해서 상세하게 요구사항을 짜야했다. 업무일지 작성을 하다보니 업무일지 작성 시간도 생겼다.



## 다음 작업
- 로그인 엔드포인트 생성
- user CRUD 생성
