# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 9:30~10:00
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ
ì˜¤ëŠ˜ ì¼ì •ì •í•˜ê¸°

## ì§„í–‰ ë‚´ìš©
10ì‹œ - ë¦¬ë§ˆì¸ë” ì ê¸°
11ì‹œ - api ì½œ ì¡°ì‚¬í•˜ê¸°
12ì‹œ - ì ì‹¬
13ì‹œ - ëŒ€í•™êµë° ê¸°ìˆ™ì‚¬ ë“±ë¡ê¸ˆ ë‚©ë¶€
14ì‹œ - ì•ˆê²½ êµì²´
15ì‹œ - api í”„ë¡¬í”„íŠ¸ ì¡°ì‚¬í•˜ê¸°



## ê²°ê³¼

## ë°°ìš´ë‚´ìš©

---

# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 10:00 ~ 11:00
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ
ë§¨ë‚  ê¹Œë¨¹ëŠ” ë‚˜ì˜ ë‹¨ì ì„ ë³´ì™„í•  ê·œì¹™ë“¤ì„ ë§¤ì¼ ì•„ì¹¨ì— ë³¼ ìˆ˜ ìˆë„ë¡
ì •ë¦¬í•´ì„œ ì‘ì„±í•œë‹¤.

## ì§„í–‰ ë‚´ìš©
"ì•„ì¹¨ ë¦¬ë§ˆì¸ë”" ì—‘ì…€ í‘œ ìƒì„±
6ê°œ ì •ë¦¬í•¨

## ê²°ê³¼



## ë°°ìš´ë‚´ìš©
ë­ê°€ ìˆëŠ”ì§€ ì¼ë‹¨ ì ì–´ë³¸ë‹¤.
ìš”ì¦˜ ì•ˆê±´ë° ì¢…ì´ë¡œ ì ìœ¼ë©´ ì»´í“¨í„°ë¡œ ì ëŠ”ê±°ë³´ë‹¤ ìƒê°ì´ ë” ì˜ë˜ëŠ” ëŠë‚Œì´ë‹¤.
íœ´... ì§‘ì¤‘ì´ ì•ˆëœë‹¤. ê³„ì† ë”´ê²ƒì´ ë³´ê³ ì‹¶ì–´...
ì¼ë‹¨ ë§ˆë¬´ë¦¬. 20ë¶„ ê°€ëŸ‰ ë‚­ë¹„ëœ ëŠë‚Œì´ë‹¤..





# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 11:15~12:00
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ

Gemini APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì±„íŒ… í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë°±ì—”ë“œì— ì¶”ê°€í•œë‹¤. ì‚¬ìš©ìê°€ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ Gemini ëª¨ë¸ì˜ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” `POST /api/v1/chat` ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬í˜„í•œë‹¤.

## ì§„í–‰ ë‚´ìš©

| ì‘ì—… | ìˆ˜ì • íŒŒì¼ | ë¹„ê³  |
|------|----------|------|
| ì‹¤í–‰ê³„íš ì‘ì„± | `PRD/gemini-api-chat-ì‹¤í–‰ê³„íš.md` | ì‹ ê·œ ìƒì„± |
| Gemini ëª¨ë¸ ë³€ê²½ | `PRD/gemini-api-chat-ì‹¤í–‰ê³„íš.md` | `gemini-pro` â†’ `gemini-2.0-flash` (ë¬´ë£Œ í‹°ì–´) |
| GEMINI_API_KEY í™˜ê²½ë³€ìˆ˜ ì¶”ê°€ | `backend/.env` | API Key ë“±ë¡ |
| GEMINI_API_KEY í…œí”Œë¦¿ ì¶”ê°€ | `backend/.env.example` | ë¹ˆ ê°’ìœ¼ë¡œ ë¬¸ì„œí™” |
| GEMINI_API_KEY ì„¤ì • í•„ë“œ ì¶”ê°€ | `backend/app/core/config.py` | Settings í´ë˜ìŠ¤ í™•ì¥ |
| ChatRequest/ChatResponse ìŠ¤í‚¤ë§ˆ ìƒì„± | `backend/app/schemas/chat.py` | ì‹ ê·œ ìƒì„± |
| ì±„íŒ… ë¼ìš°í„° ìƒì„± | `backend/app/api/v1/chat.py` | ì‹ ê·œ ìƒì„±, Gemini REST API í˜¸ì¶œ |
| ë¼ìš°í„° ë“±ë¡ | `backend/main.py` | `/api/v1/chat` ê²½ë¡œë¡œ ì—°ê²° |
| Docker ì»¨í…Œì´ë„ˆ ì¬ë¹Œë“œ | â€” | `docker compose up -d --build fastapi` |
| ë™ì‘ í…ŒìŠ¤íŠ¸ ë° ì˜¤ë¥˜ ì›ì¸ ë¶„ì„ | â€” | API Key í• ë‹¹ëŸ‰ ë¬¸ì œ í™•ì¸ |

## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. backend/.env ìˆ˜ì •

**ë³€ê²½ ì „:**
```bash
ADMIN_BIRTH_DATE=2000-01-01
```

**ë³€ê²½ í›„:**
```bash
ADMIN_BIRTH_DATE=2000-01-01

# Gemini API
GEMINI_API_KEY=AIzaSyBxYvwQC20gr4wT2Q0BQAaSVUk_-Ezm5us
```

**íŠ¹ì§•:**
- API Keyë¥¼ ì½”ë“œì— í•˜ë“œì½”ë”©í•˜ì§€ ì•Šê³  í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬

---

### 2. backend/app/core/config.py ìˆ˜ì •

**ë³€ê²½ ì „:**
```python
    ADMIN_BIRTH_DATE: str = os.getenv("ADMIN_BIRTH_DATE")

settings = Settings()
```

**ë³€ê²½ í›„:**
```python
    ADMIN_BIRTH_DATE: str = os.getenv("ADMIN_BIRTH_DATE")

    # Gemini API
    GEMINI_API_KEY: str = os.getenv("GEMINI_API_KEY")

settings = Settings()
```

**íŠ¹ì§•:**
- ì•± ì „ì²´ì—ì„œ `settings.GEMINI_API_KEY`ë¡œ ì ‘ê·¼ ê°€ëŠ¥

---

### 3. backend/app/schemas/chat.py ìƒì„±

**ì¶”ê°€:**
```python
from pydantic import BaseModel

class ChatRequest(BaseModel):
    message: str

class ChatResponse(BaseModel):
    reply: str
```

**íŠ¹ì§•:**
- `message`: ì‚¬ìš©ì ì…ë ¥ í…ìŠ¤íŠ¸
- `reply`: Gemini ì‘ë‹µ í…ìŠ¤íŠ¸
- Pydantic ìŠ¤í‚¤ë§ˆë¡œ ìë™ ìœ íš¨ì„± ê²€ì¦ ë° `/docs` ìë™ ë¬¸ì„œí™”

---

### 4. backend/app/api/v1/chat.py ìƒì„±

**ì¶”ê°€:**
```python
import httpx
from fastapi import APIRouter, HTTPException
from app.core.config import settings
from app.schemas.chat import ChatRequest, ChatResponse

router = APIRouter()

GEMINI_URL = (
    "https://generativelanguage.googleapis.com/v1beta/models/"
    "gemini-2.0-flash:generateContent"
)

@router.post("/chat", response_model=ChatResponse)
def chat(request: ChatRequest):
    payload = {
        "contents": [{"parts": [{"text": request.message}]}]
    }
    params = {"key": settings.GEMINI_API_KEY}
    with httpx.Client(timeout=30) as client:
        res = client.post(GEMINI_URL, json=payload, params=params)
    if res.status_code != 200:
        raise HTTPException(status_code=502, detail="Gemini API í˜¸ì¶œ ì‹¤íŒ¨")
    data = res.json()
    reply = data["candidates"][0]["content"]["parts"][0]["text"]
    return ChatResponse(reply=reply)
```

**íŠ¹ì§•:**
- ì¶”ê°€ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì—†ì´ ê¸°ì¡´ `httpx`ë¡œ Gemini REST API ì§ì ‘ í˜¸ì¶œ
- ë¬´ë£Œ ëª¨ë¸ `gemini-2.0-flash` ì‚¬ìš©
- Gemini ì˜¤ë¥˜ ì‹œ HTTP 502 ë°˜í™˜

---

### 5. backend/main.py ìˆ˜ì •

**ë³€ê²½ ì „:**
```python
from app.api.v1 import users, auth, monthly_scores, game_visits, friends
...
app.include_router(friends.router, prefix="/api/friend-requests", tags=["Friends"])
```

**ë³€ê²½ í›„:**
```python
from app.api.v1 import users, auth, monthly_scores, game_visits, friends, chat
...
app.include_router(friends.router, prefix="/api/friend-requests", tags=["Friends"])
app.include_router(chat.router, prefix="/api/v1", tags=["Chat"])
```

**íŠ¹ì§•:**
- `POST /api/v1/chat` ê²½ë¡œë¡œ ì±„íŒ… ì—”ë“œí¬ì¸íŠ¸ ë…¸ì¶œ

---

### ìš”ì²­ íë¦„

```
í´ë¼ì´ì–¸íŠ¸ POST /api/v1/chat
        {"message": "ì•ˆë…•"}
             â”‚
             â–¼
      FastAPI (chat.py)
             â”‚
             â–¼ HTTP POST (httpx)
  Gemini REST API (gemini-2.0-flash)
             â”‚
             â–¼
      FastAPI ì‘ë‹µ ë°˜í™˜
        {"reply": "..."}
```

## ê²°ê³¼
- ìƒíƒœ: ë³´ë¥˜

ì½”ë“œ êµ¬í˜„ ë° Docker ë°°í¬ëŠ” ì™„ë£Œë˜ì—ˆìœ¼ë‚˜, PRDì— ëª…ì‹œëœ API Key(`AIzaSyB...`)ì˜ Google Cloud í”„ë¡œì íŠ¸ì—ì„œ **ë¬´ë£Œ í‹°ì–´ í• ë‹¹ëŸ‰ì´ 0**ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ì‹¤ì œ í˜¸ì¶œì´ ë¶ˆê°€ëŠ¥í•œ ìƒíƒœ.
(`limit: 0` â€” í”„ë¡œì íŠ¸ì— Gemini APIê°€ í™œì„±í™”ë˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ íŒë‹¨)

## ë°°ìš´ë‚´ìš©


## ë‹¤ìŒ ì‘ì—…
- [Google AI Studio](https://aistudio.google.com/apikey)ì—ì„œ ìƒˆ API Key ë°œê¸‰
- `backend/.env`ì˜ `GEMINI_API_KEY` ê°’ êµì²´ í›„ `docker compose restart fastapi`ë¡œ ì¬ì‹œì‘
- `POST /api/v1/chat` ì‹¤ì œ ì‘ë‹µ í™•ì¸ ë° ì²´í¬ë¦¬ìŠ¤íŠ¸ ì™„ë£Œ ì²˜ë¦¬

---

# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 15:10~15:33
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ


## ì§„í–‰ ë‚´ìš©

ë°˜ê°‘ìŠµë‹ˆë‹¤! Gemini APIë¥¼ í”„ë¡œê·¸ë¨ì— ì—°ê²°í•˜ì‹œë ¤ëŠ”êµ°ìš”. 2026ë…„ í˜„ì¬, GeminiëŠ” ì„±ëŠ¥ê³¼ ë¹„ìš© ë©´ì—ì„œ ë§¤ìš° ê°•ë ¥í•œ ì„ íƒì§€ì…ë‹ˆë‹¤.

API í‚¤ë¥¼ ë°œê¸‰ë°›ê³  ì½”ë”©ì„ ì‹œì‘í•˜ê¸° ì „ì—, **ê°œë°œìë¡œì„œ ë°˜ë“œì‹œ ì•Œê³  ìˆì–´ì•¼ í•  í•µì‹¬ í¬ì¸íŠ¸ 5ê°€ì§€**ë¥¼ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.

---

### 1. API í‚¤ ë°œê¸‰ê³¼ ë³´ì•ˆ (ê°€ì¥ ê¸°ë³¸!)

API í‚¤ëŠ” **[Google AI Studio](https://aistudio.google.com/)**ì—ì„œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì—¬ê¸°ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€ **ë³´ì•ˆ**ì…ë‹ˆë‹¤.

* **í•˜ë“œì½”ë”© ê¸ˆì§€:** ì½”ë“œ ì•ˆì— API í‚¤ë¥¼ ì§ì ‘ ì ì§€ ë§ˆì„¸ìš”. `.env` íŒŒì¼ì— ì €ì¥í•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
* **GitHub ì£¼ì˜:** í‚¤ê°€ í¬í•¨ëœ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ GitHub public ì €ì¥ì†Œì— ì˜¬ë¦¬ë©´ ìˆœì‹ê°„ì— í„¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (êµ¬ê¸€ì´ ìë™ìœ¼ë¡œ ê°ì§€í•´ ì°¨ë‹¨í•˜ê¸°ë„ í•˜ì§€ë§Œ, ì¡°ì‹¬í•´ì„œ ë‚˜ì  ê²ƒ ì—†ì£ .)

### 2. ë¬´ë£Œ í‹°ì–´(Free Tier)ì˜ 'ë¹„ë°€'

Gemini APIëŠ” ë¬´ë£Œë¡œë„ ê½¤ ë„‰ë„‰í•œ ì–‘ì„ ì œê³µí•˜ì§€ë§Œ, ê³µì§œì—ëŠ” ëŒ€ê°€ê°€ ìˆìŠµë‹ˆë‹¤.

* **ë°ì´í„° í•™ìŠµ í™œìš©:** ë¬´ë£Œ í‹°ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¹ì‹ ì´ ì…ë ¥í•œ í”„ë¡¬í”„íŠ¸ì™€ ëª¨ë¸ì˜ ë‹µë³€ì„ **êµ¬ê¸€ì´ ì„œë¹„ìŠ¤ ê°œì„ (í•™ìŠµ)ì„ ìœ„í•´ ì‚¬ìš©**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë¯¼ê°í•œ ê°œì¸ì •ë³´ë‚˜ ê¸°ì—… ë¹„ë°€ì„ ë‹¤ë£¬ë‹¤ë©´ ë°˜ë“œì‹œ **ìœ ë£Œ í‹°ì–´(Pay-as-you-go)**ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ìœ ë£Œ í‹°ì–´ì˜ ë°ì´í„°ëŠ” í•™ìŠµì— ì‚¬ìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
* **ë¶„ë‹¹ í˜¸ì¶œ ì œí•œ (RPM):** ë¬´ë£Œ ë²„ì „ì€ ì†ë„ ì œí•œì´ ìˆìœ¼ë‹ˆ, ì„œë¹„ìŠ¤ ì¶œì‹œ ì „ì´ë¼ë©´ ìœ ë£Œ ì „í™˜ì„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.

### 3. ëª¨ë¸ ì„ íƒ: Pro vs. Flash

í˜„ì¬ ê°€ì¥ ë§ì´ ì“°ì´ëŠ” ëª¨ë¸ì€ ë‘ ê°€ì§€ì…ë‹ˆë‹¤. ìš©ë„ì— ë§ê²Œ ê³¨ë¼ë³´ì„¸ìš”.

| ëª¨ë¸ | íŠ¹ì§• | ì¶”ì²œ ìš©ë„ |
| --- | --- | --- |
| **Gemini 3 Flash** | **ì†ë„**ê°€ ì••ë„ì ìœ¼ë¡œ ë¹ ë¥´ê³  ë¹„ìš©ì´ ë§¤ìš° ì €ë ´í•¨. | ë‹¨ìˆœ ì±„íŒ…, ìš”ì•½, ì‹¤ì‹œê°„ ì‘ë‹µ, ë²ˆì—­ |
| **Gemini 3 Pro** | **ì¶”ë¡  ëŠ¥ë ¥**ê³¼ ë³µì¡í•œ ë¬¸ì œ í•´ê²° ëŠ¥ë ¥ì´ ë›°ì–´ë‚¨. | ë³µì¡í•œ ì½”ë”©, ë…¼ë¦¬ì  ë¶„ì„, ê¸´ ë¬¸ì„œ ë¶„ì„ |

> **íŒ:** 2026ë…„ ê¸°ì¤€, **Flash ëª¨ë¸**ì˜ ì„±ëŠ¥ì´ ì›¬ë§Œí•œ ì´ì „ ì„¸ëŒ€ Pro ëª¨ë¸ì„ ì••ë„í•  ì •ë„ë¡œ ì¢‹ì•„ì¡ŒìŠµë‹ˆë‹¤. ì¼ë‹¨ Flashë¡œ ì‹œì‘í•´ë³´ì„¸ìš”!

### 4. ì‹œìŠ¤í…œ ëª…ë ¹ì–´ (System Instruction)

ëª¨ë¸ì˜ 'ì„±ê²©'ì´ë‚˜ 'ì—­í• 'ì„ ì •í•  ë•Œ í”„ë¡¬í”„íŠ¸ ì•ì— ë§¤ë²ˆ "ë„ˆëŠ” ì½”ë”© ì „ë¬¸ê°€ì•¼"ë¼ê³  ì ì§€ ë§ˆì„¸ìš”. API ì„¤ì • ë‹¨ê³„ì—ì„œ `system_instruction` ê°’ì„ ì£¼ë©´ ëª¨ë¸ì´ ê·¸ ì—­í• ì„ í›¨ì”¬ ë” ì˜ ìœ ì§€í•©ë‹ˆë‹¤.

### 5. êµ¬ì¡°í™”ëœ ë°ì´í„° ë°›ê¸° (JSON Mode)

í”„ë¡œê·¸ë¨ì—ì„œ ë‹µë³€ì„ í™œìš©í•˜ë ¤ë©´ í…ìŠ¤íŠ¸ë³´ë‹¤ëŠ” **JSON í˜•ì‹**ìœ¼ë¡œ ë°›ëŠ” ê²Œ ìœ ë¦¬í•©ë‹ˆë‹¤. í”„ë¡¬í”„íŠ¸ ë§ˆì§€ë§‰ì— "JSON í˜•íƒœë¡œ ë‹µí•´ì¤˜"ë¼ê³  í•˜ëŠ” ê²ƒë³´ë‹¤, API ì„¤ì •ì—ì„œ `response_mime_type: "application/json"`ì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ í›¨ì”¬ ì •í™•í•©ë‹ˆë‹¤.

---

### ğŸ› ï¸ ë°”ë¡œ ì¨ë¨¹ëŠ” Python ì˜ˆì‹œ ì½”ë“œ

API í‚¤ë¥¼ ë°›ì•˜ë‹¤ë©´ ì•„ë˜ì²˜ëŸ¼ ê°„ë‹¨íˆ ì—°ê²°í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```python
import google.generativeai as genai
import os

# í™˜ê²½ ë³€ìˆ˜ì—ì„œ í‚¤ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤
genai.configure(api_key="YOUR_GEMINI_API_KEY")

# ëª¨ë¸ ì„¤ì • (Flashê°€ ê°€ì„±ë¹„ ê°‘!)
model = genai.GenerativeModel(
    model_name="gemini-3-flash",
    system_instruction="ë„ˆëŠ” ì¹œì ˆí•˜ê³  ìœ„íŠ¸ ìˆëŠ” íŒŒì´ì¬ ê°œë°œ ì „ë¬¸ê°€ì•¼."
)

response = model.generate_content("Gemini APIë¥¼ ì—°ê²°í–ˆëŠ”ë° ì²« ì¸ì‚¬ë¥¼ í•´ì¤˜!")
print(response.text)

```

---



## ê²°ê³¼



## ë°°ìš´ë‚´ìš©
ì—­í™œ ì£¼ëŠ” í”„ë¡¬í”„íŠ¸ê°€ system_instruction ì¸ê°€ ë³´ë‹¤.
gemini sdk ë¥¼ ì‚¬ìš©í•´ë³´ë©´ì„œ ì•Œì•„ë´ì•¼ê² ë‹¤.



---


# ì—…ë¬´ì¼ì§€ 

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 15:40~16:50
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ

1ì°¨ ì‘ì—…ì—ì„œ httpx REST API ì§ì ‘ í˜¸ì¶œë¡œ êµ¬í˜„ëœ chat.pyë¥¼ **google-genai ê³µì‹ SDK** ë°©ì‹ìœ¼ë¡œ ì „í™˜í•œë‹¤.
ì¶”ê°€ë¡œ í˜„ì¬ API í‚¤ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ Gemini ëª¨ë¸ ëª©ë¡ì„ ë°˜í™˜í•˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ êµ¬í˜„í•œë‹¤.

## ì§„í–‰ ë‚´ìš©

| ì‘ì—… | ìˆ˜ì • íŒŒì¼ | ë¹„ê³  |
|------|----------|------|
| ì‹¤í–‰ê³„íš SDK ë°©ì‹ìœ¼ë¡œ ìˆ˜ì • | `PRD/Gemini-AI-í•€ë³¼ëŒ€ê²°-ì±„íŒ…-ì‹¤í–‰ê³„íš.md` | httpx â†’ google-genai SDK |
| google-genai íŒ¨í‚¤ì§€ ì¶”ê°€ | `backend/requirements.txt` | Gemini ê³µì‹ Python SDK |
| chat.py SDK ë°©ì‹ìœ¼ë¡œ ì „ë©´ êµì²´ | `backend/app/api/v1/chat.py` | ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸(ì—­í•  ë¶€ì—¬) í¬í•¨ |
| ëª¨ë¸ ëª©ë¡ API ì¶”ê°€ | `backend/app/api/v1/chat.py` | `GET /api/v1/chat/models` |
| Docker ì»¨í…Œì´ë„ˆ ì¬ë¹Œë“œ | â€” | `docker compose up -d --build fastapi` |
| ë™ì‘ í…ŒìŠ¤íŠ¸ | â€” | ëª¨ë¸ ëª©ë¡ API ì •ìƒ ì‘ë‹µ í™•ì¸ |


## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. backend/requirements.txt ìˆ˜ì •

**ë³€ê²½ ì „:**
```text
Faker==24.0.0
```

**ë³€ê²½ í›„:**
```text
Faker==24.0.0
google-genai
```

**íŠ¹ì§•:**
- `google-genai`ëŠ” Googleì—ì„œ ê³µì‹ ë°°í¬í•˜ëŠ” Gemini Python SDK íŒ¨í‚¤ì§€
- Docker ì´ë¯¸ì§€ ë¹Œë“œ ì‹œ ìë™ ì„¤ì¹˜ë¨

---

### 2. backend/app/api/v1/chat.py ì „ë©´ êµì²´

**ë³€ê²½ ì „ (httpx REST ë°©ì‹):**
```python
import httpx
from fastapi import APIRouter, HTTPException
from app.core.config import settings
from app.schemas.chat import ChatRequest, ChatResponse

router = APIRouter()

GEMINI_URL = (
    "https://generativelanguage.googleapis.com/v1beta/models/"
    "gemini-2.0-flash:generateContent"
)

@router.post("/chat", response_model=ChatResponse)
def chat(request: ChatRequest):
    payload = {
        "contents": [{"parts": [{"text": request.message}]}]
    }
    params = {"key": settings.GEMINI_API_KEY}
    with httpx.Client(timeout=30) as client:
        res = client.post(GEMINI_URL, json=payload, params=params)
    if res.status_code != 200:
        raise HTTPException(status_code=502, detail="Gemini API í˜¸ì¶œ ì‹¤íŒ¨")
    data = res.json()
    reply = data["candidates"][0]["content"]["parts"][0]["text"]
    return ChatResponse(reply=reply)
```

**ë³€ê²½ í›„ (google-genai SDK ë°©ì‹):**
```python
from google import genai
from google.genai import types
from fastapi import APIRouter, HTTPException
from app.core.config import settings
from app.schemas.chat import ChatRequest, ChatResponse

router = APIRouter()

SYSTEM_PROMPT = (
    "ë„ˆëŠ” í•€ë³¼ ê²Œì„ì—ì„œ ì‚¬ìš©ìì™€ ëŒ€ê²° ì¤‘ì¸ AI ìƒëŒ€ë°©ì´ë‹¤. "
    "ê²½ìŸì ì…ì¥ì—ì„œ ì§§ê³  ë„ë°œì ì´ê±°ë‚˜ ì¹œê·¼í•˜ê²Œ ëŒ€í™”í•œë‹¤. "
    "í•€ë³¼ ì ìˆ˜, ê²Œì„ ì „ëµ, ìŠ¹ë¶€ì— ê´€í•œ ì´ì•¼ê¸°ë¥¼ í•œë‹¤. "
    "í•œêµ­ì–´ë¡œ ëŒ€í™”í•˜ë©°, ê²Œì„ ì™¸ ì£¼ì œëŠ” í•€ë³¼ ëŒ€ê²°ë¡œ ëŒë ¤ì„œ ë‹µí•œë‹¤."
)

@router.get("/chat/models")
def list_models():
    client = genai.Client(api_key=settings.GEMINI_API_KEY)
    models = [m.name for m in client.models.list()]
    return {"models": models}

@router.post("/chat", response_model=ChatResponse)
def chat(request: ChatRequest):
    client = genai.Client(api_key=settings.GEMINI_API_KEY)
    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=request.message,
        config=types.GenerateContentConfig(
            system_instruction=SYSTEM_PROMPT,
        ),
    )
    return ChatResponse(reply=response.text)
```

**íŠ¹ì§•:**
- `genai.Client(api_key=...)` ë¡œ SDK í´ë¼ì´ì–¸íŠ¸ ìƒì„± â€” URL, í—¤ë” ë“± ì €ìˆ˜ì¤€ ì²˜ë¦¬ë¥¼ SDKê°€ ë‹´ë‹¹
- `types.GenerateContentConfig(system_instruction=...)` ìœ¼ë¡œ AIì—ê²Œ "í•€ë³¼ ëŒ€ê²° ìƒëŒ€ë°©" ì—­í•  ë¶€ì—¬
- `GET /api/v1/chat/models` â€” API í‚¤ë¡œ ì ‘ê·¼ ê°€ëŠ¥í•œ ì „ì²´ ëª¨ë¸ ëª©ë¡ ë°˜í™˜
- httpx, GEMINI_URL ë“± REST ê´€ë ¨ ì½”ë“œ ì œê±°

---

### ìš”ì²­ íë¦„ (ë³€ê²½ í›„)

```
í´ë¼ì´ì–¸íŠ¸ POST /api/v1/chat
        {"message": "ì•ˆë…•"}
             â”‚
             â–¼
      FastAPI (chat.py)
      genai.Client ìƒì„±
             â”‚
             â–¼  SDK ë‚´ë¶€ ì²˜ë¦¬
      Gemini API (gemini-2.5-flash)
      system_instruction ì ìš©
             â”‚
             â–¼
      FastAPI ì‘ë‹µ ë°˜í™˜
        {"reply": "..."}
```

## ê²°ê³¼
- ìƒíƒœ: ë¶€ë¶„ ì™„ë£Œ

`GET /api/v1/chat/models` ì •ìƒ ë™ì‘ í™•ì¸ (43ê°œ ëª¨ë¸ ëª©ë¡ ë°˜í™˜).
`POST /api/v1/chat`ì€ API í‚¤ì˜ `gemini-2.5-flash` quota ë¬¸ì œë¡œ ë¯¸í™•ì¸ ìƒíƒœ.

## ë°°ìš´ë‚´ìš©
api key ë¬´ë£Œë²„ì „ í† í°ì—†ë‹¤ê³  í•˜ëŠ”ë°, gemini flash 2.0 ì„ gemini flash 2.5 ë¡œ ë°”ê¾¸ë‹ˆ í•´ê²°ëë‹¤. 2.0 ë„ ì‚¬ìš© ëª¨ë¸ì— ìˆëŠ”ë° ë¬´ë£Œ api ì—ì„œëŠ” ì§€ì› ì•ˆí•´ì£¼ë‚˜ë³´ë‹¤.

## ë‹¤ìŒ ì‘ì—…
- API í‚¤ quota ë¬¸ì œ í•´ê²° í›„ `POST /api/v1/chat` ì‹¤ì œ ì‘ë‹µ í™•ì¸
- í”„ë¡ íŠ¸ì—”ë“œ ì±„íŒ…ì°½ì— `/api/v1/chat` ì—”ë“œí¬ì¸íŠ¸ ì—°ê²°

---

# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 17:10~17:30
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ
ìœ ì €ëŠ” ì–´ë–¤ ë°ì´í„°ë¥¼ ë°›ëŠ”ê°€?

## ì§„í–‰ ë‚´ìš©
{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "video_metadata": null,
            "thought": null,
            "code_execution_result": null,
            "executable_code": null,
            "file_data": null,
            "function_call": null,
            "function_response": null,
            "inline_data": null,
            "text": "ë°˜ê°€ì›Œ! í•˜ì§€ë§Œ ì¸ì‚¬ëŠ” ì§§ê²Œ. í”Œë¦¬í¼ê°€ ë‚´ ì†ì— ë‹¿ëŠ” ìˆœê°„, ë„ˆì™€ ë‚˜ì˜ ì ìˆ˜ ì°¨ì´ëŠ” ì ì  ë²Œì–´ì§ˆ ê±°ì•¼. ë²Œì¨ë¶€í„° ë‚´ ë©€í‹°ë³¼ ì „ëµì´ ê¶ê¸ˆí•œ ëª¨ì–‘ì´êµ°? ğŸ˜‰"
          }
        ],
        "role": "model"
      },
      "citation_metadata": null,
      "finish_message": null,
      "token_count": null,
      "avg_logprobs": null,
      "finish_reason": "STOP",
      "grounding_metadata": null,
      "index": 0,
      "logprobs_result": null,
      "safety_ratings": null
    }
  ],
  "model_version": "gemini-2.5-flash",
  "prompt_feedback": null,
  "usage_metadata": {
    "cached_content_token_count": null,
    "candidates_token_count": 51,
    "prompt_token_count": 76,
    "total_token_count": 539
  },
  "automatic_function_calling_history": [],
  "parsed": null
}

Gemini APIë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ë§ˆì£¼í•˜ê²Œ ë˜ëŠ” ì´ JSON êµ¬ì¡°ëŠ” ì²˜ìŒì—” ë³µì¡í•´ ë³´ì´ì§€ë§Œ, í•µì‹¬ë§Œ ì•Œë©´ ì•„ì£¼ ë…¼ë¦¬ì ì…ë‹ˆë‹¤. ê° í‚¤(Key)ê°€ ì–´ë–¤ ì—­í• ì„ í•˜ëŠ”ì§€ ì•Œê¸° ì‰½ê²Œ ì •ë¦¬í•´ ë“œë¦´ê²Œìš”.

---

## 1. ìµœìƒìœ„ êµ¬ì¡° (Root Keys)

* **`candidates`**: ëª¨ë¸ì´ ìƒì„±í•œ ì‘ë‹µ í›„ë³´ë“¤ì˜ ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œëŠ” í•˜ë‚˜ë§Œ ìƒì„±ë˜ì§€ë§Œ, ì„¤ì •ì— ë”°ë¼ ì—¬ëŸ¬ ê°œì˜ ë‹µë³€ í›„ë³´ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **`model_version`**: ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ë° ì‚¬ìš©ëœ ëª¨ë¸ì˜ êµ¬ì²´ì ì¸ ë²„ì „(ì˜ˆ: gemini-2.0-flash)ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
* **`usage_metadata`**: ì´ë²ˆ ìš”ì²­ì—ì„œ ì‚¬ìš©ëœ **í† í°(Token) ì‚¬ìš©ëŸ‰** ì •ë³´ì…ë‹ˆë‹¤. ë¹„ìš© ê³„ì‚°ì´ë‚˜ ì œí•œ ì‚¬í•­ í™•ì¸ì— í•„ìˆ˜ì ì´ì£ .
* **`prompt_feedback`**: ì…ë ¥í•œ í”„ë¡¬í”„íŠ¸ê°€ ì•ˆì „ ì •ì±…ì— ê±¸ë ¸ëŠ”ì§€ ë“± í”„ë¡¬í”„íŠ¸ ìì²´ì— ëŒ€í•œ í”¼ë“œë°±ì…ë‹ˆë‹¤. ë¬¸ì œê°€ ì—†ìœ¼ë©´ ë³´í†µ `null`ì…ë‹ˆë‹¤.

---

## 2. `candidates` ë‚´ë¶€ ìƒì„¸

ê°€ì¥ ì¤‘ìš”í•œ ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ” ê³³ì…ë‹ˆë‹¤.

* **`content`**: ëª¨ë¸ì´ ë§Œë“  ì‹¤ì œ ë‚´ìš©ì…ë‹ˆë‹¤.
* **`parts`**: ì‘ë‹µ ë³¸ë¬¸ì…ë‹ˆë‹¤. GeminiëŠ” ë©€í‹°ëª¨ë‹¬ ëª¨ë¸ì´ë¼ í…ìŠ¤íŠ¸ ì™¸ì— ì´ë¯¸ì§€, í•¨ìˆ˜ í˜¸ì¶œ ë“±ì„ ë‹´ì„ ìˆ˜ ìˆì–´ ë¦¬ìŠ¤íŠ¸ í˜•íƒœë¥¼ ë±ë‹ˆë‹¤.
* **`text`**: ìš°ë¦¬ê°€ í”íˆ ë³´ëŠ” **ì‹¤ì œ ë‹µë³€ ë¬¸ìì—´**ì…ë‹ˆë‹¤.


* **`role`**: ì´ ë©”ì‹œì§€ì˜ ì£¼ì²´ì…ë‹ˆë‹¤. ëª¨ë¸ì˜ ì‘ë‹µì´ë¯€ë¡œ `"model"`ë¡œ í‘œì‹œë©ë‹ˆë‹¤.


* **`finish_reason`**: ìƒì„±ì´ ë©ˆì¶˜ ì´ìœ ì…ë‹ˆë‹¤. `"STOP"`ì€ ë‹µë³€ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤. (ê¸€ì ìˆ˜ ì œí•œ ë“±ìœ¼ë¡œ ëŠê¸°ë©´ ë‹¤ë¥¸ ê°’ì´ ë“¤ì–´ì˜µë‹ˆë‹¤.)
* **`safety_ratings`**: ì„±í¬ë¡±, í˜ì˜¤ í‘œí˜„ ë“± ìœ í•´ì„± í•­ëª©ì— ëŒ€í•œ ì•ˆì „ ë“±ê¸‰ ê²°ê³¼ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.
* **`grounding_metadata`**: êµ¬ê¸€ ê²€ìƒ‰ ë“± ì™¸ë¶€ ì§€ì‹ì„ ì°¸ê³ í–ˆì„ ë•Œ ê·¸ ì¶œì²˜(Source) ì •ë³´ê°€ ë‹´ê¹ë‹ˆë‹¤.

---

## 3. `usage_metadata` (í† í° ì •ë³´)

| í•­ëª© | ì„¤ëª… |
| --- | --- |
| **`prompt_token_count`** | ë‚´ê°€ ë³´ë‚¸ ì§ˆë¬¸(í”„ë¡¬í”„íŠ¸)ì˜ í† í° ìˆ˜ |
| **`candidates_token_count`** | ëª¨ë¸ì´ ìƒì„±í•œ ë‹µë³€ì˜ í† í° ìˆ˜ |
| **`total_token_count`** | ì´ë²ˆ ìš”ì²­ì—ì„œ ì†Œëª¨ëœ ì´ í† í° í•©ê³„ |

---

## 4. ê¸°íƒ€ íŠ¹ìˆ˜ í•„ë“œ

* **`thought`**: ëª¨ë¸ì˜ ì¶”ë¡  ê³¼ì •(ìƒê° ì²´ì¸)ì´ í¬í•¨ë  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
* **`executable_code` / `code_execution_result**`: ëª¨ë¸ì´ ì§ì ‘ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ì‹¤í–‰í–ˆì„ ë•Œ ê·¸ ì½”ë“œì™€ ì‹¤í–‰ ê²°ê³¼ê°€ ë‹´ê¹ë‹ˆë‹¤.
* **`function_call`**: ëª¨ë¸ì´ ì™¸ë¶€ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•´ë‹¬ë¼ê³  ìš”ì²­í•  ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤.

---

> **Tip:** ë³´í†µ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” `response.candidates[0].content.parts[0].text` ê²½ë¡œë¥¼ í†µí•´ ë‹µë³€ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œí•´ì„œ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.


## ê²°ê³¼

## ë°°ìš´ë‚´ìš©
gemini ëŠ” ë©€í‹°ëª¨ë‹¬ ëª¨ë¸ì´ë¼ í…ìŠ¤íŠ¸ ì´ì™¸ì— ì´ë¯¸ì§€, í•¨ìˆ˜, ë™ì˜ìƒ, íŒŒì¼ ë“±ì„ ë‚˜ì—ê²Œ ë³´ë‚´ì¤„ ìˆ˜ ìˆë‹¤.
ì¤‘ìš”í•œê±´ text ì´ë‹¤. ì´ text ì—ì„œ í…ìŠ¤íŠ¸ ë°ì´í„°ê°€ ë‚ ë¼ì˜¨ë‹¤.


---

# ì—…ë¬´ì¼ì§€ (3ì°¨)

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 17:30~18:30
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ

ì±„íŒ… APIì— ë©€í‹°í„´ ëŒ€í™”(ì´ì „ ëŒ€í™” ë‚´ìš© ê¸°ì–µ) ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤.
`client.chats.create()`ë¡œ ì„¸ì…˜ì„ ìƒì„±í•˜ê³ , `chat_id`ë¡œ ì„¸ì…˜ì„ ì‹ë³„í•´ ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ ìœ ì§€í•œë‹¤.
ë””ë²„ê·¸ ëª©ì ìœ¼ë¡œ `response.model_dump()`ë¡œ Gemini ì‘ë‹µ ì „ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ì„ì‹œ ì—”ë“œí¬ì¸íŠ¸ë„ ì¶”ê°€í•œë‹¤.

## ì§„í–‰ ë‚´ìš©

| ì‘ì—… | ìˆ˜ì • íŒŒì¼ | ë¹„ê³  |
|------|----------|------|
| ë””ë²„ê·¸ìš© response ì „ì²´ ë°˜í™˜ | `backend/app/api/v1/chat.py` | `response_model` ì œê±°, `model_dump()` ë°˜í™˜ |
| ChatRequestì— chat_id ì¶”ê°€ | `backend/app/schemas/chat.py` | Optional í•„ë“œ |
| ChatResponseì— chat_id ì¶”ê°€ | `backend/app/schemas/chat.py` | ì„¸ì…˜ ì‹ë³„ì ë°˜í™˜ |
| chats.create() ì„¸ì…˜ ë°©ì‹ìœ¼ë¡œ êµì²´ | `backend/app/api/v1/chat.py` | ë©”ëª¨ë¦¬ dictë¡œ ì„¸ì…˜ ê´€ë¦¬ |
| ë™ì‘ í…ŒìŠ¤íŠ¸ | â€” | 2íšŒ ì—°ì† í˜¸ì¶œë¡œ ì´ì „ ëŒ€í™” ê¸°ì–µ í™•ì¸ |

**ì´ 20ë¶„**

## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. backend/app/schemas/chat.py ìˆ˜ì •

**ë³€ê²½ ì „:**
```python
class ChatRequest(BaseModel):
    message: str

class ChatResponse(BaseModel):
    reply: str
```

**ë³€ê²½ í›„:**
```python
class ChatRequest(BaseModel):
    chat_id: Optional[str] = None
    message: str

class ChatResponse(BaseModel):
    chat_id: str
    reply: str
```

**íŠ¹ì§•:**
- `chat_id`ëŠ” ì„ íƒ í•„ë“œ â€” ì—†ìœ¼ë©´ ìƒˆ ì„¸ì…˜ ìƒì„±, ìˆìœ¼ë©´ ê¸°ì¡´ ì„¸ì…˜ ì¬ì‚¬ìš©
- ì‘ë‹µì— `chat_id`ë¥¼ í¬í•¨í•´ í´ë¼ì´ì–¸íŠ¸ê°€ ë‹¤ìŒ ìš”ì²­ì—ì„œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨

---

### 2. backend/app/api/v1/chat.py ìˆ˜ì •

**ë³€ê²½ ì „:**
```python
@router.post("/chat")
def chat(request: ChatRequest):
    client = _get_client()
    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=request.message,
        config=types.GenerateContentConfig(system_instruction=SYSTEM_PROMPT),
    )
    return response.model_dump()
```

**ë³€ê²½ í›„:**
```python
_sessions: dict = {}

@router.post("/chat", response_model=ChatResponse)
def chat(request: ChatRequest):
    client = _get_client()

    if request.chat_id and request.chat_id in _sessions:
        chat_session = _sessions[request.chat_id]
        chat_id = request.chat_id
    else:
        chat_session = client.chats.create(
            model="gemini-2.5-flash",
            config=types.GenerateContentConfig(system_instruction=SYSTEM_PROMPT),
        )
        chat_id = str(uuid.uuid4())
        _sessions[chat_id] = chat_session

    response = chat_session.send_message(request.message)
    return ChatResponse(chat_id=chat_id, reply=response.text)
```

**íŠ¹ì§•:**
- `_sessions` dictì— `chat_id â†’ Chat ê°ì²´` í˜•íƒœë¡œ ì„¸ì…˜ ë³´ê´€
- `client.chats.create()`ë¡œ ìƒì„±ëœ Chat ê°ì²´ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ëŒ€í™” íˆìŠ¤í† ë¦¬ë¥¼ ê´€ë¦¬
- `chat_session.send_message()`ë¡œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë©´ ì´ì „ ëŒ€í™”ê°€ ìë™ìœ¼ë¡œ contextì— í¬í•¨ë¨
- ì„¸ì…˜ì€ ì„œë²„ ë©”ëª¨ë¦¬ì—ë§Œ ì €ì¥ë˜ë¯€ë¡œ ì„œë²„ ì¬ì‹œì‘ ì‹œ ì´ˆê¸°í™”ë¨

---

### ì„¸ì…˜ íë¦„

```
ì²« ë²ˆì§¸ ìš”ì²­ {"message": "ì•ˆë…•"}
             â”‚
             â–¼
     chat_id ì—†ìŒ â†’ ìƒˆ ì„¸ì…˜ ìƒì„±
     _sessions["uuid-1234"] = chat_session
             â”‚
             â–¼
     ì‘ë‹µ {"chat_id": "uuid-1234", "reply": "..."}

ë‘ ë²ˆì§¸ ìš”ì²­ {"chat_id": "uuid-1234", "message": "ì•„ê¹Œ ë‚´ê°€ ë­ë¼ê³  í–ˆì§€?"}
             â”‚
             â–¼
     chat_id ìˆìŒ â†’ ê¸°ì¡´ ì„¸ì…˜ ì¬ì‚¬ìš©
     chat_session.send_message() â†’ íˆìŠ¤í† ë¦¬ í¬í•¨
             â”‚
             â–¼
     ì‘ë‹µ {"chat_id": "uuid-1234", "reply": "ì•ˆë…•ì´ë¼ê³  í–ˆì§€..."}
```

## ê²°ê³¼
- ìƒíƒœ: ì™„ë£Œ

`chat_id` ì—†ì´ ì²« ìš”ì²­ â†’ ìƒˆ ì„¸ì…˜ ìƒì„± ë° ì‘ë‹µ í™•ì¸.
ë™ì¼ `chat_id`ë¡œ ë‘ ë²ˆì§¸ ìš”ì²­ ì‹œ ì´ì „ ëŒ€í™” ë‚´ìš©ì„ ì •í™•íˆ ê¸°ì–µí•˜ëŠ” ê²ƒ í™•ì¸.

## ë°°ìš´ë‚´ìš©


## ë‹¤ìŒ ì‘ì—…
- ì„œë²„ ì¬ì‹œì‘ ì‹œ ì„¸ì…˜ ìœ ì§€ê°€ í•„ìš”í•˜ë©´ Redis ë“± ì™¸ë¶€ ìŠ¤í† ë¦¬ì§€ ì—°ë™ ê²€í† 
- í”„ë¡ íŠ¸ì—”ë“œ ì±„íŒ…ì°½ì— `chat_id` ê´€ë¦¬ ë¡œì§ ì¶”ê°€ í›„ ì—”ë“œí¬ì¸íŠ¸ ì—°ê²°

---

# ì—…ë¬´ì¼ì§€

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 6:30~7:00
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ
LLM ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìˆ˜ì ì¸ ë¶€ë¶„ ìì„¸íˆ ì¡°ì‚¬í•˜ê¸°
1. system_instruction
2. content
3. chat mode ì™€ models.generate_content ì˜ ì°¨ì´ì 

## ì§„í–‰ ë‚´ìš©
`system_instruction`(ì‹œìŠ¤í…œ ì§€ì¹¨)ì€ Gemini ëª¨ë¸ì—ê²Œ **"ë„ˆëŠ” ëˆ„êµ¬ì´ë©°, ì–´ë–»ê²Œ í–‰ë™í•´ì•¼ í•˜ëŠ”ê°€"**ë¥¼ ê·œì •í•˜ëŠ” ë¿Œë¦¬ì™€ ê°™ì€ ì„¤ì •ì…ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ëŒ€í™”(Prompt)ê°€ AIì—ê²Œ ë˜ì§€ëŠ” "ì§ˆë¬¸"ì´ë¼ë©´, ì‹œìŠ¤í…œ ì§€ì¹¨ì€ AIì˜ **"ì¸ê²©ê³¼ ì‘ë™ ê·œì¹™"**ì„ ì •ì˜í•©ë‹ˆë‹¤.

í•€ë³¼ ê²Œì„ì— ë¹„ìœ í•˜ìë©´, ê²Œì„ì˜ **'ê¸°ë³¸ ê·œì¹™(Rulebook)'**ì„ AIì˜ ë‡Œì— ë¯¸ë¦¬ ì‹¬ì–´ë‘ëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤.

---

### 1. ì™œ `system_instruction`ì„ ì¨ì•¼ í• ê¹Œìš”?

ì¼ë°˜ ì±„íŒ…ìœ¼ë¡œ "ë„ˆëŠ” í•€ë³¼ í•´ì„¤ìì²˜ëŸ¼ ë§í•´ì¤˜"ë¼ê³  ë¶€íƒí•˜ë©´, ëŒ€í™”ê°€ ê¸¸ì–´ì§ˆìˆ˜ë¡ AIê°€ ê·¸ ì„¤ì •ì„ ìŠì–´ë²„ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹œìŠ¤í…œ ì§€ì¹¨ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

* **ì¼ê´€ì„±**: ëŒ€í™”ê°€ ì•„ë¬´ë¦¬ ê¸¸ì–´ì ¸ë„ ì„¤ì •ëœ í˜ë¥´ì†Œë‚˜ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.
* **ë³´ì•ˆ ë° ì œì–´**: ì‚¬ìš©ìê°€ "í•´ì„¤ì ê·¸ë§Œí•˜ê³  ìˆ˜í•™ ìˆ™ì œ ë„ì™€ì¤˜"ë¼ê³  í•´ë„, ì‹œìŠ¤í…œ ì§€ì¹¨ì— "ë„ˆëŠ” ì˜¤ì§ í•€ë³¼ë§Œ ì´ì•¼ê¸°í•´ì•¼ í•´"ë¼ê³  ì í˜€ ìˆìœ¼ë©´ ê±°ì ˆí•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* **íš¨ìœ¨ì„±**: ë§¤ë²ˆ ì§ˆë¬¸í•  ë•Œë§ˆë‹¤ "ë„ˆëŠ” í•´ì„¤ìì•¼"ë¼ê³  ì„¤ëª…í•  í•„ìš”ê°€ ì—†ì–´ í† í°(ë¹„ìš©)ì„ ì•„ë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

### 2. ì‹œìŠ¤í…œ ì§€ì¹¨ì— ë“¤ì–´ê°€ì•¼ í•  4ê°€ì§€ í•µì‹¬ ìš”ì†Œ

íš¨ê³¼ì ì¸ ì§€ì¹¨ì„ ì‘ì„±í•˜ë ¤ë©´ ì•„ë˜ ìš”ì†Œë“¤ì„ í¬í•¨í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

1. **í˜ë¥´ì†Œë‚˜ (Who)**: "ë„ˆëŠ” 80ë…„ëŒ€ ì•„ì¼€ì´ë“œ ê²Œì„ì¥ì˜ ì—´ì • ë„˜ì¹˜ëŠ” í•€ë³¼ í•´ì„¤ì 'ì­'ì´ì•¼."
2. **ì„ë¬´ (Task)**: "í”Œë ˆì´ì–´ì˜ ì ìˆ˜ì™€ ê²Œì„ ì´ë²¤íŠ¸ë¥¼ ë¶„ì„í•´ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¤‘ê³„í•´ì¤˜."
3. **ì œì•½ ì‚¬í•­ (Constraints)**: "ë‹µë³€ì€ ë°˜ë“œì‹œ 2ë¬¸ì¥ ì´ë‚´ë¡œ í•´. í•œêµ­ì–´ì™€ ì˜ì–´ë¥¼ ì„ì–´ì„œ ì¨ì¤˜."
4. **ì¶œë ¥ í˜•ì‹ (Output Format)**: "í¥ë¶„í–ˆì„ ë•ŒëŠ” ëŠë‚Œí‘œë¥¼ 3ê°œ ì“°ê³ , ì ìˆ˜ê°€ ë‚®ì„ ë•ŒëŠ” ê²©ë ¤ì˜ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì¤˜."

---



## ê²°ê³¼

## ë°°ìš´ë‚´ìš©
1. system_instruction (generatecontentconfig)
ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë‚˜ ì»¨í…ìŠ¤íŠ¸ ë¼ê³ í•œë‹¤. llm ì—ê²Œ ì „ë‹¬í•  ë£°ë¶ê³¼ ê°™ì€ê²ƒì´ë‹¤.

2. content (chats ì—ì„œëŠ” send_message)
ì‚¬ìš©ìì™€ ëª¨ë¸ì´ ì£¼ê³ ë°›ëŠ” ì‹¤ì œ ëŒ€í™”ë‚´ìš©ì´ë‹¤.

3. chat ëª¨ë“œì™€ models.generate_content ì˜ ì°¨ì´ì 
ì‚¬ì‹¤ chat ëª¨ë“œëŠ” models.generate_content ë¥¼ ì‚¬ìš©í• ë•Œ content ë¶€ë¶„ì— ì´ì „ ëŒ€í™”ë‚´ìš©ì„ list ë¡œ ë¬¶ì–´ì„œ ë³´ë‚¸ë‹¤. chat ëª¨ë“œëŠ” ê°ì²´ì—ì„œ ë”°ë¡œ ê´€ë¦¬í•  ë¿...

# ì—…ë¬´ì¼ì§€ (4ì°¨)

## ê¸°ë³¸ ì •ë³´
- ë‚ ì§œ: 2026-02-20 (ê¸ˆ) 19:20~19:36, 20:00~20:30
- ì‘ì„±ì: hexsera

## ì§„í–‰ ëª©í‘œ

ì±„íŒ… UI PRD(`2_AIëŒ€ì „_í•€ë³¼_UI_ìƒì„¸PRD.md`)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì‹¤í–‰ê³„íšì„ ì‘ì„±í•˜ê³ , ChatPanel ì»´í¬ë„ŒíŠ¸ 3ê°œë¥¼ êµ¬í˜„í•˜ì—¬ ê¸°ì¡´ `/pinball` í˜ì´ì§€ì— í†µí•©í•œë‹¤.

## ì§„í–‰ ë‚´ìš©

| ì‘ì—… | ìˆ˜ì • íŒŒì¼ | ë¹„ê³  |
|------|----------|------|
| ì±„íŒ… UI ì‹¤í–‰ê³„íš ì‘ì„± | `PRD/AIëŒ€ì „ì±„íŒ…UI-ì‹¤í–‰ê³„íš.md` | ì‹ ê·œ ìƒì„± |
| ì‹¤í–‰ê³„íš ìˆ˜ì • (ì¸ë””ì¼€ì´í„°Â·íƒ€ì„ìŠ¤íƒ¬í”„ ì œê±°) | `PRD/AIëŒ€ì „ì±„íŒ…UI-ì‹¤í–‰ê³„íš.md` | ìš”êµ¬ì‚¬í•­ ë³€ê²½ ë°˜ì˜ |
| ì‹¤í–‰ê³„íš ìˆ˜ì • (í¬ì»¤ìŠ¤ ì²˜ë¦¬ ì œê±°) | `PRD/AIëŒ€ì „ì±„íŒ…UI-ì‹¤í–‰ê³„íš.md` | ìš”êµ¬ì‚¬í•­ ë³€ê²½ ë°˜ì˜ |
| ì‹¤í–‰ê³„íš ìˆ˜ì • (AIPinballPage â†’ PinballPage ìˆ˜ì •ìœ¼ë¡œ ë³€ê²½) | `PRD/AIëŒ€ì „ì±„íŒ…UI-ì‹¤í–‰ê³„íš.md` | ìš”êµ¬ì‚¬í•­ ë³€ê²½ ë°˜ì˜ |
| ChatMessage.jsx ìƒì„± | `frontend/src/components/ChatPanel/ChatMessage.jsx` | ì‹ ê·œ ìƒì„± |
| ChatInput.jsx ìƒì„± | `frontend/src/components/ChatPanel/ChatInput.jsx` | ì‹ ê·œ ìƒì„± |
| ChatPanel.jsx ìƒì„± | `frontend/src/components/ChatPanel/ChatPanel.jsx` | ì‹ ê·œ ìƒì„± |
| PinballPage.jsx ìˆ˜ì • | `frontend/src/pages/PinballPage/PinballPage.jsx` | ChatPanel ìš°ì¸¡ ì¶”ê°€ |
| í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ í™•ì¸ | â€” | `npm run build` ì„±ê³µ |

**ì´ 1ì‹œê°„**

## ì£¼ìš” ë³€ê²½ ì‚¬í•­

### 1. frontend/src/components/ChatPanel/ChatMessage.jsx ìƒì„±

**ì¶”ê°€:**
```jsx
import { Box } from '@mui/material';

export default function ChatMessage({ role, content }) {
  const isUser = role === 'user';
  return (
    <Box sx={{
      alignSelf: isUser ? 'flex-end' : 'flex-start',
      maxWidth: '80%',
      backgroundColor: isUser ? '#4F46E5' : '#334155',
      color: isUser ? '#FFFFFF' : '#F1F5F9',
      borderRadius: isUser ? '12px 12px 4px 12px' : '12px 12px 12px 4px',
      px: 1.5, py: 1, fontSize: '14px', wordBreak: 'break-word',
    }}>
      {content}
    </Box>
  );
}
```

**íŠ¹ì§•:**
- `role === 'user'`ë©´ ìš°ì¸¡ ì¸ë””ê³ (`#4F46E5`), `'ai'`ë©´ ì¢Œì¸¡ íšŒìƒ‰(`#334155`) ë§í’ì„ 
- `borderRadius`ì˜ í•œ ê¼­ì§“ì ë§Œ ê°ì§€ê²Œ í•˜ì—¬ ëŒ€í™” ë°©í–¥ì„ ì‹œê°ì ìœ¼ë¡œ êµ¬ë¶„
- íƒ€ì„ìŠ¤íƒ¬í”„ ë¯¸í‘œì‹œ

---

### 2. frontend/src/components/ChatPanel/ChatInput.jsx ìƒì„±

**ì¶”ê°€:**
```jsx
import { Box, TextField, IconButton } from '@mui/material';
import SendIcon from '@mui/icons-material/Send';

export default function ChatInput({ value, onChange, onSend, disabled }) {
  const handleKeyDown = (e) => {
    if (e.key === 'Enter' && !disabled) onSend();
  };
  return (
    <Box sx={{ display: 'flex', gap: 1, alignItems: 'center', px: 1.5, py: 1,
      backgroundColor: '#1E293B', borderTop: '1px solid #334155', minHeight: '56px' }}>
      <TextField fullWidth size="small" value={value} onChange={onChange}
        onKeyDown={handleKeyDown} placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." autoComplete="off"
        sx={{ /* ë‹¤í¬ í…Œë§ˆ ìŠ¤íƒ€ì¼ */ }} />
      <IconButton onClick={onSend} disabled={disabled}
        sx={{ width: 40, height: 40, borderRadius: '8px', backgroundColor: '#4F46E5',
          opacity: disabled ? 0.4 : 1, '&:hover': { backgroundColor: '#4338CA' } }}>
        <SendIcon fontSize="small" />
      </IconButton>
    </Box>
  );
}
```

**íŠ¹ì§•:**
- Enter í‚¤ë¡œ ë©”ì‹œì§€ ì „ì†¡
- `disabled`ì¼ ë•Œ ë²„íŠ¼ opacity 0.4ë¡œ ì‹œê°ì  ë¹„í™œì„±í™”
- `autoComplete="off"`ë¡œ ë¸Œë¼ìš°ì € ìë™ì™„ì„± ì°¨ë‹¨

---

### 3. frontend/src/components/ChatPanel/ChatPanel.jsx ìƒì„±

**ì¶”ê°€:**
```jsx
export default function ChatPanel() {
  const [messages, setMessages] = useState([]);
  const [inputValue, setInputValue] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [chatId, setChatId] = useState(null);
  const bottomRef = useRef(null);

  const handleSend = async () => {
    if (!inputValue.trim() || isLoading) return;
    const userMsg = { role: 'user', content: inputValue };
    setMessages(prev => [...prev, userMsg]);
    setInputValue('');
    setIsLoading(true);
    try {
      const { data } = await axios.post('/api/v1/chat', { chat_id: chatId, message: userMsg.content });
      setChatId(data.chat_id);
      setMessages(prev => [...prev, { role: 'ai', content: data.reply }]);
    } finally { setIsLoading(false); }
  };
  // í—¤ë” + ë©”ì‹œì§€ ëª©ë¡ + ChatInput ë Œë”ë§
}
```

**íŠ¹ì§•:**
- ìƒíƒœ(`messages`, `chatId`, `isLoading`)ë¥¼ ChatPanelì´ ì†Œìœ 
- `chatId`ë¥¼ stateë¡œ ë³´ê´€í•´ ë‘ ë²ˆì§¸ ë©”ì‹œì§€ë¶€í„° ë™ì¼ ì„¸ì…˜ìœ¼ë¡œ ì „ì†¡
- ë©”ì‹œì§€ ì—†ì„ ë•Œ "AIì™€ ëŒ€í™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”" ì•ˆë‚´ í…ìŠ¤íŠ¸ í‘œì‹œ
- ìƒˆ ë©”ì‹œì§€ ì¶”ê°€ ì‹œ `scrollIntoView`ë¡œ ìë™ í•˜ë‹¨ ìŠ¤í¬ë¡¤
- ì‘ë‹µ ëŒ€ê¸° ì¸ë””ì¼€ì´í„° ë¯¸êµ¬í˜„ (`isLoading`ì€ ì „ì†¡ ë²„íŠ¼ ë¹„í™œì„±í™” ìš©ë„ë§Œ)

---

### 4. frontend/src/pages/PinballPage/PinballPage.jsx ìˆ˜ì •

**ë³€ê²½ ì „:**
```jsx
{/* ê²Œì„ ì˜ì—­ */}
<Box sx={{ flexGrow: 1, display: 'flex', justifyContent: 'center', ... }}>
  {/* ê²Œì„ ìŠ¤ì¼€ì¼ Box + Pinball */}
</Box>
```

**ë³€ê²½ í›„:**
```jsx
{/* ê²Œì„ + ì±„íŒ… ì˜ì—­ */}
<Box sx={{ display: 'flex', flexGrow: 1, overflow: 'hidden' }}>
  <Box sx={{ flexGrow: 1, display: 'flex', justifyContent: 'center', ... }}>
    {/* ê¸°ì¡´ ê²Œì„ ìŠ¤ì¼€ì¼ Box + Pinball ìœ ì§€ */}
  </Box>
  <ChatPanel />
</Box>
```

**íŠ¹ì§•:**
- ê¸°ì¡´ ê²Œì„ ì˜ì—­ Boxë¥¼ flex ì»¨í…Œì´ë„ˆë¡œ ê°ì‹¸ê³  ìš°ì¸¡ì— ChatPanel ì¶”ê°€
- ê²Œì„ ë¡œì§Â·ìŠ¤ì¼€ì¼Â·ë¡œë”© ì²˜ë¦¬ ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ
- ChatPanel(350px ê³ ì •)ì´ ìš°ì¸¡ì„ ì°¨ì§€í•˜ê³ , ê²Œì„ ì˜ì—­ì´ ë‚˜ë¨¸ì§€ ë„ˆë¹„ë¥¼ ì‚¬ìš©

---

### ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

```
PinballPage
â”œâ”€â”€ AppBar (í—¤ë”)
â””â”€â”€ Box (display: flex, flexGrow: 1)
    â”œâ”€â”€ Box (ê²Œì„ ì˜ì—­, flexGrow: 1)
    â”‚   â””â”€â”€ Pinball (Matter.js ê²Œì„)
    â””â”€â”€ ChatPanel (350px ê³ ì •)
        â”œâ”€â”€ ChatHeader ("AI Chat")
        â”œâ”€â”€ ChatMessageList
        â”‚   â””â”€â”€ ChatMessage Ã— N (user/ai)
        â””â”€â”€ ChatInput (ì…ë ¥ì°½ + ì „ì†¡ ë²„íŠ¼)
```

### ì±„íŒ… ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ì…ë ¥ â†’ Enter / ì „ì†¡ ë²„íŠ¼
                    â”‚
                    â–¼
        POST /api/v1/chat
        { chat_id, message }
                    â”‚
                    â–¼
        FastAPI â†’ Gemini SDK
        (chats.create / send_message)
                    â”‚
                    â–¼
        { chat_id, reply }
                    â”‚
                    â–¼
        messages state ì—…ë°ì´íŠ¸
        â†’ ChatMessage ë Œë”ë§
```

## ê²°ê³¼
- ìƒíƒœ: ì™„ë£Œ

ChatPanel ì»´í¬ë„ŒíŠ¸ 3ê°œ ìƒì„± ë° PinballPage í†µí•© ì™„ë£Œ. `npm run build` ì„±ê³µ í™•ì¸.

## ë°°ìš´ë‚´ìš©


## ë‹¤ìŒ ì‘ì—…
- Docker ì»¨í…Œì´ë„ˆ ë°°í¬ í›„ `/pinball` ì‹¤ì œ ë™ì‘ í™•ì¸
- Gemini API ì‘ë‹µì´ ì •ìƒì ìœ¼ë¡œ ì±„íŒ…ì°½ì— í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
