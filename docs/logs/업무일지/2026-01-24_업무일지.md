# 업무일지

## 기본 정보
- 날짜: 2026-01-24 (금)
- 작성자: hexsera

## 진행 목표
Pinball.jsx 핀볼 게임에 범퍼(Bumper) 추가하기

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|

[PRD 작성]
PRD 작성 및 현재 코드베이스 분석
| PRD 작성 | `PRD/pinball-범퍼-추가.md` | 범퍼 추가 요구사항 분석 및 실행 계획 작성 |
15분

[실행]
| Matter.js Vector 모듈 추가 | `react/main/src/Pinball.jsx` | 충돌 방향 계산을 위한 Vector 모듈 import |
| 범퍼 Body 생성 | `react/main/src/Pinball.jsx` | 빨간색 원형 범퍼 생성 (restitution: 1.5, label: 'bumper') |
| World에 범퍼 추가 | `react/main/src/Pinball.jsx` | 물리 엔진 세계에 범퍼 추가 |
| 충돌 이벤트 등록 | `react/main/src/Pinball.jsx` | collisionStart 이벤트로 공-범퍼 충돌 감지 및 반발력 적용 |
| Cleanup 함수 수정 | `react/main/src/Pinball.jsx` | 충돌 이벤트 리스너 제거 추가 |
5분

[테스트]
5분

[학습]
1시간

[업무일지]
20분

**총 1시간 45분**
**학습 제외 45분**

## 주요 변경 사항

### 1. react/main/src/Pinball.jsx 수정

#### (1) Matter.js Vector 모듈 추가

**변경 전:**
```javascript
const Engine = Matter.Engine;
const Render = Matter.Render;
const Runner = Matter.Runner;
const World = Matter.World;
const Bodies = Matter.Bodies;
const Body = Matter.Body;
const Events = Matter.Events;
const Constraint = Matter.Constraint;
```

**변경 후:**
```javascript
const Engine = Matter.Engine;
const Render = Matter.Render;
const Runner = Matter.Runner;
const World = Matter.World;
const Bodies = Matter.Bodies;
const Body = Matter.Body;
const Events = Matter.Events;
const Constraint = Matter.Constraint;
const Vector = Matter.Vector;  // 추가
```

**특징:**
- 충돌 방향 계산을 위한 Vector 모듈 추가
- Vector.sub(), Vector.normalise(), Vector.mult(), Vector.add() 메서드 사용

#### (2) 범퍼 Body 생성

**추가:**
```javascript
// 범퍼 만들기 (충돌 시 강하게 튕겨냄)
const bumper = Bodies.circle(400, 600, 40, {
  isStatic: true,
  restitution: 1.5,
  label: 'bumper',
  render: { fillStyle: '#e74c3c' }
});
```

**특징:**
- 위치: (400, 600), 반지름: 40px
- restitution: 1.5로 강한 반발력 설정 (일반적으로 0~1이지만 게임 효과를 위해 초과)
- label: 'bumper'로 충돌 이벤트에서 식별 가능
- 빨간색(#e74c3c)으로 기존 obstacle과 구분

#### (3) World에 범퍼 추가

**변경 전:**
```javascript
World.add(engine.world, [
  ground,
  leftWall,
  rightWall,
  upWall,
  ball,
  obstacle1,
  obstacle2,
  leftFlipper,
  rightFlipper,
  leftFlipperConstraint,
  rightFlipperConstraint
]);
```

**변경 후:**
```javascript
World.add(engine.world, [
  ground,
  leftWall,
  rightWall,
  upWall,
  ball,
  obstacle1,
  obstacle2,
  bumper,  // 추가
  leftFlipper,
  rightFlipper,
  leftFlipperConstraint,
  rightFlipperConstraint
]);
```

**특징:**
- 범퍼를 물리 엔진 세계에 추가하여 물리 시뮬레이션과 렌더링 대상으로 등록

#### (4) 범퍼 충돌 이벤트 등록

**추가:**
```javascript
// 범퍼 충돌 이벤트
Events.on(engine, 'collisionStart', (event) => {
  const pairs = event.pairs;

  pairs.forEach((pair) => {
    const { bodyA, bodyB } = pair;

    // 공과 범퍼가 충돌했는지 확인
    if ((bodyA.label === 'bumper' && bodyB === ball) ||
        (bodyB.label === 'bumper' && bodyA === ball)) {
      console.log('Bumper hit!');

      // 충돌 방향 계산 (범퍼 중심 → 공 중심)
      const bumperBody = bodyA.label === 'bumper' ? bodyA : bodyB;
      const direction = Vector.sub(ball.position, bumperBody.position);
      const normalised = Vector.normalise(direction);

      // 공에 추가 속도 부여 (현재 속도 + 범퍼 효과)
      const bumperForce = Vector.mult(normalised, 15);
      const currentVelocity = ball.velocity;
      const newVelocity = Vector.add(currentVelocity, bumperForce);

      Body.setVelocity(ball, newVelocity);
    }
  });
});
```

**특징:**
- collisionStart 이벤트로 충돌 시작 시점 감지
- event.pairs 배열로 모든 충돌 쌍 순회
- bodyA/bodyB 순서가 보장되지 않으므로 양방향 체크
- 범퍼 중심에서 공 중심으로 향하는 방향 벡터 계산
- 단위 벡터에 15를 곱하여 반발력 크기 결정
- 기존 속도에 반발력을 더하여 운동량 유지

#### (5) Cleanup 함수에 충돌 이벤트 해제 추가

**변경 전:**
```javascript
return () => {
  if (bgmRef.current) {
    bgmRef.current.pause();
    bgmRef.current.currentTime = 0;
  }
  Events.off(engine, 'beforeUpdate');
  window.removeEventListener('keydown', handleKeyDown);
  window.removeEventListener('keyup', handleKeyUp);
  if (sceneRef.current) {
    sceneRef.current.removeEventListener('touchstart', handleTouchStart);
    sceneRef.current.removeEventListener('touchend', handleTouchEnd);
  }
  Render.stop(render);
  Runner.stop(runner);
  Engine.clear(engine);
};
```

**변경 후:**
```javascript
return () => {
  if (bgmRef.current) {
    bgmRef.current.pause();
    bgmRef.current.currentTime = 0;
  }
  Events.off(engine, 'beforeUpdate');
  Events.off(engine, 'collisionStart');  // 추가
  window.removeEventListener('keydown', handleKeyDown);
  window.removeEventListener('keyup', handleKeyUp);
  if (sceneRef.current) {
    sceneRef.current.removeEventListener('touchstart', handleTouchStart);
    sceneRef.current.removeEventListener('touchend', handleTouchEnd);
  }
  Render.stop(render);
  Runner.stop(runner);
  Engine.clear(engine);
};
```

**특징:**
- 컴포넌트 언마운트 시 충돌 이벤트 리스너 제거
- 메모리 누수 방지

## 결과
- 상태: 완료

## 시간을 너무 낭비했다...
어제 대차게 까여서 너무 스트레스를 많이 받았다.
잠은 어찌 잤는데 일어난 후 너무 아무것도 하기 싫어졌다.


## 다음 작업
- 범퍼 추가
- 범퍼 이쁘게 만들기
