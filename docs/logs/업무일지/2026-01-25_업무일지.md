# 업무일지

## 기본 정보
- 날짜: 2026-01-25 (토)
- 작성자: hexsera

## 진행 목표
UserInfo.jsx에서 FastAPI `/api/v1/users/{user_id}` 엔드포인트를 호출하여 실제 회원 정보(이메일, 닉네임, 생년월일)를 가져와 표시하는 기능 구현 및 axios 요청 미작동 버그 해결

## 진행 내용


| 작업 | 시간 | 한것 |
|------|----------|------|
| 회원가입 페이지 PRD 작성 |  1시간 15분 |  |
| 실행 테스트 | 20분 | |
| 회원가입 페이지 보완 PRD 작성 | 40분 | |
| 실행 및 테스트 | 5분 | |
| 학습 | 2시간 5분 | |

**총 4시간 5분**

## 주요 변경 사항

### 1. react/main/src/UserInfo.jsx 수정

**변경 전:**
```javascript
const [userInfo, setUserInfo] = useState({
  email: '',
  nickname: '',
  birth_date: ''
});

// API 호출 없음
// 하드코딩된 임시 텍스트 표시
{userInfo.email || '로딩 중...'}
```

**변경 후:**
```javascript
const [userInfo, setUserInfo] = useState({
  email: '',
  nickname: '',
  birth_date: ''
});

// 회원 정보 조회
useEffect(() => {
  const fetchUserInfo = async () => {
    console.log('회원 정보 API 호출 시작');
    try {
      const response = await axios.get(`/api/v1/users/${user.id}`, {
        headers: { 'X-API-Key': 'hexsera-secret-api-key-2026' }
      });
      console.log('회원 정보 API 호출 성공:', response.data);
      setUserInfo({
        email: response.data.email,
        nickname: response.data.nickname,
        birth_date: response.data.birth_date
      });
    } catch (err) {
      console.error('회원 정보 API 호출 실패:', err);
    }
  };

  if (user && user.id) {
    fetchUserInfo();
  }
}, [user]);

{userInfo.email || '로딩 중...'}
```

**특징:**
- useEffect와 useState를 사용한 API 호출 패턴
- X-API-Key 헤더를 통한 API 인증
- console.log를 통한 API 호출 상태 디버깅
- 조건부 렌더링으로 '로딩 중...' fallback 표시
- user.id 존재 여부 확인 후 API 호출

### 2. react/main/src/Login.jsx 수정 (버그 수정)

**변경 전:**
```javascript
if (response.status === 200) {
  console.log('로그인 성공:', response.data);
  login({ id: response.data.id, name: response.data.nickname });  // ← 잘못된 필드명
  setLoginError(false);
  navigate('/');
}
```

**변경 후:**
```javascript
if (response.status === 200) {
  console.log('로그인 성공:', response.data);
  login({ id: response.data.user_id, name: response.data.nickname });  // ← 올바른 필드명
  setLoginError(false);
  navigate('/');
}
```

**특징:**
- FastAPI LoginResponse는 `user_id` 필드 반환 (id가 아님)
- `response.data.id`는 undefined 반환
- localStorage에 올바른 user.id 저장되도록 수정
- 이 버그로 인해 UserInfo.jsx에서 `/api/v1/users/undefined` 호출됨

### 3. PRD/undefined-user-id-문제.md 생성

**추가:**
```markdown
# undefined user.id로 axios 요청 시 문제 분석

## 문제 상황
user.id가 undefined일 때 FastAPI에 요청이 가지 않았고, catch 블록도 작동하지 않았다.

## 원인
Login.jsx 에서 user id 를 불러올때 api 변경으로 인해 필드명이 변경 됐음
따라서 user id 를 불러오지 못하고 undefined 를 불러오게 됐다.

useEffect의 `if (user && user.id)` 조건 때문에 fetchUserInfo()가 호출되지 않음.
따라서 axios 요청도 실행되지 않고, catch도 실행되지 않음.

## 해결 방법
Login.jsx에서 올바른 필드명 사용:
login({ id: response.data.user_id, name: response.data.nickname });
```

## 결과
- 상태: 완료


## 다음 작업
- 유저 정보 변경
- 유저 삭제
- 유저 master key 제거
- 유저 정보용 CRUD 만들기