# 업무일지

## 기본 정보
- 날짜: 2026-01-20 (월)
- 작성자: hexsera

## 진행 목표
핀볼 게임 플리퍼의 각도 제한 도달 시 발생하는 진동 문제 해결

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
[PRD 작성]
| 진동 원인 조사 및 PRD 작성 | pinball-플리퍼-sleeping-문제해결.md |
1시간

[실행 및 테스트]
20분

[실패 후 원인 분석 및 수정]
1시간 40분

[테스트]
10분

[학습]
| 진동 해결 분석 문서 작성 | 플리퍼-진동문제-해결-분석.md | 원인과 해결 방법 상세 분석 |
Bodies, Constraint 학습
1시간 25분

**총 4시간 35분**
**학습 제외 3시간 10분**

## 주요 변경 사항

### 1. 왼쪽 플리퍼 각속도 제어 변경 (react/main/src/Pinball.jsx:182-188)

**변경 전:**
```javascript
if (isLeftKeyPressed) {
  Body.setAngularVelocity(leftFlipper, -FLIPPER_SPEED);
} else {
  if (leftFlipper.angle < LEFT_FLIPPER_MAX_ANGLE) {
    Body.setAngularVelocity(leftFlipper, FLIPPER_SPEED);
  } else {
    Body.setAngularVelocity(leftFlipper, 0);  // ← 진동 원인
  }
}
```

**변경 후:**
```javascript
if (isLeftKeyPressed) {
  Body.setAngularVelocity(leftFlipper, -FLIPPER_SPEED);
} else {
  Body.setAngularVelocity(leftFlipper, FLIPPER_SPEED);  // 조건 제거
}
```

### 2. 오른쪽 플리퍼 각속도 제어 변경 (react/main/src/Pinball.jsx:199-204)

**변경 전:**
```javascript
if (isRightKeyPressed) {
  Body.setAngularVelocity(rightFlipper, FLIPPER_SPEED);
} else {
  if (rightFlipper.angle > RIGHT_FLIPPER_MIN_ANGLE) {
    Body.setAngularVelocity(rightFlipper, -FLIPPER_SPEED);
  } else {
    Body.setAngularVelocity(rightFlipper, 0);  // ← 진동 원인
  }
}
```

**변경 후:**
```javascript
if (isRightKeyPressed) {
  Body.setAngularVelocity(rightFlipper, FLIPPER_SPEED);
} else {
  Body.setAngularVelocity(rightFlipper, -FLIPPER_SPEED);  // 조건 제거
}
```

### 3. 각도 제한 코드는 유지 (react/main/src/Pinball.jsx:191-196, 207-212)

```javascript
// 왼쪽 플리퍼 각도 제한
if (leftFlipper.angle < LEFT_FLIPPER_MIN_ANGLE) {
  Body.setAngle(leftFlipper, LEFT_FLIPPER_MIN_ANGLE);
}
if (leftFlipper.angle > LEFT_FLIPPER_MAX_ANGLE) {
  Body.setAngle(leftFlipper, LEFT_FLIPPER_MAX_ANGLE);
}

// 오른쪽 플리퍼 각도 제한
if (rightFlipper.angle > RIGHT_FLIPPER_MAX_ANGLE) {
  Body.setAngle(rightFlipper, RIGHT_FLIPPER_MAX_ANGLE);
}
if (rightFlipper.angle < RIGHT_FLIPPER_MIN_ANGLE) {
  Body.setAngle(rightFlipper, RIGHT_FLIPPER_MIN_ANGLE);
}
```

## 이슈 및 해결

### 문제: 플리퍼가 각도 제한에 도달한 후 비틀림 진동 발생

**문제 코드**
```javascript
if (isLeftKeyPressed) {
  Body.setAngularVelocity(leftFlipper, -FLIPPER_SPEED);
} else {
  if (leftFlipper.angle < LEFT_FLIPPER_MAX_ANGLE) {
    Body.setAngularVelocity(leftFlipper, FLIPPER_SPEED);
  } else {
    Body.setAngularVelocity(leftFlipper, 0);  // ← 진동 원인
  }
}
```

**해결**
```javascript
if (isLeftKeyPressed) {
  Body.setAngularVelocity(leftFlipper, -FLIPPER_SPEED);
} else {
  Body.setAngularVelocity(leftFlipper, FLIPPER_SPEED);  // 조건 제거
}
```
원인 부분을 제거하였다.

**원인**
결과적으로, 정확한 원인은 모르겠고 추측만 하였다.

배경지식
1. 기본적으로 bodies 들은 회전 할 때 자기 중심 축 기준으로 회전한다.
2. Constraint 는 bodies 의 특정 위치를 고정 시킨다.
3. 1번 원리의 의해 bodies 는 자기 중심 기준으로 회전하려 하지만, Constraint 로 인해 방해 받는다.
4. 결과적으로 bodies는 회전하긴 하지만, Constraint 기준으로 회전하게 된다.

추측
1. Bodies 를 0도에서 30도로 회전시키면서 매 beforeUpdate 에 30 도를 넘었는지 체크한다.
2. 만약 30도를 넘었다면 beforeUpdate 에 setAngle 을 주어 30 도로 돌린다. 그리고 setAngularVelocity(0) 을 주어 회전 속도도 0으로 만든다.
3. setAngle 로 인해 Bodies 를 회전시켰다. 하지만 Bodies 는 자신을 중심으로 회전했기 때문에 Constraint 와 어긋나게 된다. (Bodies 와 Constraint 고정 점이 멀어졌다.)
4. Constraint 가 Bodies 의 고정 점을 일치 시키려고 힘을 가한다 (레그돌이 어딘가 끼었을때 갑자기 튕겨나가 듯)
5. 4번의 과정중 setAngularVelocity 가 음수값이 들어가서 Bodies 가 30도 이하로 내려가게 된다 (반시계 회전)
6. 하지만 Bodies 는 30도 이하라면 30도로 회전하도록 setAngularVelocity를 양수로 주게 된다.
7. Bodies 가 30도 이하였다가 다시 30도로 회전하게 된다.
8. 1번부터 돌아가 사이클이 빠르게 반복되어 진동하는 것 처럼 보이게 된다.

### 문제 2 AI 가 원인 해결을 하지 못했음.

## 결과
- 상태: 완료 
하지만 원인 알 수 없음 및 추가 문제 발생

### 추가 문제
플립퍼가 진동이 없지만 공이 닿으면 과하게 공이 튕김. 
플립퍼가 회전에 제한이 있고, 계속 회전하려 하는데 외부의 힘을 받으니 공이 닿으면 플립퍼가 회전을 고무줄 처럼 회전해서 공을 날려버린다.

### 왜 원인을 명확하게 알 수 없는가?
1. 나의 matter.js 작동지식 부족
명확하게 모르기에 뭉뚱그려 지시하기때문에 정확한 결과가 나오지 않는다.
2. AI 의 matter.js 물리 결과 추측 부족
AI 가 matter.js 에 대한 물리가 어떻게 작동 할 지 잘 모르는것같다. damping 과 stiffness 에 대한 지시를 하지 않았는데, 해당 요소를 원인으로 생각하고 해당 요소에 과하게 집착하였다.
3. AI 가 결과를 볼 수 있는 수단이 없음
테스트는 내가하고, 문제점을 내가 대충 말하기때문에 AI가 문제와 원인을 객관적으로 판단할수없다.

### 해결방안
AI 에게 디버깅 할 수 있도록 제한을 풀어주자. 웹 디버깅 MCP 를 설치해서 사용해야겠다.

## 다음 작업
- 핀볼 벽 생성
- 핀볼 죽음 구역 생성