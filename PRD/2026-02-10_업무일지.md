# 업무일지

## 기본 정보
- 날짜: 2026-02-10 (화요일) 1:30~2:30
- 작성자: hexsera

## 진행 목표
1. Pinball.jsx에 플리퍼 사운드 및 라이프다운 사운드 추가 (TDD)

---

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| RED: playFlipperSound 테스트 작성 | `frontend/src/test/PinballSound.test.jsx` | 신규 생성 |
| GREEN: pinballSound.js 생성 | `frontend/src/pinballSound.js` | playFlipperSound 구현 |
| RED: playLifeDownSound 테스트 추가 | `frontend/src/test/PinballSound.test.jsx` | 기존 파일에 추가 |
| GREEN: playLifeDownSound 구현 | `frontend/src/pinballSound.js` | 함수 추가 |
| GREEN: Pinball.jsx 사운드 연결 | `frontend/src/Pinball.jsx` | import + ref + 호출 |

---

## 주요 변경 사항

### 4. frontend/src/pinballSound.js 생성

**추가:**
```javascript
export function playFlipperSound(audio) {
  if (audio) {
    audio.currentTime = 0;
    audio.play();
  }
}

export function playLifeDownSound(audio) {
  if (audio) {
    audio.currentTime = 0;
    audio.play();
  }
}
```

**특징:**
- Audio 객체를 인자로 받아 사운드 로직만 순수하게 분리
- Pinball.jsx의 Matter.js 의존성 없이 독립적으로 테스트 가능

### 5. frontend/src/test/PinballSound.test.jsx 생성

**추가:**
```javascript
import { describe, it, expect, vi } from 'vitest'
import { playFlipperSound, playLifeDownSound } from '../pinballSound'

describe('playFlipperSound', () => {
  it('플리퍼 버튼을 누르면 flipper 사운드의 play()가 호출된다', () => {
    const mockPlay = vi.fn().mockResolvedValue(undefined)
    const mockAudio = { play: mockPlay, currentTime: 0 }
    playFlipperSound(mockAudio)
    expect(mockPlay).toHaveBeenCalledTimes(1)
  })
})

describe('playLifeDownSound', () => {
  it('life가 줄어들면 lifedown 사운드의 play()가 호출된다', () => {
    const mockPlay = vi.fn().mockResolvedValue(undefined)
    const mockAudio = { play: mockPlay, currentTime: 0 }
    playLifeDownSound(mockAudio)
    expect(mockPlay).toHaveBeenCalledTimes(1)
  })
})
```

**특징:**
- `vi.fn()`으로 Audio mock 생성 → jsdom 환경에서 실제 오디오 재생 없이 테스트
- play()가 1회 호출됐는지만 검증

### 6. frontend/src/Pinball.jsx 수정

**변경 전:**
```javascript
import { STAGE_CONFIGS } from './stageConfigs';

// ref 없음
// Audio 초기화 없음
// 키 이벤트에 사운드 없음
// 터치 이벤트에 사운드 없음
// deathZone에 사운드 없음
```

**변경 후:**
```javascript
import { STAGE_CONFIGS } from './stageConfigs';
import { playFlipperSound, playLifeDownSound } from './pinballSound';

// ref 추가
const fliperSoundRef = useRef(null);
const lifeDownSoundRef = useRef(null);

// Audio 초기화 추가
const fliperSound = new Audio('/audio/fliper.mp3');
fliperSound.volume = 0.5;
fliperSoundRef.current = fliperSound;

const lifeDownSound = new Audio('/audio/lifedown.wav');
lifeDownSound.volume = 0.7;
lifeDownSoundRef.current = lifeDownSound;

// 키 이벤트에 사운드 추가
if (event.key === 'ArrowLeft') {
  isLeftKeyPressed = true;
  playFlipperSound(fliperSoundRef.current);  // 추가
}
if (event.key === 'ArrowRight') {
  isRightKeyPressed = true;
  playFlipperSound(fliperSoundRef.current);  // 추가
}

// 터치 이벤트에 사운드 추가
if (touchX < centerX) {
  isLeftKeyPressed = true;
  playFlipperSound(fliperSoundRef.current);  // 추가
} else {
  isRightKeyPressed = true;
  playFlipperSound(fliperSoundRef.current);  // 추가
}

// deathZone에 사운드 추가
livesRef.current = newLives;
setLives(newLives);
playLifeDownSound(lifeDownSoundRef.current);  // 추가

// cleanup에 추가
if (fliperSoundRef.current) {
  fliperSoundRef.current.pause();
  fliperSoundRef.current.currentTime = 0;
}
if (lifeDownSoundRef.current) {
  lifeDownSoundRef.current.pause();
  lifeDownSoundRef.current.currentTime = 0;
}
```

**사운드 재생 시점:**
```
키보드 ArrowLeft/ArrowRight 눌림 → playFlipperSound() → fliper.mp3
터치 좌/우 시작 → playFlipperSound() → fliper.mp3
deathZone 충돌 (life 감소) → playLifeDownSound() → lifedown.wav
```

---

## 아키텍처

### 사운드 로직 분리 구조

```
변경 전:
┌───────────────────────────────┐
│         Pinball.jsx           │
│  - Matter.js 물리 엔진        │
│  - 사운드 로직 (직접 내장)    │  ← 테스트 불가
│  - 키/터치 이벤트             │
└───────────────────────────────┘

변경 후:
┌───────────────────────────────┐
│         Pinball.jsx           │
│  - Matter.js 물리 엔진        │
│  - 키/터치 이벤트             │
│  - playFlipperSound() 호출    │
│  - playLifeDownSound() 호출   │
└──────────────┬────────────────┘
               │ import
               ▼
┌───────────────────────────────┐
│       pinballSound.js         │
│  - playFlipperSound(audio)    │  ← 테스트 가능
│  - playLifeDownSound(audio)   │
└───────────────────────────────┘
               │ mock으로 대체
               ▼
┌───────────────────────────────┐
│    PinballSound.test.jsx      │
│  - mockAudio = { play: vi.fn }│
│  - expect(play).toHaveBeenCalled │
└───────────────────────────────┘
```

---

## 결과
- 상태: 완료

## 배운내용

## 다음 작업
- 방향키를 계속 누르면 플립퍼 오디오가 연속 재생됨
