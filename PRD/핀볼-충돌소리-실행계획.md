# 핀볼 충돌 소리 실행계획

## 요구사항 요약

**요구사항**: 핀볼 게임에서 공이 충돌하면 충돌하는 소리를 재생

**목적**: 사용자에게 청각적 즐거움을 제공하여 게임 몰입감을 높임

## 현재상태 분석

**Pinball.jsx 현재 상태**:
- Matter.js 충돌 이벤트(`collisionStart`)가 이미 구현되어 있음
- bumper, target, deathZone 충돌 감지 로직 존재 (228-288번째 줄)
- 배경음악(BGM) 재생 기능이 이미 구현되어 있음 (Audio 객체 사용)
- `public/audio/ball_hit.wav` 파일이 준비되어 있음

## 구현 방법

**기술 스택**:
- HTML5 Audio API (배경음악과 동일한 방식)
- Matter.js `collisionStart` 이벤트 활용

**접근 방식**:
1. Audio 객체를 useRef로 관리하여 컴포넌트 생애주기 동안 재사용
2. 기존 충돌 이벤트 리스너 내부에서 Audio.play() 호출
3. 모든 충돌(bumper, target, 벽, 플리퍼 등)에서 소리 재생

## 구현 단계

### 1. 충돌 사운드 Audio 객체 생성
```javascript
const hitSoundRef = useRef(null);

useEffect(() => {
  // 배경음악 설정
  const bgm = new Audio('/audio/back_bgm.mp3');
  bgm.loop = true;
  bgm.volume = 0.05;
  bgmRef.current = bgm;

  // 충돌 사운드 설정
  const hitSound = new Audio('/audio/ball_hit.wav');
  hitSound.volume = 0.3;
  hitSoundRef.current = hitSound;

  // ... (나머지 Matter.js 코드)
}, []);
```
- useRef로 충돌 사운드 Audio 객체 관리
- volume을 0.3으로 설정 (배경음악 0.05보다 크게)
- 컴포넌트 마운트 시 한 번만 생성

### 2. 충돌 이벤트에서 소리 재생
```javascript
Events.on(engine, 'collisionStart', (event) => {
  const pairs = event.pairs;

  pairs.forEach((pair) => {
    const { bodyA, bodyB } = pair;

    // 공이 포함된 충돌인지 확인
    if (bodyA === ball || bodyB === ball) {
      // 충돌 소리 재생
      if (hitSoundRef.current) {
        hitSoundRef.current.currentTime = 0; // 재생 위치 초기화
        hitSoundRef.current.play().catch(err => {
          console.log('Sound play failed:', err);
        });
      }
    }

    // 기존 충돌 처리 로직 (bumper, target, deathZone)
    // ...
  });
});
```
- `bodyA === ball || bodyB === ball` 조건으로 공 충돌 감지
- `currentTime = 0`으로 재생 위치 초기화 (연속 충돌 시 소리 겹침 방지)
- `play().catch()`로 에러 처리 (브라우저 자동 재생 정책 대응)

### 3. 정리 함수에서 메모리 해제
```javascript
return () => {
  if (bgmRef.current) {
    bgmRef.current.pause();
    bgmRef.current.currentTime = 0;
  }
  if (hitSoundRef.current) {
    hitSoundRef.current.pause();
    hitSoundRef.current.currentTime = 0;
  }
  Events.off(engine, 'beforeUpdate');
  Events.off(engine, 'collisionStart');
  // ... (나머지 정리 코드)
};
```
- 컴포넌트 언마운트 시 충돌 사운드 정지
- 메모리 누수 방지

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| react/main/src/Pinball.jsx | 수정 | hitSoundRef 추가, 충돌 이벤트에서 소리 재생, 정리 함수에 메모리 해제 |

## 완료 체크리스트

- [o] 공이 벽에 충돌할 때 소리가 재생되는가
- [o] 공이 플리퍼에 충돌할 때 소리가 재생되는가
- [o] 공이 bumper에 충돌할 때 소리가 재생되는가
- [o] 공이 target에 충돌할 때 소리가 재생되는가
- [o] 연속 충돌 시 소리가 겹치지 않고 새로 재생되는가
- [o] 브라우저 콘솔에 에러가 출력되지 않는가
- [o] 게임 종료 시 메모리 누수가 없는가
