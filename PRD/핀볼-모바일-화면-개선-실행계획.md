# 핀볼 모바일 화면 개선 실행계획

## 요구사항 요약

**요구사항**: 모바일 화면에서 헤더와 핀볼 게임 영역이 세로로 배치되고, 핀볼이 비율을 유지하면서 남은 공간을 꽉 채우도록 한다.

**목적**: 현재 모바일에서 고정 크기(700×1200) 기준으로 scale이 계산되지만, padding 여백이 고정값이어서 모바일 환경에 최적화된 크기 계산이 이루어지지 않는다.

## 현재상태 분석

- `calculateScale`에서 `padding: 120` 고정값으로 width/height를 각각 빼서 scale 계산
- 헤더 높이를 실제로 측정하지 않고 padding으로 퉁쳐서 처리 중
- 모바일/데스크탑 구분 없이 동일한 scale 계산 로직 적용
- 게임 영역 Box에 `pt: 2`(16px) 패딩이 고정으로 들어가 있어 가용 높이가 줄어듦

## 구현 방법

MUI의 `useTheme` + `useMediaQuery`로 모바일 여부를 감지하고, `useRef`로 AppBar의 실제 높이를 측정한다.
모바일일 때는 padding 없이 `뷰포트 너비`와 `뷰포트 높이 - 헤더 높이`를 기준으로 scale을 계산한다.
가로/세로 중 더 작은 비율을 선택해 비율을 유지하며, 최대 scale은 1로 제한한다.

## 구현 단계

### 1. AppBar ref 연결 및 헤더 높이 측정 state 추가

```jsx
import { useTheme } from '@mui/material/styles';
import useMediaQuery from '@mui/material/useMediaQuery';

const appBarRef = useRef(null);
const [headerHeight, setHeaderHeight] = useState(0);
const theme = useTheme();
const isMobile = useMediaQuery(theme.breakpoints.down('sm')); // 600px 이하

useEffect(() => {
  if (appBarRef.current) {
    setHeaderHeight(appBarRef.current.offsetHeight);
  }
}, []);
```
- **무엇을 하는가**: AppBar의 실제 렌더링 높이를 픽셀 단위로 측정해 scale 계산에 사용
- `useMediaQuery`로 모바일(600px 이하) 여부를 감지
- `offsetHeight`는 padding/border 포함한 실제 높이를 반환

### 2. calculateScale에 모바일 분기 추가

```jsx
const calculateScale = useCallback(() => {
  const canvasWidth = 700;
  const canvasHeight = 1200;

  if (isMobile) {
    const scaleByWidth = windowSize.width / canvasWidth;
    const scaleByHeight = (windowSize.height - headerHeight) / canvasHeight;
    setGameScale(Math.min(scaleByWidth, scaleByHeight, 1));
  } else {
    const padding = 120;
    const scaleByWidth = (windowSize.width - padding) / canvasWidth;
    const scaleByHeight = (windowSize.height - padding) / canvasHeight;
    setGameScale(Math.min(scaleByWidth, scaleByHeight, 1));
  }
}, [windowSize, isMobile, headerHeight]);
```
- **무엇을 하는가**: 모바일에서 padding 없이 뷰포트 전체를 가용 공간으로 사용해 scale 계산
- 모바일: 가로는 뷰포트 너비 전체, 세로는 `뷰포트 높이 - 헤더 높이` 기준
- `Math.min(..., 1)`로 원본 크기(scale=1) 초과 방지

### 3. AppBar에 ref 연결 및 게임 영역 Box 모바일 패딩 제거

```jsx
<AppBar ref={appBarRef} position="static" sx={{ ... }}>

{/* 게임 영역 */}
<Box sx={{
  flexGrow: 1,
  display: 'flex',
  justifyContent: 'center',
  alignItems: 'flex-start',
  overflow: 'hidden',
  pt: isMobile ? 0 : 2,   // 모바일에서 상단 패딩 제거
}}>
  <Box sx={{
    transform: `scale(${gameScale})`,
    transformOrigin: 'top center',
    width: 700,
    height: 1200,
    marginBottom: `${scaledHeight - 1200}px`,
    marginLeft: 'auto',
    marginRight: 'auto',
  }}>
    <Pinball />
  </Box>
</Box>
```
- **무엇을 하는가**: AppBar에 ref를 달아 높이를 측정하고, 모바일에서는 게임 위 패딩(pt:2 = 16px)을 제거해 가용 공간 최대화
- `pt: isMobile ? 0 : 2`로 데스크탑 레이아웃은 그대로 유지

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `frontend/src/pages/PinballPage/PinballPage.jsx` | 수정 | `useTheme`, `useMediaQuery` 추가, `appBarRef` 연결, `headerHeight` state 추가, `calculateScale` 모바일 분기, 게임 영역 `pt` 조건부 적용 |

## 완료 체크리스트

- [ ] 모바일(600px 이하)에서 세로 스크롤이 발생하지 않는다
- [ ] 핀볼 게임이 화면 가로를 꽉 채운다 (좌우 여백 없음)
- [ ] 핀볼 게임의 가로:세로 비율(700:1200)이 유지된다
- [ ] 브라우저 창을 모바일 크기로 줄이면 핀볼이 자동으로 축소된다
- [ ] 데스크탑(600px 초과)에서 기존 레이아웃이 동일하게 동작한다
- [ ] 브라우저 창 크기를 변경해도 실시간으로 크기가 재계산된다
