# 회원 정보 회원 삭제 실행계획

## 요구사항 요약

**요구사항**: UserInfo.jsx에서 회원 탈퇴 버튼 클릭 시 "회원 탈퇴" 텍스트 확인 후 회원 삭제 및 로그아웃 처리

**목적**: 회원이 본인의 계정을 안전하게 삭제할 수 있도록 하며, 잘못된 탈퇴를 방지하기 위해 "회원 탈퇴" 텍스트 입력 단계를 추가

## 현재상태 분석

- UserInfo.jsx에 회원 탈퇴 Dialog가 이미 구현되어 있음 (deleteDialogOpen 상태 관리)
- 현재 Dialog는 간단한 확인 메시지만 표시하고 확인 입력 없이 탈퇴 처리
- handleDelete 함수는 TODO 주석으로 백엔드 API 연동이 필요한 상태
- FastAPI의 DELETE /api/v1/users/{user_id} 엔드포인트는 이미 구현됨 (API Key 필요)

## 구현 방법

1. Dialog에 "회원 탈퇴" 텍스트 입력 TextField 추가
2. 확인 버튼 클릭 시 입력값이 "회원 탈퇴"와 정확히 일치하는지 검증
3. 일치하면 DELETE /api/v1/users/{user_id}로 회원 삭제 요청 (API Key 포함)
4. 삭제 성공 시 AuthContext의 logout() 호출하여 로그인 정보 제거
5. 메인 페이지(/)로 리다이렉트
6. 텍스트가 일치하지 않거나 API 에러 발생 시 에러 메시지 표시

## 구현 단계

### 1. 텍스트 입력 상태 추가

```javascript
const [deleteConfirmText, setDeleteConfirmText] = useState('');
const [deleteError, setDeleteError] = useState(null);
```

- `deleteConfirmText`: 사용자가 입력한 확인 텍스트를 저장
- `deleteError`: 텍스트 불일치 또는 API 에러 메시지를 저장

### 2. Dialog에 텍스트 입력 필드 추가

```javascript
<Dialog
  open={deleteDialogOpen}
  onClose={() => {
    setDeleteDialogOpen(false);
    setDeleteConfirmText('');
    setDeleteError(null);
  }}
>
  <DialogTitle>회원 탈퇴</DialogTitle>
  <DialogContent>
    <Typography gutterBottom>
      정말 탈퇴하시겠습니까? 삭제된 정보는 되돌릴 수 없습니다.
    </Typography>
    <Typography variant="body2" color="text.secondary" gutterBottom sx={{ mt: 2 }}>
      진행하려면 아래 입력란에 <strong>"회원 탈퇴"</strong>를 정확히 입력해 주세요.
    </Typography>
    <TextField
      fullWidth
      label="회원 탈퇴 확인"
      placeholder="회원 탈퇴"
      value={deleteConfirmText}
      onChange={(e) => setDeleteConfirmText(e.target.value)}
      sx={{ mt: 2 }}
    />
    {deleteError && (
      <Alert severity="error" sx={{ mt: 2 }}>
        {deleteError}
      </Alert>
    )}
  </DialogContent>
  <DialogActions>
    <Button onClick={() => {
      setDeleteDialogOpen(false);
      setDeleteConfirmText('');
      setDeleteError(null);
    }}>
      취소
    </Button>
    <Button onClick={handleDelete} color="error" variant="contained">
      확인
    </Button>
  </DialogActions>
</Dialog>
```

- 기존 Dialog에 TextField와 Alert 추가
- Dialog 닫을 때 입력 텍스트와 에러 메시지 초기화
- 사용자에게 "회원 탈퇴"를 정확히 입력하도록 안내

### 3. handleDelete 함수 구현

```javascript
const handleDelete = async () => {
  setDeleteError(null);

  // "회원 탈퇴" 텍스트 일치 검증
  if (deleteConfirmText !== '회원 탈퇴') {
    setDeleteError('"회원 탈퇴"를 정확히 입력해주세요.');
    return;
  }

  try {
    // 회원 삭제 (DELETE /api/v1/users/{user_id})
    console.log('회원 삭제 API 호출 시작');
    await axios.delete(`/api/v1/users/${user.id}`, {
      headers: { 'X-API-Key': 'hexsera-secret-api-key-2026' }
    });
    console.log('회원 삭제 API 호출 성공');

    // 로그아웃 및 메인 페이지 이동
    setDeleteDialogOpen(false);
    logout();
    navigate('/');
  } catch (err) {
    console.error('회원 탈퇴 실패:', err);

    // 사용자를 찾을 수 없음 (404)
    if (err.response?.status === 404) {
      setDeleteError('사용자를 찾을 수 없습니다.');
    }
    // 기타 에러
    else {
      setDeleteError('회원 탈퇴에 실패했습니다.');
    }
  }
};
```

- **무엇을 하는가**: "회원 탈퇴" 텍스트 검증 후 회원 삭제 및 로그아웃 처리
- 입력값이 "회원 탈퇴"와 정확히 일치하는지 검증 (대소문자, 띄어쓰기 구분)
- DELETE /api/v1/users/{user_id}로 회원 삭제 (API Key 필요)
- 성공 시 logout() 호출하여 localStorage 제거 및 AuthContext 상태 초기화
- navigate('/')로 메인 페이지 이동
- 에러 발생 시 상태 코드별로 적절한 에러 메시지 표시

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| /home/hexsera/Pinball_web/react/main/src/UserInfo.jsx | 수정 | "회원 탈퇴" 텍스트 입력 상태 추가, Dialog에 TextField 추가, handleDelete 함수 구현 |

## 완료 체크리스트

- [o] 회원 탈퇴 버튼 클릭 시 텍스트 입력 Dialog가 표시되는지 확인
- [o] "회원 탈퇴"를 입력하지 않고 확인 버튼 클릭 시 오류 메시지 표시
- [o] "회원탈퇴" (띄어쓰기 없음) 입력 시 오류 메시지 표시
- [x] "회원 탈퇴"를 정확히 입력 시 회원이 삭제되고 메인 페이지로 이동
- [o] 회원 삭제 후 로그인 상태가 해제되는지 확인 (localStorage에서 user 정보 제거)
- [o] 삭제된 회원으로 다시 로그인 시도 시 로그인 실패 확인
- [o] Dialog 취소 버튼 클릭 시 입력 텍스트와 에러 메시지가 초기화되는지 확인
- [o] 콘솔에 에러 없이 실행되는지 확인
