# 프론트엔드 구조 개선 실행계획

## 요구사항 요약

**요구사항**: 현재 평면적 구조의 React 프로젝트를 컴포넌트 기반 계층 구조로 재구성

**목적**:
- 컴포넌트 재사용성 향상 (공통 컴포넌트 분리)
- 코드 유지보수성 개선 (역할별 폴더 구조)
- API 호출 로직 중앙화 (services 레이어)
- 비즈니스 로직과 UI 분리 (hooks, utils)

## 현재상태 분석

**현재 구조**:
```
Pinball_web/
├── react/
│   └── main/           # 현재 프론트엔드 위치
│       ├── src/
│       │   ├── admin/  # Admin 관련 컴포넌트 (8개 파일)
│       │   ├── App.jsx
│       │   ├── AuthContext.jsx
│       │   ├── Dashboard.jsx
│       │   ├── Login.jsx
│       │   ├── Register.jsx
│       │   ├── Pinball.jsx
│       │   ├── UserInfo.jsx
│       │   └── main.jsx
│       ├── package.json
│       └── vite.config.js
└── backend/            # FastAPI 백엔드
```

**문제점**:
- 프론트엔드가 react/main/ 경로에 위치 (명확성 부족)
- 모든 페이지 컴포넌트가 src/ 루트에 위치 (계층 구조 부재)
- API 호출 로직이 각 컴포넌트에 분산 (axios 호출 중복)
- 재사용 가능한 공통 컴포넌트 미분리 (Sidebar, Header 등)
- 비즈니스 로직과 UI 로직이 혼재

## 구현 방법

**기술 스택**: React, Material-UI, React Router, Axios (기존 유지)

**목표 구조**:
```
Pinball_web/
├── frontend/          # 프론트엔드 (react/main → frontend로 변경)
│   ├── public/
│   │   └── images/
│   ├── src/
│   │   ├── components/    # 재사용 컴포넌트
│   │   │   ├── common/   # 공통 UI (Button, Input 등)
│   │   │   └── layout/   # 레이아웃 (Sidebar, Header)
│   │   ├── pages/        # 페이지 컴포넌트
│   │   │   ├── Dashboard/
│   │   │   ├── Login/
│   │   │   ├── Register/
│   │   │   ├── Pinball/
│   │   │   ├── UserInfo/
│   │   │   └── admin/
│   │   ├── contexts/     # React Context
│   │   ├── hooks/        # 커스텀 훅
│   │   ├── services/     # API 호출 로직
│   │   ├── utils/        # 유틸리티 함수
│   │   ├── App.jsx
│   │   └── main.jsx
│   ├── package.json
│   └── vite.config.js
└── backend/           # FastAPI 백엔드
```

**마이그레이션 전략**:
- Phase 0: react/main → frontend 폴더명 변경 및 Docker 설정 업데이트
- Phase 1~7: 점진적 내부 구조 개선 (기능 단위로 분리)
- 각 Phase 완료 후 동작 검증
- import 경로 변경 최소화 (barrel exports 활용)

## 구현 단계

### Phase 0: react/main 폴더를 frontend로 변경

```bash
# react/main 폴더를 frontend로 이동
cd /home/hexsera/Pinball_web
mv react/main frontend
```
- react/main 폴더를 frontend로 이름 변경
- 프로젝트 구조 명확화 (react/main → frontend)
- react 중간 폴더 제거

```bash
# react 폴더 제거 (비어있는 경우)
rmdir react
```
- react 폴더가 비어있으면 제거
- 불필요한 중첩 구조 제거

```nginx
# nginx.conf 수정 (frontend 빌드 경로 참조용 주석)
# 현재는 html-data-volume 사용으로 수정 불필요
# 향후 빌드 스크립트에서 frontend/dist 경로 사용
```
- nginx.conf는 html-data-volume을 사용하므로 수정 불필요
- 빌드 스크립트에서 frontend/dist 경로 참조
- CLAUDE.md 문서 업데이트 필요

```markdown
# CLAUDE.md 업데이트
## React 개발 (./frontend/)
\`\`\`bash
cd frontend
npm install
npm run start    # 개발 서버 (Vite)
npm run build    # 프로덕션 빌드 → dist/
\`\`\`
```
- CLAUDE.md의 모든 react/main 경로를 frontend로 변경
- 프로젝트 구조 섹션 업데이트
- 개발 가이드 경로 수정

```bash
# 변경사항 동작 확인
cd frontend
npm run dev
```
- 개발 서버가 정상 작동하는지 확인
- 브라우저에서 localhost:5173 접속 테스트
- 모든 페이지가 정상 렌더링되는지 확인

### Phase 1: 디렉토리 구조 생성 및 Context 이동

```bash
# 디렉토리 생성
mkdir -p src/components/common
mkdir -p src/components/layout
mkdir -p src/pages/Dashboard
mkdir -p src/pages/Login
mkdir -p src/pages/Register
mkdir -p src/pages/Pinball
mkdir -p src/pages/UserInfo
mkdir -p src/pages/admin
mkdir -p src/contexts
mkdir -p src/hooks
mkdir -p src/services
mkdir -p src/utils
```
- 새로운 폴더 구조 생성
- 기존 파일은 유지 (점진적 이동)

```javascript
// src/contexts/AuthContext.jsx로 이동
// 기존: src/AuthContext.jsx
// 변경 없음, 위치만 이동
```
- AuthContext.jsx를 src/contexts/로 이동
- App.jsx에서 import 경로 수정: `'./contexts/AuthContext'`

```javascript
// src/contexts/index.js (barrel export)
export { AuthProvider, useAuth } from './AuthContext';
```
- contexts 폴더의 진입점 생성
- 다른 파일에서 `import { useAuth } from '@/contexts'` 형태로 사용 가능

### Phase 2: 공통 레이아웃 컴포넌트 분리

```javascript
// src/components/layout/Sidebar.jsx
import { Drawer, List, ListItem, ListItemButton, ListItemIcon, ListItemText } from '@mui/material';
import { Dashboard, Person, CalendarMonth, Description, BarChart } from '@mui/icons-material';

export default function Sidebar({ open, onMenuClick }) {
  const menuItems = [
    { text: '메인페이지', icon: <Dashboard />, action: 'main' },
    { text: '계정', icon: <Person />, action: 'userInfo' },
    { text: '게임하기', icon: <CalendarMonth />, action: 'pinball' },
  ];

  return (
    <Drawer variant="permanent" sx={{ width: 240 }}>
      <List>
        {menuItems.map((item) => (
          <ListItem key={item.text}>
            <ListItemButton onClick={() => onMenuClick(item.action)}>
              <ListItemIcon>{item.icon}</ListItemIcon>
              <ListItemText primary={item.text} />
            </ListItemButton>
          </ListItem>
        ))}
      </List>
    </Drawer>
  );
}
```
- Dashboard.jsx에서 Sidebar 로직 추출
- props로 메뉴 클릭 핸들러 전달
- 재사용 가능한 독립 컴포넌트로 분리

```javascript
// src/components/layout/Header.jsx
import { AppBar, Toolbar, Typography, IconButton, Badge } from '@mui/material';
import { Notifications, Mail } from '@mui/icons-material';

export default function Header({ onNotificationClick }) {
  return (
    <AppBar position="fixed" sx={{ zIndex: (theme) => theme.zIndex.drawer + 1 }}>
      <Toolbar>
        <Typography variant="h6" sx={{ flexGrow: 1 }}>
          Pinball Game
        </Typography>
        <IconButton color="inherit" onClick={onNotificationClick}>
          <Badge badgeContent={4} color="error">
            <Notifications />
          </Badge>
        </IconButton>
        <IconButton color="inherit">
          <Mail />
        </IconButton>
      </Toolbar>
    </AppBar>
  );
}
```
- Dashboard.jsx에서 Header 로직 추출
- 알림 클릭 핸들러를 props로 전달
- AppBar 스타일링 유지

```javascript
// src/components/layout/index.js
export { default as Sidebar } from './Sidebar';
export { default as Header } from './Header';
```
- layout 컴포넌트 barrel export
- `import { Sidebar, Header } from '@/components/layout'` 형태로 사용

### Phase 3: API 서비스 레이어 생성

```javascript
// src/services/api.js
import axios from 'axios';

const API_BASE_URL = '/api/v1';
const API_KEY = 'hexsera-secret-api-key-2026';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
  },
});

// API Key가 필요한 요청에 자동으로 헤더 추가
export const apiClientWithKey = axios.create({
  baseURL: API_BASE_URL,
  headers: {
    'Content-Type': 'application/json',
    'X-API-Key': API_KEY,
  },
});

export default apiClient;
```
- axios 인스턴스 중앙화
- API Key 헤더 자동 추가
- 기본 URL 설정으로 중복 제거

```javascript
// src/services/authService.js
import apiClient from './api';

export const authService = {
  login: async (email, password) => {
    const response = await apiClient.post('/login', { email, password });
    return response.data;
  },

  register: async (userData) => {
    const response = await apiClient.post('/register', userData);
    return response.data;
  },
};
```
- 인증 관련 API 호출 함수 모음
- 컴포넌트에서 axios 직접 호출 제거
- 에러 핸들링 중앙화 가능

```javascript
// src/services/userService.js
import { apiClientWithKey } from './api';

export const userService = {
  getUser: async (userId) => {
    const response = await apiClientWithKey.get(`/users/${userId}`);
    return response.data;
  },

  updateUser: async (userId, userData) => {
    const response = await apiClientWithKey.put(`/users/${userId}`, userData);
    return response.data;
  },

  deleteUser: async (userId) => {
    const response = await apiClientWithKey.delete(`/users/${userId}`);
    return response.data;
  },
};
```
- 사용자 정보 관련 API 호출 함수
- API Key 인증이 필요한 요청은 apiClientWithKey 사용
- CRUD 작업 함수화

```javascript
// src/services/index.js
export { default as apiClient, apiClientWithKey } from './api';
export * from './authService';
export * from './userService';
```
- services 폴더 barrel export
- `import { authService, userService } from '@/services'` 형태로 사용

### Phase 4: 페이지 컴포넌트 이동 (Login, Register)

```javascript
// src/pages/Login/Login.jsx
// 기존 src/Login.jsx 파일 내용 그대로 이동
// import 경로만 수정
import { useAuth } from '../../contexts/AuthContext';
import { authService } from '../../services';

// ... 기존 컴포넌트 로직 ...

// axios 호출 부분 수정
const handleLogin = async () => {
  try {
    const data = await authService.login(email, password);
    login({ id: data.user_id, name: data.nickname });
    navigate('/');
  } catch (error) {
    setLoginError(error.response?.data?.detail || 'Login failed');
  }
};
```
- Login.jsx를 pages/Login/ 폴더로 이동
- authService 사용으로 API 호출 변경
- import 경로 상대경로로 수정

```javascript
// src/pages/Login/index.js
export { default } from './Login';
```
- Login 페이지 barrel export
- App.jsx에서 `import Login from './pages/Login'`으로 사용

```javascript
// src/pages/Register/Register.jsx
// 기존 src/Register.jsx 파일 내용 이동
import { authService } from '../../services';

// axios 호출 부분 수정
const handleRegister = async () => {
  try {
    const data = await authService.register({
      email, nickname, password, birth_date: formattedDate
    });
    navigate('/login');
  } catch (error) {
    setError(error.response?.data?.detail || 'Registration failed');
  }
};
```
- Register.jsx를 pages/Register/ 폴더로 이동
- authService 사용으로 API 호출 변경

```javascript
// src/pages/Register/index.js
export { default } from './Register';
```
- Register 페이지 barrel export

### Phase 5: 페이지 컴포넌트 이동 (Dashboard, UserInfo, Pinball)

```javascript
// src/pages/Dashboard/Dashboard.jsx
// 기존 src/Dashboard.jsx 파일 내용 이동
import { Sidebar, Header } from '../../components/layout';
import { useAuth } from '../../contexts/AuthContext';
import Pinball from '../Pinball';
import UserInfo from '../UserInfo';

// Sidebar와 Header 컴포넌트 사용
function DashboardPage() {
  // ... 기존 상태 및 로직 ...

  return (
    <Box sx={{ display: 'flex' }}>
      <Header onNotificationClick={handleNotificationClick} />
      <Sidebar open={true} onMenuClick={handleMenuClick} />
      {/* 메인 콘텐츠 */}
    </Box>
  );
}
```
- Dashboard.jsx를 pages/Dashboard/ 폴더로 이동
- 분리된 Sidebar, Header 컴포넌트 사용
- 다른 페이지 컴포넌트 상대경로로 import

```javascript
// src/pages/Dashboard/index.js
export { default } from './Dashboard';
```
- Dashboard 페이지 barrel export

```javascript
// src/pages/UserInfo/UserInfo.jsx
// 기존 src/UserInfo.jsx 파일 내용 이동
import { userService } from '../../services';

// API 호출 부분 수정
useEffect(() => {
  const fetchUserInfo = async () => {
    try {
      const data = await userService.getUser(user.id);
      setUserInfo(data);
    } catch (error) {
      console.error('Failed to fetch user info:', error);
    }
  };

  if (user?.id) {
    fetchUserInfo();
  }
}, [user]);
```
- UserInfo.jsx를 pages/UserInfo/ 폴더로 이동
- userService 사용으로 API 호출 변경

```javascript
// src/pages/UserInfo/index.js
export { default } from './UserInfo';
```
- UserInfo 페이지 barrel export

```javascript
// src/pages/Pinball/Pinball.jsx
// 기존 src/Pinball.jsx 파일 내용 그대로 이동
// import 경로만 필요 시 수정
```
- Pinball.jsx를 pages/Pinball/ 폴더로 이동
- Matter.js 로직은 변경 없음

```javascript
// src/pages/Pinball/index.js
export { default } from './Pinball';
```
- Pinball 페이지 barrel export

### Phase 6: Admin 페이지 이동 및 App.jsx 업데이트

```javascript
// src/pages/admin/ 폴더로 모든 admin 파일 이동
// - AdminPage.jsx
// - AdminSidebar.jsx
// - AdminHeader.jsx
// - AdminMain.jsx
// - AdminUserPage.jsx
// - AdminUserMain.jsx
// - AdminStatisticsPage.jsx
// - AdminStatisticsMain.jsx

// import 경로만 상대경로로 수정
```
- src/admin/ 폴더 전체를 src/pages/admin/으로 이동
- 각 파일의 import 경로를 상대경로로 수정
- 컴포넌트 로직은 변경 없음

```javascript
// src/pages/admin/index.js
export { default as AdminPage } from './AdminPage';
export { default as AdminUserPage } from './AdminUserPage';
export { default as AdminStatisticsPage } from './AdminStatisticsPage';
```
- admin 페이지들 barrel export

```javascript
// src/App.jsx 업데이트
import { AuthProvider } from './contexts';
import Login from './pages/Login';
import Register from './pages/Register';
import Dashboard from './pages/Dashboard';
import Pinball from './pages/Pinball';
import { AdminPage, AdminUserPage, AdminStatisticsPage } from './pages/admin';

function App() {
  return (
    <>
      <CssBaseline />
      <AuthProvider>
        <BrowserRouter>
          <Routes>
            <Route path="/" element={<Dashboard />} />
            <Route path="/login" element={<Login />} />
            <Route path="/Register" element={<Register />} />
            <Route path="/Pinball_test" element={<Pinball />} />
            <Route path="/admin" element={<AdminPage />} />
            <Route path="/admin/users" element={<AdminUserPage />} />
            <Route path="/admin/statistics" element={<AdminStatisticsPage />} />
          </Routes>
        </BrowserRouter>
      </AuthProvider>
    </>
  );
}
```
- 모든 import 경로를 새 구조로 업데이트
- barrel exports 활용
- 라우팅 로직은 변경 없음

### Phase 7: Vite 경로 별칭 설정 (선택 사항)

```javascript
// vite.config.js
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@pages': path.resolve(__dirname, './src/pages'),
      '@contexts': path.resolve(__dirname, './src/contexts'),
      '@services': path.resolve(__dirname, './src/services'),
      '@hooks': path.resolve(__dirname, './src/hooks'),
      '@utils': path.resolve(__dirname, './src/utils'),
    },
  },
  // ... 기존 설정 유지 ...
});
```
- 절대경로 import 사용 가능하도록 별칭 설정
- `import { useAuth } from '@contexts'` 형태로 사용
- 상대경로 `../../` 제거로 가독성 향상

```javascript
// 사용 예시: 별칭 적용 후
// Before: import { useAuth } from '../../contexts/AuthContext';
// After:  import { useAuth } from '@contexts';

// Before: import { authService } from '../../services';
// After:  import { authService } from '@services';
```
- 모든 컴포넌트에서 import 경로를 별칭으로 변경
- 파일 이동 시 import 경로 수정 불필요

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `frontend/` | 이동 | `react/main/`에서 이동 (폴더명 변경) |
| `CLAUDE.md` | 수정 | react/main 경로를 frontend로 변경 |
| `src/contexts/AuthContext.jsx` | 이동 | `src/AuthContext.jsx`에서 이동 |
| `src/contexts/index.js` | 생성 | barrel export 파일 |
| `src/components/layout/Sidebar.jsx` | 생성 | Dashboard에서 Sidebar 로직 추출 |
| `src/components/layout/Header.jsx` | 생성 | Dashboard에서 Header 로직 추출 |
| `src/components/layout/index.js` | 생성 | barrel export 파일 |
| `src/services/api.js` | 생성 | axios 인스턴스 중앙화 |
| `src/services/authService.js` | 생성 | 인증 API 함수 |
| `src/services/userService.js` | 생성 | 사용자 API 함수 |
| `src/services/index.js` | 생성 | barrel export 파일 |
| `src/pages/Login/Login.jsx` | 이동 | `src/Login.jsx`에서 이동, service 사용 |
| `src/pages/Login/index.js` | 생성 | barrel export 파일 |
| `src/pages/Register/Register.jsx` | 이동 | `src/Register.jsx`에서 이동, service 사용 |
| `src/pages/Register/index.js` | 생성 | barrel export 파일 |
| `src/pages/Dashboard/Dashboard.jsx` | 이동 | `src/Dashboard.jsx`에서 이동, layout 컴포넌트 사용 |
| `src/pages/Dashboard/index.js` | 생성 | barrel export 파일 |
| `src/pages/UserInfo/UserInfo.jsx` | 이동 | `src/UserInfo.jsx`에서 이동, service 사용 |
| `src/pages/UserInfo/index.js` | 생성 | barrel export 파일 |
| `src/pages/Pinball/Pinball.jsx` | 이동 | `src/Pinball.jsx`에서 이동 |
| `src/pages/Pinball/index.js` | 생성 | barrel export 파일 |
| `src/pages/admin/*.jsx` | 이동 | `src/admin/*.jsx`에서 이동 |
| `src/pages/admin/index.js` | 생성 | barrel export 파일 |
| `src/App.jsx` | 수정 | import 경로 업데이트 |
| `vite.config.js` | 수정 | 경로 별칭 추가 (선택 사항) |

## 완료 체크리스트

**Phase 0 체크리스트**:
- [ ] react/main 폴더가 frontend로 이름 변경되었는지 확인
- [ ] react 폴더가 제거되었는지 확인 (비어있는 경우)
- [ ] CLAUDE.md의 모든 react/main 경로가 frontend로 변경되었는지 확인
- [ ] `cd frontend && npm run dev` 명령어가 정상 실행되는지 확인
- [ ] 브라우저에서 localhost:5173 접속 시 정상 작동하는지 확인

**Phase 1~7 체크리스트**:
- [ ] 모든 페이지가 `/` 경로에서 정상적으로 렌더링되는지 확인
- [ ] 로그인/회원가입 기능이 정상 작동하는지 확인
- [ ] Dashboard에서 Sidebar, Header가 정상 표시되는지 확인
- [ ] UserInfo 페이지에서 API 호출이 정상 작동하는지 확인
- [ ] Admin 페이지들이 정상적으로 접근되는지 확인
- [ ] Pinball 게임이 정상 작동하는지 확인
- [ ] 브라우저 콘솔에 에러가 없는지 확인
- [ ] `npm run build` 명령어가 에러 없이 실행되는지 확인
- [ ] 기존 src/ 루트의 파일들이 모두 제거되었는지 확인 (App.jsx, main.jsx 제외)
