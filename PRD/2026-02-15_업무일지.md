# 업무일지

## 기본 정보
- 날짜: 2026-02-15 (일) 11:30~12:20
- 작성자: hexsera

## 진행 목표

`HeaderUserInfo.jsx`의 아바타 메뉴 dialog를 PRD 요구사항에 맞게 수정한다:
1. dialog 상단에 사용자 이메일 표시
2. dialog 오른쪽 상단에 닫기 버튼 추가
3. "프로필" → "계정설정"으로 변경, 클릭 시 `/dashboard` 계정 섹션으로 이동
4. "친구" MenuItem 추가, 클릭 시 `/dashboard` 친구 섹션으로 이동

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| PRD 요구사항 분석 및 계획 작성 | `PRD/유저 dialog 수정.md`, `PRD/HeaderUserInfo_dialog_수정_계획.md` | TDD 사이클 설계 포함 |
| [RED] 이메일 표시 테스트 작성 | `src/test/HeaderUserInfo.test.jsx` | 실패 확인 완료 |
| [RED] 닫기 버튼 테스트 작성 | `src/test/HeaderUserInfo.test.jsx` | 실패 확인 완료 |
| [RED] 계정설정 MenuItem 테스트 작성 | `src/test/HeaderUserInfo.test.jsx` | 실패 확인 완료 |
| [RED] 친구 MenuItem 테스트 작성 | `src/test/HeaderUserInfo.test.jsx` | 실패 확인 완료 |
| [GREEN] HeaderUserInfo 컴포넌트 수정 | `src/components/HeaderUserInfo.jsx` | 4개 기능 한 번에 구현 |
| [RED] Login email 저장 테스트 작성 | `src/test/Login.test.jsx` | 신규 파일, 실패 확인 완료 |
| [GREEN] Login 컴포넌트 email 저장 추가 | `src/pages/Login/Login.jsx` | 로그인 시 email 함께 저장 |
| Dashboard location.state 연동 | `src/pages/Dashboard/Dashboard.jsx` | navigate state로 섹션 초기화 |
| 전체 테스트 회귀 확인 | — | 11/11 통과 |

## 주요 변경 사항

### 1. HeaderUserInfo.jsx 수정

**변경 전:**
```jsx
import { Box, IconButton, Badge, Avatar, Typography, Button, Menu, MenuItem } from '@mui/material';
import { Notifications, Mail } from '@mui/icons-material';

// Menu 내부
<MenuItem>프로필</MenuItem>
<MenuItem onClick={handlePageNavigation}>페이지 이동</MenuItem>
<MenuItem onClick={() => AvatarLogoutButton()}>로그아웃</MenuItem>
```

**변경 후:**
```jsx
import { Box, IconButton, Badge, Avatar, Typography, Button, Menu, MenuItem, Divider } from '@mui/material';
import { Notifications, Mail, Close } from '@mui/icons-material';

// Menu 내부
<Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', px: 2, py: 1 }}>
  <Typography variant="body2" color="text.secondary">{user.email}</Typography>
  <IconButton aria-label="닫기" size="small" onClick={handleAvatarMenuClose}>
    <Close fontSize="small" />
  </IconButton>
</Box>
<Divider />
<MenuItem onClick={() => { navigate('/dashboard', { state: { section: '계정' } }); handleAvatarMenuClose(); }}>계정설정</MenuItem>
<MenuItem onClick={() => { navigate('/dashboard', { state: { section: '친구' } }); handleAvatarMenuClose(); }}>친구</MenuItem>
<MenuItem onClick={handlePageNavigation}>페이지 이동</MenuItem>
<MenuItem onClick={() => AvatarLogoutButton()}>로그아웃</MenuItem>
```

**특징:**
- 메뉴 상단에 로그인된 사용자의 이메일 표시 (비활성 영역)
- Close 아이콘 버튼으로 메뉴 닫기 가능
- "프로필" 대신 "계정설정"으로 변경, `navigate state`로 Dashboard 계정 섹션 직접 이동
- "친구" MenuItem 신규 추가, `navigate state`로 Dashboard 친구 섹션 직접 이동

---

### 2. Login.jsx 수정

**변경 전:**
```jsx
login({ id: response.data.user_id, name: response.data.nickname, role: response.data.role });
```

**변경 후:**
```jsx
login({ id: response.data.user_id, name: response.data.nickname, role: response.data.role, email: response.data.email });
```

**특징:**
- 백엔드 로그인 API는 이미 `email`을 반환하고 있었으나 프론트에서 저장하지 않았음
- `localStorage`의 `user` 객체에 `email` 추가 저장하여 HeaderUserInfo에서 이메일 표시 가능

---

### 3. Dashboard.jsx 수정

**변경 전:**
```jsx
import { useNavigate } from 'react-router-dom';

function Maindashboard() {
  const navigate = useNavigate();
  // ...
  const handleDrawerToggle = () => { ... };
```

**변경 후:**
```jsx
import { useNavigate, useLocation } from 'react-router-dom';

function Maindashboard() {
  const navigate = useNavigate();
  const location = useLocation();
  // ...
  const handleDrawerToggle = () => { ... };

  useEffect(() => {
    if (location.state?.section === '계정') {
      setShowUserInfo(true);
      setShowFriend(false);
    } else if (location.state?.section === '친구') {
      setShowFriend(true);
      setShowUserInfo(false);
    }
  }, [location.state]);
```

**특징:**
- `navigate('/dashboard', { state: { section: '계정' } })` 로 이동 시 자동으로 계정 섹션 활성화
- `navigate('/dashboard', { state: { section: '친구' } })` 로 이동 시 자동으로 친구 섹션 활성화
- URL에 노출되지 않는 `navigate state` 방식 사용

---

### 4. HeaderUserInfo.test.jsx 수정 (테스트 추가)

**추가된 테스트 (7개 신규):**
```
이메일 표시
  ✓ 아바타 메뉴를 열면 사용자 이메일이 표시된다

닫기 버튼
  ✓ 아바타 메뉴에 닫기 버튼이 있다
  ✓ 닫기 버튼 클릭 시 메뉴가 닫힌다

계정설정 이동
  ✓ 메뉴에 "계정설정" MenuItem이 존재한다
  ✓ "계정설정" 클릭 시 /dashboard로 이동하고 section이 "계정"이다

친구 이동
  ✓ 메뉴에 "친구" MenuItem이 존재한다
  ✓ "친구" 클릭 시 /dashboard로 이동하고 section이 "친구"이다
```

---

### 5. Login.test.jsx 신규 생성

**추가:**
```jsx
// src/test/Login.test.jsx (신규)
it('로그인 성공 시 localStorage에 email이 저장된다', async () => {
  // axios mock으로 로그인 응답에 email 포함
  // localStorage의 user.email이 저장되는지 검증
});
```

---

### 데이터 흐름

```
HeaderUserInfo (아바타 메뉴 클릭)
       │
       ├── "계정설정" 클릭
       │       │
       │       ▼
       │   navigate('/dashboard', { state: { section: '계정' } })
       │       │
       │       ▼
       │   Dashboard.jsx (useEffect → location.state 감지)
       │       │
       │       ▼
       │   setShowUserInfo(true) → UserInfo 컴포넌트 표시
       │
       └── "친구" 클릭
               │
               ▼
           navigate('/dashboard', { state: { section: '친구' } })
               │
               ▼
           Dashboard.jsx (useEffect → location.state 감지)
               │
               ▼
           setShowFriend(true) → FriendPage 컴포넌트 표시
```

## 결과
- 상태: 완료


## 배운 내용

## 다음 작업
- `FriendPage.test.jsx` — "친구" 메뉴 클릭 시 FriendPage 표시 테스트 기존 실패 (`setShowPinball` 미정의 버그) 수정

---

# 업무일지 (2차)

## 기본 정보
- 날짜: 2026-02-15 (일) 1:00~1:20
- 작성자: hexsera

## 진행 목표

`AdminStatisticsMain.jsx`의 API 호출 문제를 해결한다:
1. API 호출 주소 trailing slash 제거
2. Mock 데이터 관련 코드 전체 제거

## 진행 내용

| 작업 | 수정 파일 | 비고 |
|------|----------|------|
| API 경로 trailing slash 제거 | `src/pages/admin/AdminStatisticsMain.jsx` | 307 리다이렉트 방지 |
| `generateMockDailyData` 함수 제거 | `src/pages/admin/AdminStatisticsMain.jsx` | 개발용 임시 함수 삭제 |
| catch 블록 Mock 데이터 로직 제거 | `src/pages/admin/AdminStatisticsMain.jsx` | 에러 로그만 유지 |

## 주요 변경 사항

### 1. AdminStatisticsMain.jsx 수정

**변경 전:**
```jsx
// 임시 일별 데이터 생성 함수 (3개월 분량)
const generateMockDailyData = (startDate, endDate) => {
  const dailyData = [];
  // ... 랜덤 더미 데이터 생성 로직
  return dailyData;
};

const response = await axios.get('/api/v1/game_visits/', { ... });

} catch (error) {
  console.error('통계 데이터 로딩 실패:', error);
  const mockDailyData = generateMockDailyData(mockStartDate, mockEndDate);
  setDailyData(mockDailyData);
}
```

**변경 후:**
```jsx
const response = await axios.get('/api/v1/game_visits', { ... });

} catch (error) {
  console.error('통계 데이터 로딩 실패:', error);
}
```

**특징:**
- `CLAUDE.md`의 `redirect_slashes=False` 설정에 따라 trailing slash 제거로 307 리다이렉트 방지
- `generateMockDailyData` 함수(19줄) 전체 삭제
- `catch` 블록에서 Mock 데이터 생성 및 `setDailyData(mockDailyData)` 호출 제거
- API 정상 응답 처리(`setDailyData(dailyDataFromAPI.stats)`)는 기존과 동일하게 유지

### 데이터 흐름

```
AdminStatisticsMain (마운트)
       │
       ▼
GET /api/v1/game_visits?start_date=...&end_date=...
       │
       ▼
FastAPI: get_daily_visit_stats()
       │  날짜별 접속자 수 집계 (game_visits 테이블)
       ▼
{ stats: [{date, user_count}, ...], total_days, start_date, end_date }
       │
       ▼
setDailyData(response.data.stats)
       │
       ▼
LineChart (x축: date, y축: user_count)
```

## 결과
- 상태: 완료

## 배운 내용

## 다음 작업

