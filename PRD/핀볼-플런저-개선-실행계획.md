# 핀볼 플런저 개선 실행계획

## 요구사항 요약

**요구사항**: 플런저 위에 발판벽 추가, 발사 영역 빨간색 디버그 렌더링, 플런저 스프링 시각화

**목적**: 플런저 발사 구역을 명확히 정의하고, 시각적으로 스프링처럼 표현하여 게임 완성도를 높인다.

## 현재상태 분석

- 플런저: `Bodies.rectangle(662, 1050, 30, 15)` — 회색 사각형, 물리 바디만 존재
- 공 초기 위치: `(662, 1020)` — 발판 없이 허공에 배치됨
- 발사 영역 감지: `ballInLane` 조건으로 코드 내부에서만 관리, 시각적 표시 없음
- 스프링 시각화 없음 — 플런저가 단순 사각형으로만 렌더링됨
- `afterRender` 이벤트에 범퍼/타겟 커스텀 렌더링 코드가 이미 존재함

## 구현 방법

- **발판벽**: Matter.js `Bodies.rectangle()`로 정적 바디 생성 후 `World.add()`로 추가
- **발사 영역 시각화**: `afterRender` 이벤트의 Canvas 2D Context로 반투명 빨간 사각형 드로잉
- **스프링 시각화**: `afterRender`에서 플런저 현재 y좌표 기반으로 지그재그 코일 선을 Canvas에 직접 드로잉

## 구현 단계

### 1. 발판벽(Shelf Wall) Body 생성

```javascript
// PLUNGER_REST_Y = 1050 위에 배치 (공 반지름 15 + 여유 5 = 20px 위)
const SHELF_Y = 1030; // 발판벽 y좌표 상수 추가

const plungerShelf = Bodies.rectangle(662, SHELF_Y, 80, 10, {
  isStatic: true,
  label: 'plungerShelf',
  render: { fillStyle: '#16213e' }
});
```
- **무엇을 하는가**: 플런저 레인 안에서 공이 올라설 수 있는 수평 발판을 생성
- 너비 80px은 플런저 레인(약 85px) 내부에 맞게 설정
- `isStatic: true`로 충격을 받아도 움직이지 않음
- `World.add()`에 `plungerShelf`를 추가해야 함

### 2. 공 초기 위치 및 재시작 위치 수정

```javascript
// 공 초기 생성 위치 수정 (발판벽 위)
const ball = Bodies.circle(662, SHELF_Y - 25, 15, { ... });

// handleRestart 내부 수정
Body.setPosition(ball, { x: 662, y: SHELF_Y - 25 });

// plungerReleaseRef 및 handleKeyUp 내 ballInLane 조건 수정
const ballInLane = ball.position.x > 620 && ball.position.x < 705 &&
                   ball.position.y > SHELF_Y - 50 && ball.position.y < SHELF_Y + 10;
```
- **무엇을 하는가**: 공 시작 위치를 발판벽 위로 맞추고 발사 조건도 함께 갱신
- `SHELF_Y - 25` = 발판벽 y(1030) - 공반지름(15) - 여유(10) = 1005
- `handleRestart`(138번째 줄)의 `setPosition` 좌표도 동일하게 수정

### 3. 발사 영역 빨간색 디버그 렌더링

```javascript
// afterRender 이벤트 내부 (기존 범퍼 렌더링 코드 앞에 추가)
const LAUNCH_ZONE = { x: 620, y: SHELF_Y - 50, w: 85, h: 60 };

ctx.save();
ctx.fillStyle = 'rgba(255, 0, 0, 0.25)';
ctx.strokeStyle = 'rgba(255, 0, 0, 0.7)';
ctx.lineWidth = 1.5;
ctx.fillRect(LAUNCH_ZONE.x, LAUNCH_ZONE.y, LAUNCH_ZONE.w, LAUNCH_ZONE.h);
ctx.strokeRect(LAUNCH_ZONE.x, LAUNCH_ZONE.y, LAUNCH_ZONE.w, LAUNCH_ZONE.h);
ctx.restore();
```
- **무엇을 하는가**: 공이 플런저로 발사될 수 있는 유효 영역을 빨간 반투명 사각형으로 표시
- `LAUNCH_ZONE` 좌표는 `ballInLane` 조건과 동일한 범위를 사용
- 매 프레임 렌더링되므로 실시간으로 위치가 표시됨

### 4. 플런저 스프링 코일 시각화

```javascript
// afterRender 이벤트 내부 (발사 영역 렌더링 다음에 추가)
const px = plunger.position.x;
const py = plunger.position.y + 8; // 플런저 바닥에서 시작
const bottomY = 1100;              // 캔버스 바닥
const coilCount = 12;
const coilWidth = 12;
const segH = (bottomY - py) / coilCount;

ctx.save();
ctx.strokeStyle = '#b0b0b0';
ctx.lineWidth = 2.5;
ctx.shadowColor = '#888888';
ctx.shadowBlur = 4;
ctx.beginPath();
ctx.moveTo(px, py);
for (let i = 0; i < coilCount; i++) {
  const dirX = (i % 2 === 0) ? coilWidth : -coilWidth;
  ctx.lineTo(px + dirX, py + segH * (i + 0.5));
  ctx.lineTo(px, py + segH * (i + 1));
}
ctx.stroke();
ctx.restore();
```
- **무엇을 하는가**: 플런저 바디 아래에서 캔버스 바닥까지 지그재그 코일 선을 그려 스프링처럼 보이게 함
- `segH = (bottomY - py) / coilCount` — 플런저가 내려갈수록(py 증가) 코일 간격이 좁아져 압축 표현
- `coilCount = 12` — 코일 반복 횟수, 조정 가능
- `plunger.position`은 Matter.js가 매 프레임 업데이트하므로 자동으로 위치 반영됨

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `frontend/src/pages/Pinball/Pinball.jsx` | 수정 | 발판벽 Body 추가, 공 위치 수정, afterRender 스프링·발사영역 드로잉, ballInLane 조건 수정 |

## 완료 체크리스트

- [ ] 게임 실행 시 플런저 레인 안에 수평 발판이 보이고, 공이 그 위에 올라가 있다
- [ ] 발판 위 공이 플런저로 발사된다 (스페이스바 or 터치 버튼)
- [ ] 플런저 발사 영역이 빨간색 반투명 사각형으로 표시된다
- [ ] 플런저 아래에 스프링 코일 모양이 렌더링된다
- [ ] 플런저를 당길 때(스페이스 홀드) 스프링이 압축되는 모양으로 변한다
- [ ] 재시작 후에도 공이 발판 위에 정확히 배치된다
- [ ] 브라우저 콘솔에 에러가 없다
