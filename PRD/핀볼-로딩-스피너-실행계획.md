# 핀볼 로딩 스피너 실행계획

## 요구사항 요약

**요구사항**: 핀볼 게임 페이지 진입 시 Matter.js 물리 엔진과 캔버스가 초기화되는 동안 로딩 스피너를 표시하고, 준비가 완료된 후 게임을 보여준다.

**목적**: 현재 Matter.js 렌더러가 초기화되기 전 빈 화면이나 깨진 레이아웃이 잠깐 보이는 문제를 방지하고 사용자에게 로딩 중임을 알린다.

## 현재상태 분석

- `PinballPage.jsx`: `<Pinball />` 컴포넌트를 바로 렌더링하며 로딩 처리 없음.
- `Pinball.jsx`: `useEffect` 안에서 Matter.js 엔진, 렌더러, 오디오 객체를 동기적으로 초기화함. 초기화 완료를 외부에 알리는 수단이 없음.
- Matter.js `Render.run()` 호출 후 `afterRender` 이벤트의 첫 번째 콜백 시점이 실제 첫 프레임이 그려지는 시점임.

## 구현 방법

- `PinballPage.jsx`에 `isReady` state를 추가하여 스피너/게임 표시를 제어한다.
- `Pinball` 컴포넌트에 `onReady` prop을 추가한다.
- `Pinball` 내부에서 Matter.js `afterRender` 이벤트 최초 1회 콜백에서 `onReady()`를 호출한다.
- `PinballPage`에서 `isReady`가 `false`일 때 스피너를 표시하고, `Pinball`은 `visibility: hidden`으로 DOM에는 유지하되 화면에서 숨긴다 (DOM에서 제거하면 Matter.js 초기화가 실행되지 않음).

## 구현 단계

### 1. `PinballPage.jsx`에 `isReady` state 및 스피너 추가

```jsx
import { CircularProgress } from '@mui/material';

// state 추가
const [isReady, setIsReady] = useState(false);

// JSX - Pinball을 visibility로 숨기고 스피너 오버레이 추가
<Box sx={{ position: 'relative' }}>
  <Box sx={{ visibility: isReady ? 'visible' : 'hidden' }}>
    <Pinball onReady={() => setIsReady(true)} />
  </Box>
  {!isReady && (
    <Box sx={{
      position: 'absolute', top: 0, left: 0,
      width: '100%', height: '100%',
      backgroundColor: '#000000',
      display: 'flex', justifyContent: 'center', alignItems: 'center',
      zIndex: 50,
    }}>
      <CircularProgress size={64} sx={{ color: '#ffffff' }} />
    </Box>
  )}
</Box>
```

- **무엇을 하는가**: 스피너 표시와 게임 숨김을 `PinballPage`에서 담당
- `visibility: hidden`은 요소를 DOM에 유지하면서 화면에서만 숨김 → Matter.js `useEffect` 정상 실행됨
- `display: none`을 사용하면 `sceneRef.current`가 null이 되어 Matter.js 렌더러 초기화 실패

### 2. `Pinball.jsx`에 `onReady` prop 수신 및 호출

```javascript
// 함수 시그니처 변경
function Pinball({ onReady }) {

// afterRender 이벤트 내부 - 기존 범퍼 글로우 코드 위에 추가
let firstFrameFired = false;
Events.on(render, 'afterRender', () => {
  if (!firstFrameFired) {
    firstFrameFired = true;
    onReady?.();  // PinballPage에 준비 완료 알림
  }
  // 기존 범퍼 글로우 렌더링 코드 (유지)
  const ctx = render.context;
  // ...
});
```

- **무엇을 하는가**: 렌더러가 첫 프레임을 그린 직후 `PinballPage`로 준비 완료를 알림
- `firstFrameFired` 지역 변수로 단 1회만 실행하도록 제한
- `onReady?.()` 옵셔널 체이닝으로 prop이 없을 때도 에러 없이 동작

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `frontend/src/pages/PinballPage/PinballPage.jsx` | 수정 | `CircularProgress` import, `isReady` state 추가, 스피너 오버레이 JSX 및 `onReady` prop 전달 |
| `frontend/src/pages/Pinball/Pinball.jsx` | 수정 | `onReady` prop 수신, `afterRender` 이벤트에 첫 프레임 감지 후 `onReady()` 호출 |

## 완료 체크리스트

- [ ] 핀볼 페이지 진입 시 빨간 원형 스피너가 중앙에 표시되는지 확인
- [ ] 스피너가 사라진 후 게임 화면이 정상적으로 표시되는지 확인
- [ ] 게임 시작 오버레이("PRESS SPACE TO START")가 스피너 이후 정상 노출되는지 확인
- [ ] 게임 플레이 중 스피너가 다시 나타나지 않는지 확인
- [ ] 모바일(터치 디바이스)에서도 동일하게 동작하는지 확인
