# 회원정보 수정 실행계획

## 요구사항 요약

**요구사항**: UserInfo.jsx 페이지의 회원정보 수정 기능을 FastAPI와 연동하여 닉네임, 생년월일, 비밀번호를 변경할 수 있도록 구현

**목적**: 사용자가 회원정보를 직접 수정할 수 있도록 하여 계정 관리 기능 제공

## 현재상태 분석

UserInfo.jsx에는 회원정보 수정 UI가 이미 구현되어 있으나 `handleUpdate` 함수가 TODO 상태입니다.
- 닉네임 입력란: `editNickname` 상태로 관리
- 비밀번호 입력란: `editPassword` 상태로 관리
- 생년월일 입력란: 현재 없음 (PRD 요구사항에 따라 추가 필요)
- FastAPI PUT /api/v1/users/{user_id} 엔드포인트는 이미 구현되어 있음
- API Key 인증 필요 (X-API-Key: hexsera-secret-api-key-2026)

## 구현 방법

React의 axios를 사용하여 FastAPI PUT /api/v1/users/{user_id}를 호출합니다.
- 입력된 필드만 업데이트 요청 (부분 수정 지원)
- API Key 헤더 포함
- 성공/실패 시 사용자에게 피드백 제공
- 생년월일 입력란 추가 (MUI DatePicker 또는 TextField)

## 구현 단계

### 1. 생년월일 입력란 상태 추가
```javascript
// 회원 정보 수정 상태
const [editNickname, setEditNickname] = useState('');
const [editPassword, setEditPassword] = useState('');
const [editBirthDate, setEditBirthDate] = useState(''); // 추가
const [updateSuccess, setUpdateSuccess] = useState(false);
const [updateError, setUpdateError] = useState(null);
```
- 생년월일 수정을 위한 상태 변수 추가
- 날짜 형식: YYYY-MM-DD (FastAPI와 동일)

### 2. 생년월일 입력 필드 추가
```javascript
<TextField
  fullWidth
  label="생년월일"
  type="date"
  placeholder="YYYY-MM-DD"
  value={editBirthDate}
  onChange={(e) => setEditBirthDate(e.target.value)}
  InputLabelProps={{ shrink: true }}
/>
```
- type="date"로 브라우저 네이티브 날짜 선택기 사용
- InputLabelProps로 label 위치 고정
- 비밀번호 필드 아래에 배치

### 3. handleUpdate 함수 구현
```javascript
const handleUpdate = async () => {
  setUpdateError(null);
  setUpdateSuccess(false);

  // 수정할 필드가 하나도 없는지 검증
  if (!editNickname && !editPassword && !editBirthDate) {
    setUpdateError('수정할 정보를 입력해주세요.');
    return;
  }

  try {
    // 입력된 필드만 포함하는 객체 생성
    const updateData = {};
    if (editNickname) updateData.nickname = editNickname;
    if (editPassword) updateData.password = editPassword;
    if (editBirthDate) updateData.birth_date = editBirthDate;

    console.log('회원 정보 수정 API 호출 시작:', updateData);

    const response = await axios.put(
      `/api/v1/users/${user.id}`,
      updateData,
      {
        headers: { 'X-API-Key': 'hexsera-secret-api-key-2026' }
      }
    );

    console.log('회원 정보 수정 API 호출 성공:', response.data);

    // 성공 시 상태 초기화 및 회원 정보 다시 조회
    setUpdateSuccess(true);
    setEditNickname('');
    setEditPassword('');
    setEditBirthDate('');

    // 회원 정보 갱신 (nickname이 변경된 경우 화면에 반영)
    setUserInfo({
      email: response.data.email,
      nickname: response.data.nickname,
      birth_date: response.data.birth_date
    });

  } catch (err) {
    console.error('회원 정보 수정 API 호출 실패:', err);

    if (err.response?.status === 400) {
      setUpdateError('이메일이 이미 사용 중입니다.');
    } else if (err.response?.status === 404) {
      setUpdateError('사용자를 찾을 수 없습니다.');
    } else {
      setUpdateError('회원 정보 수정에 실패했습니다.');
    }
  }
};
```
- 입력된 필드만 updateData 객체에 포함 (부분 수정)
- axios.put으로 PUT /api/v1/users/{user_id} 호출
- API Key 헤더 포함
- 성공 시: 입력란 초기화, 회원 정보 갱신, 성공 메시지 표시
- 실패 시: 에러 상태 코드에 따라 적절한 메시지 표시

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| /home/hexsera/Pinball_web/react/main/src/UserInfo.jsx | 수정 | 생년월일 입력란 추가, handleUpdate 함수 API 연동 구현 |

## 완료 체크리스트

- [o] 회원정보 수정 영역에 닉네임, 비밀번호, 생년월일 입력란이 모두 표시됨
- [o] 닉네임만 입력 후 수정 버튼 클릭 시 닉네임만 변경됨
- [o] 비밀번호만 입력 후 수정 버튼 클릭 시 비밀번호만 변경됨
- [o] 생년월일만 입력 후 수정 버튼 클릭 시 생년월일만 변경됨
- [o] 여러 필드를 동시에 입력하고 수정 시 모두 변경됨
- [o] 수정 성공 시 성공 메시지가 표시되고 입력란이 초기화됨
- [o] 수정 성공 시 회원 정보 조회 영역에 변경된 정보가 즉시 반영됨
- [o] 아무 정보도 입력하지 않고 수정 버튼 클릭 시 에러 메시지 표시됨
- [o] 브라우저 콘솔에 API 호출 시작/성공/실패 로그가 출력됨
