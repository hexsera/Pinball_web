# 핀볼 사운드 마스터 볼륨 실행계획

## 요구사항 요약

**요구사항**: 소리 아이콘 on 시 모든 사운드 볼륨을 정상 재생, off 시 모든 사운드를 음소거(볼륨 0)로 만든다.

**목적**: 현재 아이콘 off 시 BGM만 정지되고 효과음은 계속 재생되는 문제를 해결하여, 사용자가 소리를 완전히 끄고 싶을 때 모든 사운드가 실제로 꺼지도록 한다.

## 현재상태 분석

- `isPlaying` 상태로 BGM만 `pause()`/`play()` 토글하고 있음
- 효과음(hitSound, flipperSound, lifeDownSound 등)은 `handleToggleMusic`과 무관하게 항상 재생됨
- 각 Audio 객체는 개별 볼륨으로 초기화됨 (bgm: 0.05, hit: 0.5, flipper: 0.5, lifedown/gameover/bumper: 0.7)
- 마스터 볼륨 개념이 없어 모든 사운드를 일괄 제어하는 방법이 없음

## 구현 방법

- `isMuted` boolean 상태를 추가하여 음소거 여부를 관리한다.
- 각 Audio 객체의 개별 볼륨은 유지하되, `muted` 프로퍼티로 음소거를 제어한다.
- `Audio.muted = true/false`는 HTML Audio Element의 표준 속성으로, 볼륨 값을 변경하지 않고 출력만 차단한다.
- BGM은 `pause/play` 대신 `muted` 제어로 전환하여 게임 중 재생 상태를 유지한다.
- 아이콘은 `isMuted` 상태 기반으로 렌더링한다.

## 구현 단계

### 1. `isMuted` 상태 추가 및 `isPlaying` 관련 코드 제거

```javascript
// 라인 47: 기존 코드
const [isPlaying, setIsPlaying] = useState(false);

// 변경 후
const [isMuted, setIsMuted] = useState(false);
```

- **무엇을 하는가**: BGM 재생 여부 추적용 `isPlaying`을 제거하고, 전체 음소거 상태를 추적하는 `isMuted`로 교체한다.
- `isMuted: false` = 소리 on (정상 재생), `isMuted: true` = 소리 off (음소거)

### 2. `handleToggleMusic` 핸들러 수정

```javascript
// 라인 71-82: 기존 코드 교체
const handleToggleMusic = () => {
  const allRefs = [bgmRef, hitSoundRef, fliperSoundRef, lifeDownSoundRef, gameoverSoundRef, bumperSoundRef];
  const nextMuted = !isMuted;
  allRefs.forEach(ref => {
    if (ref.current) ref.current.muted = nextMuted;
  });
  setIsMuted(nextMuted);
};
```

- **무엇을 하는가**: 버튼 클릭 시 모든 Audio 객체의 `muted` 프로퍼티를 동시에 전환한다.
- `muted = true`로 설정하면 해당 오디오의 출력이 차단되고, `false`로 되돌리면 즉시 소리가 복원된다.
- BGM은 `pause/play`하지 않으므로 게임 도중 재생 위치를 유지한다.

### 3. `startGame` 함수에서 `setIsPlaying` 호출 제거

```javascript
// 라인 85-92: 기존 코드
const startGame = () => {
  if (gameStartedRef.current) return;
  gameStartedRef.current = true;
  setGameStarted(true);
  engineRef.current.timing.timeScale = 1;
  bgmRef.current?.play().catch(() => {});
  setIsPlaying(true);  // ← 이 줄 제거
};
```

- **무엇을 하는가**: BGM 재생은 유지하되, 더 이상 사용하지 않는 `setIsPlaying(true)` 호출을 제거한다.
- BGM은 게임 시작 시 항상 `play()` 되며, 음소거 여부는 `isMuted`가 결정한다.

### 4. 아이콘 렌더링 조건 변경

```javascript
// 라인 1010-1022: 기존 조건
{isPlaying ? (
  <VolumeUpIcon sx={{ fontSize: '36px' }} />
) : (
  <VolumeOffIcon sx={{ fontSize: '36px' }} />
)}

// 변경 후
{!isMuted ? (
  <VolumeUpIcon sx={{ fontSize: '36px' }} />
) : (
  <VolumeOffIcon sx={{ fontSize: '36px' }} />
)}
```

- **무엇을 하는가**: 아이콘 표시 기준을 `isPlaying`(BGM 재생 여부)에서 `isMuted`(전체 음소거 여부)로 변경한다.
- `isMuted: false` → VolumeUpIcon (소리 켜짐), `isMuted: true` → VolumeOffIcon (음소거)

## 수정/생성할 파일 목록

| 파일 경로 | 작업 유형 | 변경 내용 |
|-----------|-----------|-----------|
| `frontend/src/pages/Pinball/Pinball.jsx` | 수정 | `isPlaying` → `isMuted` 교체, `handleToggleMusic` 로직 변경, 아이콘 조건 변경 |

## 완료 체크리스트

- [ ] 소리 아이콘 off 클릭 시 BGM과 모든 효과음이 동시에 음소거된다.
- [ ] 소리 아이콘 on 클릭 시 BGM과 모든 효과음이 즉시 정상 재생된다.
- [ ] 소리 off 상태에서 플리퍼를 눌러도 효과음이 들리지 않는다.
- [ ] 소리 off 상태에서 범퍼에 충돌해도 효과음이 들리지 않는다.
- [ ] 소리 off → on 전환 시 BGM이 처음부터가 아니라 꺼진 지점부터 이어서 재생된다.
- [ ] 빌드 오류 없이 정상 빌드된다 (`npm run build`).
